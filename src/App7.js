import React, { useState, useEffect, createContext, useContext, useCallback } from 'react';

// ==================== CONFIGURACIÓN FIREBASE ====================
// INSTRUCCIONES: 
// 1. Instala Firebase: npm install firebase
// 2. Reemplaza los valores de firebaseConfig con los de tu proyecto Firebase
// 3. Habilita Firestore en tu consola de Firebase

// Descomenta estas líneas cuando tengas Firebase configurado:
import { initializeApp } from 'firebase/app';
import { getFirestore, collection, doc, onSnapshot, setDoc, deleteDoc, writeBatch } from 'firebase/firestore';

const firebaseConfig = {
  apiKey: "AIzaSyCeFJuiRN4cJvRQQM3vw7JLNTIKpUq-aV4",
  authDomain: "gensemen-pro.firebaseapp.com",
  projectId: "gensemen-pro",
  storageBucket: "gensemen-pro.firebasestorage.app",
  messagingSenderId: "805926938982",
  appId: "1:805926938982:web:8f6f28c11eef57a38040a7",
  measurementId: "G-H21R1TPXQJ"
};

// Inicialización de Firebase
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// Variable para habilitar/deshabilitar Firebase
const FIREBASE_ENABLED = true;

// ==================== LOGOS ====================
const LOGO_COMPLETO = "data:image/png;base64,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";
const LOGO_NOMBRE = "data:image/png;base64,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";

// Componentes de Logo
const LogoCompleto = ({ className = "h-24" }) => (
  <img src={LOGO_COMPLETO} alt="La Lagartija Cattle Co." className={className} />
);

const LogoNombre = ({ className = "h-6", inverted = true }) => (
  <img src={LOGO_NOMBRE} alt="La Lagartija Cattle Co." className={className} style={inverted ? { filter: 'invert(1)' } : {}} />
);

// ==================== CONTEXTO DE AUTENTICACIÓN ====================
const AuthContext = createContext(null);

const useAuth = () => {
  const context = useContext(AuthContext);
  if (!context) throw new Error('useAuth must be used within AuthProvider');
  return context;
};

// Definición de roles y permisos
const ROLES = {
  admin: {
    name: 'Administrador',
    permissions: ['dashboard', 'inventario', 'transacciones', 'ventas', 'cxc', 'cxp', 'gastos', 'reportes', 'analisis', 'catalogos', 'configuracion'],
    color: 'bg-amber-500',
  },
  ventas: {
    name: 'Ventas',
    permissions: ['dashboard', 'inventario', 'ventas', 'gastos'],
    color: 'bg-blue-500',
  },
};

// Usuarios de ejemplo
const USERS = [
  { id: 1, username: 'admin', password: 'admin123', name: 'Administrador', role: 'admin' },
  { id: 2, username: 'ventas', password: 'ventas123', name: 'Usuario Ventas', role: 'ventas' },
];

// ==================== UTILIDADES ====================
// Formato de fecha: dd-mmm-aa
const formatDate = (dateString) => {
  if (!dateString) return '';
  // Parsear la fecha manualmente para evitar problemas de zona horaria
  const parts = dateString.split('-');
  if (parts.length !== 3) return dateString;
  const year = parseInt(parts[0]);
  const month = parseInt(parts[1]) - 1; // Los meses en JS son 0-indexed
  const day = parseInt(parts[2]);
  const months = ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic'];
  return `${day.toString().padStart(2, '0')}-${months[month]}-${year.toString().slice(-2)}`;
};

const formatCurrency = (amount) => {
  return new Intl.NumberFormat('es-MX', {
    style: 'currency',
    currency: 'MXN',
    minimumFractionDigits: 0,
    maximumFractionDigits: 0,
  }).format(amount);
};

// Función para generar comprobante PDF (abre ventana de impresión)
const generarComprobante = (tipo, datos, entidad, items, getToro, folio) => {
  const logoBase64 = 'data:image/png;base64,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';
  
  const esCompra = tipo === 'compra';
  const titulo = esCompra ? 'COMPROBANTE DE COMPRA' : 'COMPROBANTE DE VENTA';
  const entidadLabel = esCompra ? 'Proveedor' : 'Cliente';
  const totalLabel = esCompra ? 'Total Compra' : 'Total Venta';
  const folioPrefix = esCompra ? 'C' : 'V';
  
  let itemsHTML = '';
  let totalGeneral = 0;
  items.forEach((item, idx) => {
    const toro = getToro(item.toroId);
    const subtotal = item.cantidad * item.precioUnitario;
    totalGeneral += subtotal;
    itemsHTML += `
      <tr style="background-color: #f0fdf4 !important; -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important;">
        <td style="padding: 8px; border-bottom: 1px solid #e5e7eb;">${idx + 1}</td>
        <td style="padding: 8px; border-bottom: 1px solid #e5e7eb;">${toro?.codigo || '-'}</td>
        <td style="padding: 8px; border-bottom: 1px solid #e5e7eb;">${toro?.nombre || 'Desconocido'}</td>
        <td style="padding: 8px; border-bottom: 1px solid #e5e7eb; text-align: center;">${item.cantidad}</td>
        <td style="padding: 8px; border-bottom: 1px solid #e5e7eb; text-align: right;">${formatCurrency(item.precioUnitario)}</td>
        <td style="padding: 8px; border-bottom: 1px solid #e5e7eb; text-align: right; font-weight: 600;">${formatCurrency(subtotal)}</td>
      </tr>
    `;
  });
  
  const html = `
    <!DOCTYPE html>
    <html>
    <head>
      <title>${titulo} - ${folioPrefix}${folio}</title>
      <style>
        * { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; color-adjust: exact !important; }
        @page { size: auto; margin: 10mm; }
        @media print {
          body { padding: 0; margin: 0; }
          .no-print { display: none !important; }
        }
        body { font-family: Arial, sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; }
        .header { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #059669; padding-bottom: 20px; margin-bottom: 20px; }
        .logo { height: 80px; }
        .titulo { text-align: right; }
        .titulo h1 { margin: 0; color: #059669; font-size: 20px; }
        .titulo p { margin: 5px 0 0; color: #666; font-size: 12px; }
        .info { display: flex; justify-content: space-between; margin-bottom: 20px; }
        .info-box { background: #f9fafb; padding: 15px; border-radius: 8px; width: 48%; -webkit-print-color-adjust: exact !important; }
        .info-box h3 { margin: 0 0 10px; font-size: 12px; color: #666; text-transform: uppercase; }
        .info-box p { margin: 0; font-size: 14px; color: #111; }
        table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
        th { background-color: #059669 !important; color: white !important; padding: 10px 8px; text-align: left; font-size: 12px; -webkit-print-color-adjust: exact !important; }
        tbody tr { background-color: #f0fdf4 !important; -webkit-print-color-adjust: exact !important; }
        .total-row { background-color: #dcfce7 !important; -webkit-print-color-adjust: exact !important; }
        .total-row td { padding: 12px 8px; font-size: 16px; font-weight: 700; }
        .footer { text-align: center; margin-top: 40px; padding-top: 20px; border-top: 1px solid #e5e7eb; color: #666; font-size: 11px; }
      </style>
    </head>
    <body>
      <div class="header">
        <img src="${logoBase64}" alt="Logo" class="logo" />
        <div class="titulo">
          <h1>${titulo}</h1>
          <p>Folio: ${folioPrefix}${String(folio).padStart(4, '0')}</p>
          <p>Fecha: ${formatDate(datos.fecha)}</p>
        </div>
      </div>
      
      <div class="info">
        <div class="info-box">
          <h3>${entidadLabel}</h3>
          <p><strong>${entidad?.nombre || 'N/A'}</strong></p>
          ${entidad?.telefono ? `<p>Tel: ${entidad.telefono}</p>` : ''}
          ${entidad?.email ? `<p>Email: ${entidad.email}</p>` : ''}
        </div>
        <div class="info-box">
          <h3>Empresa</h3>
          <p><strong>La Lagartija Cattle Co.</strong></p>
          <p>GENSEMEN PRO</p>
        </div>
      </div>
      
      <table>
        <thead>
          <tr>
            <th style="width: 40px;">#</th>
            <th style="width: 80px;">Código</th>
            <th>Toro</th>
            <th style="width: 60px; text-align: center;">Cant.</th>
            <th style="width: 100px; text-align: right;">P. Unit.</th>
            <th style="width: 100px; text-align: right;">Subtotal</th>
          </tr>
        </thead>
        <tbody>
          ${itemsHTML}
        </tbody>
        <tfoot>
          <tr class="total-row">
            <td colspan="5" style="text-align: right; padding: 12px 8px;">${totalLabel}:</td>
            <td style="text-align: right;">${formatCurrency(datos.total)}</td>
          </tr>
        </tfoot>
      </table>
      
      ${datos.notas ? `<p><strong>Notas:</strong> ${datos.notas}</p>` : ''}
      
      <div class="footer">
        <p>La Lagartija Cattle Co. · GENSEMEN PRO · Sistema de Gestión de Inventario de Semen Bovino</p>
        <p>Documento generado el ${new Date().toLocaleDateString('es-MX')} a las ${new Date().toLocaleTimeString('es-MX')}</p>
      </div>
      
      <div class="no-print" style="text-align: center; margin-top: 20px;">
        <button onclick="window.print()" style="background: #059669; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-size: 14px;">
          Imprimir / Guardar PDF
        </button>
      </div>
    </body>
    </html>
  `;
  
  const ventana = window.open('', '_blank');
  ventana.document.write(html);
  ventana.document.close();
};

const getTodayISO = () => {
  const today = new Date();
  const year = today.getFullYear();
  const month = String(today.getMonth() + 1).padStart(2, '0');
  const day = String(today.getDate()).padStart(2, '0');
  return `${year}-${month}-${day}`;
};

// ==================== DATOS INICIALES ====================
const initialCatalogToros = [
  { id: 1, codigo: '475', nombre: '475-MACHONA', raza: 'Brahman', activo: true },
  { id: 2, codigo: 'MS1947', nombre: 'ATILA', raza: 'Brahman', activo: true },
  { id: 3, codigo: 'MH2122', nombre: 'DARK RED MASHONA 157', raza: 'Mashona', activo: true },
  { id: 4, codigo: 'PRIMO 23', nombre: 'ELPRIMO 23', raza: 'Brahman', activo: true },
  { id: 5, codigo: '154MH045', nombre: 'MAXIMUS 1812', raza: 'Mashona', activo: true },
];

const initialCatalogProveedores = [
  { id: 1, nombre: 'PHARO CATTLE', contacto: '', telefono: '', activo: true },
  { id: 2, nombre: 'Genética Premium', contacto: '', telefono: '', activo: true },
  { id: 3, nombre: 'BioSemen SA', contacto: '', telefono: '', activo: true },
];

const initialCatalogClientes = [
  { id: 1, nombre: 'Rancho El Sol', contacto: '', telefono: '', activo: true },
  { id: 2, nombre: 'Ganadería Los Pinos', contacto: '', telefono: '', activo: true },
];

const initialCatalogCategorias = [
  { id: 1, nombre: 'Paquetería/Envíos', icono: 'truck', activo: true },
  { id: 2, nombre: 'Nitrógeno', icono: 'snowflake', activo: true },
  { id: 3, nombre: 'Sueldos', icono: 'users', activo: true },
  { id: 4, nombre: 'Mantenimiento', icono: 'tool', activo: true },
  { id: 5, nombre: 'Servicios', icono: 'zap', activo: true },
  { id: 6, nombre: 'Otros', icono: 'more', activo: true },
];

const initialInventory = [
  { id: 1, toroId: 1, termo: 3, canastilla: 2, cantidad: 68, costoUnitario: 25 },
  { id: 2, toroId: 2, termo: 3, canastilla: 4, cantidad: 25, costoUnitario: 45 },
  { id: 3, toroId: 2, termo: 7, canastilla: 6, cantidad: 20, costoUnitario: 45 },
  { id: 4, toroId: 3, termo: 3, canastilla: 2, cantidad: 1, costoUnitario: 80 },
  { id: 5, toroId: 4, termo: 3, canastilla: 2, cantidad: 34, costoUnitario: 55 },
  { id: 6, toroId: 5, termo: 1, canastilla: 4, cantidad: 80, costoUnitario: 35 },
  { id: 7, toroId: 2, termo: 1, canastilla: 1, cantidad: 2, costoUnitario: 45 },
];

// ==================== ICONOS SVG ====================
const Icons = {
  Dashboard: () => (
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" className="w-5 h-5">
      <path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" />
      <path d="M9 22V12h6v10" />
    </svg>
  ),
  Inventory: () => (
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" className="w-5 h-5">
      <path d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4" />
    </svg>
  ),
  Transactions: () => (
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" className="w-5 h-5">
      <path d="M8 7h12M8 12h12M8 17h12M4 7h.01M4 12h.01M4 17h.01" />
    </svg>
  ),
  CxC: () => (
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" className="w-5 h-5">
      <path d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2z" />
    </svg>
  ),
  CxP: () => (
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" className="w-5 h-5">
      <path d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z" />
    </svg>
  ),
  Gastos: () => (
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" className="w-5 h-5">
      <path d="M9 14l6-6m-5.5.5h.01m4.99 5h.01M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16l3.5-2 3.5 2 3.5-2 3.5 2z" />
    </svg>
  ),
  Finanzas: () => (
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" className="w-5 h-5">
      <path d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
    </svg>
  ),
  Reportes: () => (
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" className="w-5 h-5">
      <path d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
    </svg>
  ),
  Analisis: () => (
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" className="w-5 h-5">
      <path d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
    </svg>
  ),
  Catalogos: () => (
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" className="w-5 h-5">
      <path d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
    </svg>
  ),
  Config: () => (
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" className="w-5 h-5">
      <path d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
      <path d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
    </svg>
  ),
  Logout: () => (
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" className="w-5 h-5">
      <path d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
    </svg>
  ),
  User: () => (
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" className="w-5 h-5">
      <path d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
    </svg>
  ),
  Plus: () => (
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="w-5 h-5">
      <path d="M12 5v14M5 12h14" />
    </svg>
  ),
  Edit: () => (
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" className="w-4 h-4">
      <path d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
    </svg>
  ),
  Trash: () => (
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" className="w-4 h-4">
      <path d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
    </svg>
  ),
  Check: () => (
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="w-4 h-4">
      <path d="M5 13l4 4L19 7" />
    </svg>
  ),
  X: () => (
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="w-4 h-4">
      <path d="M6 18L18 6M6 6l12 12" />
    </svg>
  ),
  ChevronDown: () => (
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="w-4 h-4">
      <path d="M19 9l-7 7-7-7" />
    </svg>
  ),
  ChevronUp: () => (
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="w-4 h-4">
      <path d="M5 15l7-7 7 7" />
    </svg>
  ),
  Search: () => (
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" className="w-5 h-5">
      <path d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
    </svg>
  ),
  Tank: () => (
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" className="w-5 h-5">
      <ellipse cx="12" cy="5" rx="9" ry="3" />
      <path d="M21 5v14c0 1.66-4.03 3-9 3s-9-1.34-9-3V5" />
      <path d="M3 12c0 1.66 4.03 3 9 3s9-1.34 9-3" />
    </svg>
  ),
  List: () => (
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" className="w-5 h-5">
      <path d="M4 6h16M4 12h16M4 18h16" />
    </svg>
  ),
  Grid: () => (
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" className="w-5 h-5">
      <rect x="3" y="3" width="7" height="7" rx="1" />
      <rect x="14" y="3" width="7" height="7" rx="1" />
      <rect x="3" y="14" width="7" height="7" rx="1" />
      <rect x="14" y="14" width="7" height="7" rx="1" />
    </svg>
  ),
  TrendUp: () => (
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" className="w-4 h-4">
      <path d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
    </svg>
  ),
  TrendDown: () => (
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" className="w-4 h-4">
      <path d="M13 17h8m0 0V9m0 8l-8-8-4 4-6-6" />
    </svg>
  ),
  Eye: () => (
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" className="w-4 h-4">
      <path d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
      <path d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
    </svg>
  ),
  Truck: () => (
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" className="w-5 h-5">
      <path d="M13 16V6a1 1 0 00-1-1H4a1 1 0 00-1 1v10a1 1 0 001 1h1m8-1a1 1 0 01-1 1H9m4-1V8a1 1 0 011-1h2.586a1 1 0 01.707.293l3.414 3.414a1 1 0 01.293.707V16a1 1 0 01-1 1h-1m-6-1a1 1 0 001 1h1M5 17a2 2 0 104 0m-4 0a2 2 0 114 0m6 0a2 2 0 104 0m-4 0a2 2 0 114 0" />
    </svg>
  ),
  Snowflake: () => (
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" className="w-5 h-5">
      <path d="M12 2v20M2 12h20M4.93 4.93l14.14 14.14M19.07 4.93L4.93 19.07" />
    </svg>
  ),
  Users: () => (
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" className="w-5 h-5">
      <path d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
    </svg>
  ),
  Tool: () => (
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" className="w-5 h-5">
      <path d="M14.7 6.3a1 1 0 000 1.4l1.6 1.6a1 1 0 001.4 0l3.77-3.77a6 6 0 01-7.94 7.94l-6.91 6.91a2.12 2.12 0 01-3-3l6.91-6.91a6 6 0 017.94-7.94l-3.76 3.76z" />
    </svg>
  ),
  Zap: () => (
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" className="w-5 h-5">
      <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z" />
    </svg>
  ),
  MoreHorizontal: () => (
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" className="w-5 h-5">
      <circle cx="12" cy="12" r="1" />
      <circle cx="19" cy="12" r="1" />
      <circle cx="5" cy="12" r="1" />
    </svg>
  ),
  Cart: () => (
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" className="w-5 h-5">
      <path d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
    </svg>
  ),
  Calendar: () => (
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" className="w-5 h-5">
      <rect x="3" y="4" width="18" height="18" rx="2" />
      <path d="M16 2v4M8 2v4M3 10h18" />
    </svg>
  ),
  Move: () => (
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" className="w-4 h-4">
      <path d="M5 9l-3 3 3 3M9 5l3-3 3 3M15 19l-3 3-3-3M19 9l3 3-3 3M2 12h20M12 2v20" />
    </svg>
  ),
  Chart: () => (
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" className="w-5 h-5">
      <path d="M3 3v18h18M7 16l4-4 4 4 5-6" />
    </svg>
  ),
  Document: () => (
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" className="w-5 h-5">
      <path d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
    </svg>
  ),
};

// ==================== COMPONENTE FILTRO DE PERÍODO ====================
const MONTHS = ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];
const MONTHS_SHORT = ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic'];

const PeriodFilter = ({ selectedPeriod, onPeriodChange }) => {
  const currentYear = new Date().getFullYear();
  const currentMonth = new Date().getMonth();
  
  return (
    <div className="flex items-center gap-2">
      <Icons.Calendar />
      <select
        value={selectedPeriod}
        onChange={(e) => onPeriodChange(e.target.value)}
        className="px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500 bg-white"
      >
        <option value="all">Todo (histórico)</option>
        <option value={`${currentYear}-${String(currentMonth + 1).padStart(2, '0')}`}>
          {MONTHS[currentMonth]} {currentYear} (actual)
        </option>
        <option value={currentMonth > 0 ? `${currentYear}-${String(currentMonth).padStart(2, '0')}` : `${currentYear - 1}-12`}>
          {currentMonth > 0 ? MONTHS[currentMonth - 1] : 'Diciembre'} {currentMonth > 0 ? currentYear : currentYear - 1}
        </option>
        <option value={`year-${currentYear}`}>Año {currentYear}</option>
        <option value={`year-${currentYear - 1}`}>Año {currentYear - 1}</option>
      </select>
    </div>
  );
};

// Función helper para parsear fecha sin problemas de zona horaria
const parseDateString = (dateString) => {
  if (!dateString) return null;
  const parts = dateString.split('-');
  if (parts.length !== 3) return null;
  return {
    year: parseInt(parts[0]),
    month: parseInt(parts[1]),
    day: parseInt(parts[2])
  };
};

// Función helper para filtrar por período
const filterByPeriod = (items, period, dateField = 'fecha') => {
  if (!items || !Array.isArray(items)) return [];
  if (!period || period === 'all') return items;
  
  if (period.startsWith('year-')) {
    const year = parseInt(period.replace('year-', ''));
    return items.filter(item => {
      if (!item || !item[dateField]) return false;
      const fecha = parseDateString(item[dateField]);
      return fecha && fecha.year === year;
    });
  }
  
  const parts = period.split('-');
  if (parts.length !== 2) return items;
  
  const year = parseInt(parts[0]);
  const month = parseInt(parts[1]);
  
  return items.filter(item => {
    if (!item || !item[dateField]) return false;
    const fecha = parseDateString(item[dateField]);
    return fecha && fecha.year === year && fecha.month === month;
  });
};

// Función helper para obtener label del período
const getPeriodLabel = (period) => {
  if (!period || period === 'all') return 'Total';
  if (period.startsWith('year-')) return `Año ${period.replace('year-', '')}`;
  const parts = period.split('-');
  if (parts.length !== 2) return 'Total';
  const month = parseInt(parts[1]);
  const year = parseInt(parts[0]);
  return `${MONTHS_SHORT[month - 1]} ${year}`;
};

// ==================== COMPONENTES DE UI ====================
const Button = ({ children, variant = 'primary', size = 'md', onClick, className = '', disabled, type = 'button' }) => {
  const baseClasses = 'inline-flex items-center justify-center gap-2 font-medium rounded-lg transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed focus:outline-none focus:ring-2 focus:ring-offset-2';
  const variants = {
    primary: 'bg-emerald-600 hover:bg-emerald-700 text-white focus:ring-emerald-500',
    secondary: 'bg-gray-100 hover:bg-gray-200 text-gray-700 border border-gray-300 focus:ring-gray-500',
    danger: 'bg-red-600 hover:bg-red-700 text-white focus:ring-red-500',
    success: 'bg-green-600 hover:bg-green-700 text-white focus:ring-green-500',
    ghost: 'hover:bg-gray-100 text-gray-600 focus:ring-gray-500',
    outline: 'border border-gray-300 hover:bg-gray-50 text-gray-700 focus:ring-gray-500',
  };
  const sizes = {
    xs: 'px-2 py-1 text-xs',
    sm: 'px-3 py-1.5 text-sm',
    md: 'px-4 py-2 text-sm',
    lg: 'px-5 py-2.5 text-base',
  };
  return (
    <button type={type} className={`${baseClasses} ${variants[variant]} ${sizes[size]} ${className}`} onClick={onClick} disabled={disabled}>
      {children}
    </button>
  );
};

const Input = ({ label, type = 'text', value, onChange, placeholder, required, min, step, className = '', error, disabled }) => (
  <div className={`space-y-1 ${className}`}>
    {label && <label className="block text-sm font-medium text-gray-700">{label} {required && <span className="text-red-500">*</span>}</label>}
    <input
      type={type}
      value={value}
      onChange={(e) => onChange(e.target.value)}
      placeholder={placeholder}
      required={required}
      min={min}
      step={step}
      disabled={disabled}
      className={`w-full px-3 py-2 bg-white border rounded-lg text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-all disabled:bg-gray-100 disabled:cursor-not-allowed ${error ? 'border-red-500' : 'border-gray-300'}`}
    />
    {error && <p className="text-xs text-red-500">{error}</p>}
  </div>
);

const Select = ({ label, value, onChange, options, placeholder, required, className = '', disabled }) => (
  <div className={`space-y-1 ${className}`}>
    {label && <label className="block text-sm font-medium text-gray-700">{label} {required && <span className="text-red-500">*</span>}</label>}
    <select
      value={value}
      onChange={(e) => onChange(e.target.value)}
      disabled={disabled}
      className="w-full px-3 py-2 bg-white border border-gray-300 rounded-lg text-gray-900 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-all disabled:bg-gray-100 disabled:cursor-not-allowed"
    >
      <option value="">{placeholder || 'Seleccionar...'}</option>
      {options.map((opt) => (
        <option key={opt.value} value={opt.value}>{opt.label}</option>
      ))}
    </select>
  </div>
);

const Modal = ({ isOpen, onClose, title, children, size = 'md' }) => {
  if (!isOpen) return null;
  const sizes = {
    sm: 'max-w-md',
    md: 'max-w-lg',
    lg: 'max-w-2xl',
    xl: 'max-w-4xl',
  };
  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center p-4">
      <div className="absolute inset-0 bg-black/50" onClick={onClose} />
      <div className={`relative bg-white rounded-xl shadow-2xl w-full ${sizes[size]} max-h-[90vh] overflow-hidden flex flex-col`}>
        <div className="flex items-center justify-between px-6 py-4 border-b border-gray-200">
          <h3 className="text-lg font-semibold text-gray-900">{title}</h3>
          <button onClick={onClose} className="p-1 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors">
            <Icons.X />
          </button>
        </div>
        <div className="p-6 overflow-y-auto">{children}</div>
      </div>
    </div>
  );
};

const Badge = ({ children, variant = 'default', size = 'md' }) => {
  const variants = {
    default: 'bg-gray-100 text-gray-700',
    success: 'bg-green-100 text-green-700',
    warning: 'bg-amber-100 text-amber-700',
    danger: 'bg-red-100 text-red-700',
    info: 'bg-blue-100 text-blue-700',
    emerald: 'bg-emerald-100 text-emerald-700',
  };
  const sizes = {
    sm: 'px-2 py-0.5 text-xs',
    md: 'px-2.5 py-1 text-xs',
  };
  return (
    <span className={`inline-flex items-center font-medium rounded-full ${variants[variant]} ${sizes[size]}`}>
      {children}
    </span>
  );
};

const StatCard = ({ title, value, subtitle, icon: Icon, trend, trendLabel, compact = false }) => (
  <div className={`bg-white rounded-lg border border-gray-200 ${compact ? 'p-3' : 'p-4'} hover:shadow-sm transition-shadow`}>
    <div className="flex items-center justify-between gap-3">
      {Icon && (
        <div className={`${compact ? 'p-2' : 'p-2.5'} bg-gray-50 rounded-lg flex-shrink-0`}>
          <div className="text-gray-400">
            <Icon />
          </div>
        </div>
      )}
      <div className="flex-1 min-w-0">
        <p className="text-xs font-medium text-gray-500 truncate">{title}</p>
        <p className={`${compact ? 'text-lg' : 'text-xl'} font-bold text-gray-900`}>{value}</p>
      </div>
      {trend !== undefined && (
        <div className={`flex items-center gap-0.5 text-xs font-medium ${trend >= 0 ? 'text-green-600' : 'text-red-600'}`}>
          {trend >= 0 ? <Icons.TrendUp /> : <Icons.TrendDown />}
          <span>{trend >= 0 ? '+' : ''}{trend}%</span>
        </div>
      )}
    </div>
  </div>
);

const EmptyState = ({ icon: Icon, title, description, action }) => (
  <div className="flex flex-col items-center justify-center py-12 text-center">
    {Icon && <div className="p-4 bg-gray-100 rounded-full mb-4 text-gray-400"><Icon /></div>}
    <h3 className="text-lg font-medium text-gray-900 mb-1">{title}</h3>
    <p className="text-sm text-gray-500 mb-4 max-w-sm">{description}</p>
    {action}
  </div>
);

// ==================== COMPONENTE DE LOGIN ====================
const LoginScreen = ({ onLogin, usuarios = USERS }) => {
  const [username, setUsername] = useState('');
  const [password, setPassword] = useState('');
  const [error, setError] = useState('');
  const [loading, setLoading] = useState(false);

  const handleSubmit = () => {
    if (!username || !password) {
      setError('Por favor ingresa usuario y contraseña');
      return;
    }
    setLoading(true);
    setError('');
    
    setTimeout(() => {
      const user = usuarios.find(u => u.username === username && u.password === password);
      if (user) {
        onLogin(user);
      } else {
        setError('Usuario o contraseña incorrectos');
      }
      setLoading(false);
    }, 500);
  };

  const handleKeyPress = (e) => {
    if (e.key === 'Enter') {
      handleSubmit();
    }
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 flex items-center justify-center p-4">
      <div className="w-full max-w-md">
        <div className="bg-white rounded-2xl shadow-xl border border-gray-200 overflow-hidden">
          {/* Header */}
          <div className="bg-gradient-to-r from-emerald-600 to-emerald-700 px-8 py-10 text-center">
            <div className="flex justify-center mb-4">
              <LogoCompleto className="h-28" />
            </div>
            <h1 className="text-2xl font-bold text-white">GENSEMEN PRO</h1>
            <p className="text-emerald-100 text-sm mt-1">Sistema de Gestión de Genética Bovina</p>
          </div>
          
          {/* Form - Using div instead of form tag */}
          <div className="p-8 space-y-5">
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">Usuario</label>
              <input
                type="text"
                value={username}
                onChange={(e) => setUsername(e.target.value)}
                onKeyPress={handleKeyPress}
                placeholder="Ingresa tu usuario"
                className="w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 focus:bg-white transition-all"
              />
            </div>
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">Contraseña</label>
              <input
                type="password"
                value={password}
                onChange={(e) => setPassword(e.target.value)}
                onKeyPress={handleKeyPress}
                placeholder="Ingresa tu contraseña"
                className="w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 focus:bg-white transition-all"
              />
            </div>
            
            {error && (
              <div className="p-3 bg-red-50 border border-red-200 rounded-lg text-sm text-red-600">
                {error}
              </div>
            )}
            
            <button
              onClick={handleSubmit}
              disabled={loading}
              className="w-full py-3 bg-emerald-600 hover:bg-emerald-700 text-white font-medium rounded-xl transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"
            >
              {loading ? (
                <div className="w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin" />
              ) : (
                <>Iniciar Sesión</>
              )}
            </button>
          </div>
          
          {/* Demo credentials */}

        </div>
      </div>
    </div>
  );
};

// ==================== SIDEBAR ====================
const Sidebar = ({ activeModule, setActiveModule, user, onLogout, syncStatus = 'local', firebaseEnabled = false, isOpen, onClose }) => {
  const role = ROLES[user.role];
  
  // Indicador de estado de sincronización
  const SyncIndicator = () => {
    if (!firebaseEnabled) {
      return (
        <div className="flex items-center gap-2 text-xs text-gray-500">
          <div className="w-2 h-2 rounded-full bg-gray-400"></div>
          <span>Local</span>
        </div>
      );
    }
    
    const statusConfig = {
      local: { color: 'bg-gray-400', text: 'Sin conexión' },
      syncing: { color: 'bg-yellow-400 animate-pulse', text: 'Sincronizando...' },
      synced: { color: 'bg-green-500', text: 'Sincronizado' },
      error: { color: 'bg-red-500', text: 'Error de sync' },
    };
    
    const config = statusConfig[syncStatus] || statusConfig.local;
    
    return (
      <div className="flex items-center gap-2 text-xs text-gray-500">
        <div className={`w-2 h-2 rounded-full ${config.color}`}></div>
        <span>{config.text}</span>
      </div>
    );
  };
  
  const menuItems = [
    { id: 'dashboard', label: 'Dashboard', icon: Icons.Dashboard, permission: 'dashboard' },
    { id: 'inventario', label: 'Inventario', icon: Icons.Inventory, permission: 'inventario' },
    { id: 'transacciones', label: 'Transacciones', icon: Icons.Transactions, permission: 'transacciones', subItems: [
      { id: 'compras', label: 'Compras', permission: 'transacciones' },
      { id: 'ventas', label: 'Ventas', permission: 'ventas' },
    ]},
    { id: 'cxc', label: 'Cuentas por Cobrar', icon: Icons.CxC, permission: 'cxc' },
    { id: 'cxp', label: 'Cuentas por Pagar', icon: Icons.CxP, permission: 'cxp' },
    { id: 'gastos', label: 'Gastos', icon: Icons.Gastos, permission: 'gastos' },
    { id: 'reportes', label: 'Reportes', icon: Icons.Reportes, permission: 'reportes' },
    { id: 'analisis', label: 'Análisis IA', icon: Icons.Analisis, permission: 'analisis' },
  ];

  const configItems = [
    { id: 'catalogos', label: 'Catálogos', icon: Icons.Catalogos, permission: 'catalogos' },
    { id: 'configuracion', label: 'Configuración', icon: Icons.Config, permission: 'configuracion' },
  ];

  const [expandedItems, setExpandedItems] = useState([]);

  const toggleExpand = (id) => {
    setExpandedItems(prev => 
      prev.includes(id) ? prev.filter(i => i !== id) : [...prev, id]
    );
  };

  const hasPermission = (permission) => {
    return role.permissions.includes(permission);
  };

  const MenuItem = ({ item, isSubItem = false }) => {
    if (!hasPermission(item.permission)) return null;
    
    const isActive = activeModule === item.id || (item.subItems && item.subItems.some(s => s.id === activeModule));
    const isExpanded = expandedItems.includes(item.id);
    const hasSubItems = item.subItems && item.subItems.length > 0;
    
    return (
      <div>
        <button
          onClick={() => {
            if (hasSubItems) {
              toggleExpand(item.id);
            } else {
              setActiveModule(item.id);
            }
          }}
          className={`w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium transition-all ${
            isActive 
              ? 'bg-emerald-50 text-emerald-700' 
              : 'text-gray-600 hover:bg-gray-100 hover:text-gray-900'
          } ${isSubItem ? 'pl-11' : ''}`}
        >
          {item.icon && <item.icon />}
          <span className="flex-1 text-left">{item.label}</span>
          {hasSubItems && (
            <span className="text-gray-400">
              {isExpanded ? <Icons.ChevronUp /> : <Icons.ChevronDown />}
            </span>
          )}
        </button>
        {hasSubItems && isExpanded && (
          <div className="mt-1 space-y-1">
            {item.subItems.map(subItem => (
              hasPermission(subItem.permission) && (
                <button
                  key={subItem.id}
                  onClick={() => setActiveModule(subItem.id)}
                  className={`w-full flex items-center gap-3 px-3 py-2 pl-11 rounded-lg text-sm transition-all ${
                    activeModule === subItem.id 
                      ? 'bg-emerald-50 text-emerald-700 font-medium' 
                      : 'text-gray-500 hover:bg-gray-100 hover:text-gray-700'
                  }`}
                >
                  {subItem.label}
                </button>
              )
            ))}
          </div>
        )}
      </div>
    );
  };

  return (
    <>
      {/* Backdrop para móvil */}
      {isOpen && (
        <div 
          className="fixed inset-0 bg-black bg-opacity-50 z-30 md:hidden"
          onClick={onClose}
        />
      )}
      
      <aside className={`fixed left-0 top-0 bottom-0 w-64 bg-white border-r border-gray-200 flex flex-col z-40 transform transition-transform duration-300 ease-in-out ${isOpen ? 'translate-x-0' : '-translate-x-full'} md:translate-x-0`}>
        {/* Botón cerrar en móvil */}
        <button 
          onClick={onClose}
          className="absolute top-4 right-4 p-1 rounded-lg hover:bg-gray-100 md:hidden"
        >
          <svg className="w-6 h-6 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>
        
        {/* Logo */}
        <div className="p-5 border-b border-gray-200 bg-emerald-700">
          <div className="flex flex-col items-center gap-2">
            <LogoCompleto className="h-16" />
            <p className="text-xs text-emerald-200">Sistema de Gestión</p>
          </div>
        </div>

      {/* Navigation */}
      <nav className="flex-1 overflow-y-auto p-4">
        <div className="space-y-1">
          <p className="px-3 py-2 text-xs font-semibold text-gray-400 uppercase tracking-wider">Navegación</p>
          {menuItems.map(item => <MenuItem key={item.id} item={item} />)}
        </div>
        
        {(hasPermission('catalogos') || hasPermission('configuracion')) && (
          <div className="mt-6 pt-6 border-t border-gray-200 space-y-1">
            <p className="px-3 py-2 text-xs font-semibold text-gray-400 uppercase tracking-wider">Sistema</p>
            {configItems.map(item => <MenuItem key={item.id} item={item} />)}
          </div>
        )}
      </nav>

      {/* User section */}
      <div className="p-4 border-t border-gray-200">
        <div className="flex items-center gap-3 px-3 py-2">
          <div className="w-9 h-9 bg-gray-200 rounded-full flex items-center justify-center">
            <Icons.User />
          </div>
          <div className="flex-1 min-w-0">
            <p className="text-sm font-medium text-gray-900 truncate">{user.name}</p>
            <Badge variant="emerald" size="sm">{role.name}</Badge>
          </div>
        </div>
        {/* Estado de sincronización */}
        <div className="px-3 py-2 mt-1">
          <SyncIndicator />
        </div>
        <button
          onClick={onLogout}
          className="w-full mt-2 flex items-center gap-3 px-3 py-2 text-sm text-gray-600 hover:bg-gray-100 hover:text-gray-900 rounded-lg transition-colors"
        >
          <Icons.Logout />
          <span>Cerrar Sesión</span>
        </button>
      </div>
    </aside>
    </>
  );
};

// ==================== MÓDULOS ====================
// Dashboard
const DashboardModule = ({ inventory = [], toros = [], compras = [], ventas = [], cxc = [], cxp = [], gastos = [], clientes = [], proveedores = [] }) => {
  const [selectedPeriod, setSelectedPeriod] = useState('all');
  
  // KPIs de inventario (siempre totales)
  const totalPajillas = inventory.reduce((sum, item) => sum + (item.cantidad || 0), 0);
  const valorInventario = inventory.reduce((sum, item) => sum + ((item.cantidad || 0) * (item.costoUnitario || 0)), 0);
  const totalCxC = cxc.reduce((sum, c) => sum + ((c.monto || 0) - (c.cobrado || 0)), 0);
  const totalCxP = cxp.reduce((sum, c) => sum + ((c.monto || 0) - (c.pagado || 0)), 0);
  
  const termosEnUso = [...new Set(inventory.map(i => i.termo))].length;
  const canastillasActivas = inventory.length;
  
  // Filtrar datos por período
  const ventasFiltradas = filterByPeriod(ventas, selectedPeriod);
  const comprasFiltradas = filterByPeriod(compras, selectedPeriod);
  const gastosFiltrados = filterByPeriod(gastos, selectedPeriod);
  
  // KPIs del período
  const totalVentasPeriodo = ventasFiltradas.reduce((sum, v) => sum + (v.total || 0), 0);
  const totalComprasPeriodo = comprasFiltradas.reduce((sum, c) => sum + (c.total || 0), 0);
  const totalGastosPeriodo = gastosFiltrados.reduce((sum, g) => sum + (g.monto || 0), 0);
  const utilidadBruta = totalVentasPeriodo - totalComprasPeriodo - totalGastosPeriodo;
  
  // Top 5 toros por cantidad en inventario
  const inventarioAgrupado = inventory.reduce((acc, item) => {
    if (!acc[item.toroId]) acc[item.toroId] = 0;
    acc[item.toroId] += item.cantidad;
    return acc;
  }, {});
  
  const topToros = Object.entries(inventarioAgrupado)
    .map(([toroId, cantidad]) => {
      const toro = toros.find(t => t.id === Number(toroId)) || { codigo: '???', nombre: 'Desconocido' };
      return { toroId: Number(toroId), codigo: toro.codigo, nombre: toro.nombre, cantidad };
    })
    .sort((a, b) => b.cantidad - a.cantidad)
    .slice(0, 5);
  
  // Alertas de stock bajo (menos de 10 pajillas por toro)
  const stockBajo = Object.entries(inventarioAgrupado)
    .filter(([_, cantidad]) => cantidad < 10)
    .map(([toroId, cantidad]) => {
      const toro = toros.find(t => t.id === Number(toroId)) || { codigo: '???', nombre: 'Desconocido' };
      return { toroId: Number(toroId), codigo: toro.codigo, nombre: toro.nombre, cantidad };
    })
    .sort((a, b) => a.cantidad - b.cantidad);
  
  // CxC pendientes (ordenadas por fecha más antigua)
  const cxcPendientes = cxc
    .filter(c => (c.monto - (c.cobrado || 0)) > 0)
    .sort((a, b) => a.fecha.localeCompare(b.fecha))
    .slice(0, 5);
  
  // CxP pendientes (ordenadas por fecha más antigua)
  const cxpPendientes = cxp
    .filter(c => (c.monto - (c.pagado || 0)) > 0)
    .sort((a, b) => a.fecha.localeCompare(b.fecha))
    .slice(0, 5);

  const getToro = (toroId) => toros.find(t => t.id === toroId) || { codigo: '', nombre: 'Desconocido' };
  const getCliente = (clienteId) => clientes.find(c => c.id === clienteId) || { nombre: 'Desconocido' };
  const getProveedor = (proveedorId) => proveedores.find(p => p.id === proveedorId) || { nombre: 'Desconocido' };

  return (
    <div className="space-y-6">
      <div className="flex items-center justify-between">
        <div className="flex items-center gap-4">
          <LogoNombre className="h-8" inverted={false} />
          <div className="border-l border-gray-300 pl-4">
            <h1 className="text-2xl font-bold text-gray-900">Dashboard</h1>
            <p className="text-gray-500 text-sm">Vista general del sistema</p>
          </div>
        </div>
        <PeriodFilter selectedPeriod={selectedPeriod} onPeriodChange={setSelectedPeriod} />
      </div>

      {/* Stats principales - Inventario y Cuentas (siempre totales) */}
      <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
        <StatCard title="Total Pajillas" value={totalPajillas.toLocaleString()} icon={Icons.Tank} compact />
        <StatCard title="Valor Inventario" value={formatCurrency(valorInventario)} icon={Icons.Finanzas} compact />
        <StatCard title="Cuentas por Cobrar" value={formatCurrency(totalCxC)} icon={Icons.CxC} compact />
        <StatCard title="Cuentas por Pagar" value={formatCurrency(totalCxP)} icon={Icons.CxP} compact />
      </div>

      {/* Stats del período seleccionado */}
      <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
        <StatCard 
          title={`Ventas ${selectedPeriod === 'all' ? 'Totales' : 'del Período'}`} 
          value={formatCurrency(totalVentasPeriodo)} 
          subtitle={`${ventasFiltradas.length} transacciones`}
          icon={Icons.Transactions} 
          compact 
        />
        <StatCard 
          title={`Compras ${selectedPeriod === 'all' ? 'Totales' : 'del Período'}`} 
          value={formatCurrency(totalComprasPeriodo)} 
          subtitle={`${comprasFiltradas.length} transacciones`}
          icon={Icons.Cart} 
          compact 
        />
        <StatCard 
          title={`Gastos ${selectedPeriod === 'all' ? 'Totales' : 'del Período'}`} 
          value={formatCurrency(totalGastosPeriodo)} 
          subtitle={`${gastosFiltrados.length} registros`}
          icon={Icons.Gastos} 
          compact 
        />
        <StatCard 
          title={`Utilidad ${selectedPeriod === 'all' ? 'Total' : 'del Período'}`} 
          value={formatCurrency(utilidadBruta)} 
          icon={Icons.Chart} 
          compact 
        />
      </div>

      {/* Alertas y Top Toros */}
      <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
        {/* Alertas de Stock Bajo */}
        <div className="bg-white rounded-lg border border-gray-200 p-4">
          <div className="flex items-center gap-2 mb-3">
            <div className="text-amber-500"><Icons.Tank /></div>
            <h2 className="font-semibold text-gray-900">Alertas de Stock Bajo</h2>
            {stockBajo.length > 0 && (
              <Badge variant="amber">{stockBajo.length}</Badge>
            )}
          </div>
          {stockBajo.length === 0 ? (
            <p className="text-sm text-gray-500 py-4 text-center">No hay alertas de stock bajo</p>
          ) : (
            <div className="space-y-2">
              {stockBajo.slice(0, 5).map((item) => (
                <div key={item.toroId} className="flex justify-between items-center py-1.5 border-b border-gray-100 last:border-0">
                  <span className="text-sm text-gray-600">
                    <span className="font-mono text-gray-500">{item.codigo}</span> - {item.nombre}
                  </span>
                  <Badge variant={item.cantidad < 5 ? 'danger' : 'warning'}>{item.cantidad} paj.</Badge>
                </div>
              ))}
            </div>
          )}
        </div>

        {/* Top Toros */}
        <div className="bg-white rounded-lg border border-gray-200 p-4">
          <div className="flex items-center gap-2 mb-3">
            <Icons.Chart />
            <h2 className="font-semibold text-gray-900">Top 5 Toros en Inventario</h2>
          </div>
          <div className="space-y-2">
            {topToros.map((item, idx) => (
              <div key={item.toroId} className="flex justify-between items-center py-1.5 border-b border-gray-100 last:border-0">
                <span className="text-sm text-gray-600 flex items-center gap-2">
                  <span className={`w-5 h-5 rounded-full flex items-center justify-center text-xs font-bold ${
                    idx === 0 ? 'bg-amber-100 text-amber-700' : 
                    idx === 1 ? 'bg-gray-200 text-gray-600' : 
                    idx === 2 ? 'bg-orange-100 text-orange-700' : 'bg-gray-100 text-gray-500'
                  }`}>{idx + 1}</span>
                  <span className="font-mono text-gray-500">{item.codigo}</span> - {item.nombre}
                </span>
                <span className="font-semibold text-gray-900">{item.cantidad}</span>
              </div>
            ))}
            {topToros.length === 0 && (
              <p className="text-sm text-gray-500 py-4 text-center">No hay inventario registrado</p>
            )}
          </div>
        </div>
      </div>

      {/* CxC y CxP Pendientes */}
      <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
        {/* CxC Pendientes */}
        <div className="bg-white rounded-lg border border-gray-200 p-4">
          <div className="flex items-center justify-between mb-3">
            <div className="flex items-center gap-2">
              <Icons.CxC />
              <h2 className="font-semibold text-gray-900">CxC Pendientes</h2>
            </div>
            <span className="text-sm font-semibold text-emerald-600">{formatCurrency(totalCxC)}</span>
          </div>
          {cxcPendientes.length === 0 ? (
            <p className="text-sm text-gray-500 py-4 text-center">No hay cuentas pendientes</p>
          ) : (
            <div className="space-y-2">
              {cxcPendientes.map((cuenta) => (
                <div key={cuenta.id} className="flex justify-between items-center py-1.5 border-b border-gray-100 last:border-0">
                  <div>
                    <p className="text-sm text-gray-900">{getCliente(cuenta.clienteId).nombre}</p>
                    <p className="text-xs text-gray-500">{formatDate(cuenta.fecha)}</p>
                  </div>
                  <span className="font-semibold text-emerald-600">{formatCurrency(cuenta.monto - (cuenta.cobrado || 0))}</span>
                </div>
              ))}
            </div>
          )}
        </div>

        {/* CxP Pendientes */}
        <div className="bg-white rounded-lg border border-gray-200 p-4">
          <div className="flex items-center justify-between mb-3">
            <div className="flex items-center gap-2">
              <Icons.CxP />
              <h2 className="font-semibold text-gray-900">CxP Pendientes</h2>
            </div>
            <span className="text-sm font-semibold text-red-600">{formatCurrency(totalCxP)}</span>
          </div>
          {cxpPendientes.length === 0 ? (
            <p className="text-sm text-gray-500 py-4 text-center">No hay cuentas pendientes</p>
          ) : (
            <div className="space-y-2">
              {cxpPendientes.map((cuenta) => (
                <div key={cuenta.id} className="flex justify-between items-center py-1.5 border-b border-gray-100 last:border-0">
                  <div>
                    <p className="text-sm text-gray-900">{getProveedor(cuenta.proveedorId).nombre}</p>
                    <p className="text-xs text-gray-500">{formatDate(cuenta.fecha)}</p>
                  </div>
                  <span className="font-semibold text-red-600">{formatCurrency(cuenta.monto - (cuenta.pagado || 0))}</span>
                </div>
              ))}
            </div>
          )}
        </div>
      </div>

      {/* Resumen de Termos e Inventario */}
      <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
        {/* Resumen de Termos */}
        <div className="bg-white rounded-lg border border-gray-200 p-4">
          <div className="flex items-center gap-2 mb-3">
            <Icons.Tank />
            <h2 className="font-semibold text-gray-900">Resumen de Termos</h2>
          </div>
          <div className="space-y-2">
            <div className="flex justify-between items-center py-1.5 border-b border-gray-100">
              <span className="text-sm text-gray-600">Termos en uso</span>
              <span className="font-semibold text-gray-900">{termosEnUso}</span>
            </div>
            <div className="flex justify-between items-center py-1.5 border-b border-gray-100">
              <span className="text-sm text-gray-600">Canastillas activas</span>
              <span className="font-semibold text-gray-900">{canastillasActivas}</span>
            </div>
            <div className="flex justify-between items-center py-1.5">
              <span className="text-sm text-gray-600">Capacidad disponible</span>
              <span className="font-semibold text-gray-900">{(termosEnUso * 6) - canastillasActivas}</span>
            </div>
          </div>
        </div>

        {/* Inventario Reciente - ahora ocupa 2 columnas */}
        <div className="col-span-2 bg-white rounded-lg border border-gray-200 overflow-hidden">
          <div className="px-4 py-3 border-b border-gray-200">
            <h2 className="font-semibold text-gray-900">Inventario por Ubicación</h2>
          </div>
          <div className="overflow-x-auto max-h-48">
            <table className="w-full">
              <thead className="sticky top-0 bg-gray-50">
                <tr className="border-b border-gray-200">
                  <th className="text-left px-4 py-2 text-xs font-semibold text-gray-500 uppercase">Código</th>
                  <th className="text-left px-4 py-2 text-xs font-semibold text-gray-500 uppercase">Nombre</th>
                  <th className="text-center px-4 py-2 text-xs font-semibold text-gray-500 uppercase">Termo</th>
                  <th className="text-center px-4 py-2 text-xs font-semibold text-gray-500 uppercase">Canast.</th>
                  <th className="text-center px-4 py-2 text-xs font-semibold text-gray-500 uppercase">Cant.</th>
                </tr>
              </thead>
              <tbody className="divide-y divide-gray-200">
                {inventory.slice(0, 8).map((item) => {
                  const toro = getToro(item.toroId);
                  return (
                    <tr key={item.id} className="hover:bg-gray-50">
                      <td className="px-4 py-2 text-sm font-mono text-gray-900">{toro.codigo}</td>
                      <td className="px-4 py-2 text-sm text-gray-600 truncate max-w-32">{toro.nombre}</td>
                      <td className="px-4 py-2 text-center"><Badge variant="emerald">T{item.termo}</Badge></td>
                      <td className="px-4 py-2 text-center"><Badge>C{item.canastilla}</Badge></td>
                      <td className="px-4 py-2 text-center font-semibold">{item.cantidad}</td>
                    </tr>
                  );
                })}
                {inventory.length === 0 && (
                  <tr><td colSpan="5" className="px-4 py-8 text-center text-gray-500">No hay inventario</td></tr>
                )}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  );
};

// Inventario
const InventarioModule = ({ inventory, setInventory, toros, setToros }) => {
  const [viewMode, setViewMode] = useState('termo'); // 'termo' o 'lista'
  const [searchTerm, setSearchTerm] = useState('');
  const [showModal, setShowModal] = useState(false);
  const [showToroModal, setShowToroModal] = useState(false);
  const [showMoveModal, setShowMoveModal] = useState(false);
  const [expandedTermos, setExpandedTermos] = useState([]);
  const [editingItem, setEditingItem] = useState(null);
  const [movingItem, setMovingItem] = useState(null);
  
  const [form, setForm] = useState({ toroId: '', termo: '', canastilla: '', cantidad: '', costoUnitario: '' });
  const [moveForm, setMoveForm] = useState({ termo: '', canastilla: '', cantidad: '' });
  const [toroForm, setToroForm] = useState({ codigo: '', nombre: '', raza: '' });
  const [toroSearch, setToroSearch] = useState('');
  const [showToroDropdown, setShowToroDropdown] = useState(false);

  const getToro = (toroId) => toros.find(t => t.id === toroId) || { codigo: '', nombre: 'Desconocido' };

  const totalPajillas = inventory.reduce((sum, item) => sum + item.cantidad, 0);
  const termosEnUso = [...new Set(inventory.map(i => i.termo))].length;
  const torosRegistrados = [...new Set(inventory.map(i => i.toroId))].length;

  // Agrupar por termo
  const inventoryByTermo = inventory.reduce((acc, item) => {
    if (!acc[item.termo]) acc[item.termo] = [];
    acc[item.termo].push(item);
    return acc;
  }, {});

  const toggleTermo = (termo) => {
    setExpandedTermos(prev => 
      prev.includes(termo) ? prev.filter(t => t !== termo) : [...prev, termo]
    );
  };

  const filteredToros = toros.filter(t => 
    t.activo && (
      t.codigo.toLowerCase().includes(toroSearch.toLowerCase()) ||
      t.nombre.toLowerCase().includes(toroSearch.toLowerCase())
    )
  );

  const handleSelectToro = (toro) => {
    setForm({ ...form, toroId: toro.id.toString() });
    setToroSearch(`${toro.codigo} - ${toro.nombre}`);
    setShowToroDropdown(false);
  };

  // Función para abrir modal de mover
  const handleOpenMoveModal = (item) => {
    setMovingItem(item);
    setMoveForm({ termo: item.termo.toString(), canastilla: item.canastilla.toString(), cantidad: item.cantidad.toString() });
    setShowMoveModal(true);
  };

  // Función para mover inventario
  const handleMoveInventory = () => {
    const cantidadMover = Number(moveForm.cantidad);
    const nuevoTermo = Number(moveForm.termo);
    const nuevaCanastilla = Number(moveForm.canastilla);
    
    if (cantidadMover <= 0 || cantidadMover > movingItem.cantidad) return;
    
    // Verificar si ya existe un registro en la nueva ubicación con el mismo toro
    const existingInNewLocation = inventory.find(
      i => i.toroId === movingItem.toroId && i.termo === nuevoTermo && i.canastilla === nuevaCanastilla && i.id !== movingItem.id
    );
    
    let updatedInventory = [...inventory];
    
    if (cantidadMover === movingItem.cantidad) {
      // Mover todo
      if (existingInNewLocation) {
        // Sumar a existente y eliminar el original
        updatedInventory = updatedInventory.map(i => {
          if (i.id === existingInNewLocation.id) {
            return { ...i, cantidad: i.cantidad + cantidadMover };
          }
          return i;
        }).filter(i => i.id !== movingItem.id);
      } else {
        // Solo cambiar la ubicación
        updatedInventory = updatedInventory.map(i => {
          if (i.id === movingItem.id) {
            return { ...i, termo: nuevoTermo, canastilla: nuevaCanastilla };
          }
          return i;
        });
      }
    } else {
      // Mover parcialmente
      // Reducir cantidad del original
      updatedInventory = updatedInventory.map(i => {
        if (i.id === movingItem.id) {
          return { ...i, cantidad: i.cantidad - cantidadMover };
        }
        return i;
      });
      
      if (existingInNewLocation) {
        // Sumar a existente
        updatedInventory = updatedInventory.map(i => {
          if (i.id === existingInNewLocation.id) {
            return { ...i, cantidad: i.cantidad + cantidadMover };
          }
          return i;
        });
      } else {
        // Crear nuevo registro
        updatedInventory.push({
          id: Date.now(),
          toroId: movingItem.toroId,
          termo: nuevoTermo,
          canastilla: nuevaCanastilla,
          cantidad: cantidadMover,
          costoUnitario: movingItem.costoUnitario,
        });
      }
    }
    
    setInventory(updatedInventory);
    setShowMoveModal(false);
    setMovingItem(null);
    setMoveForm({ termo: '', canastilla: '', cantidad: '' });
  };

  const handleSaveInventory = () => {
    if (editingItem) {
      setInventory(inventory.map(item => 
        item.id === editingItem.id 
          ? { ...item, toroId: Number(form.toroId), termo: Number(form.termo), canastilla: Number(form.canastilla), cantidad: Number(form.cantidad), costoUnitario: Number(form.costoUnitario) }
          : item
      ));
    } else {
      setInventory([...inventory, {
        id: Date.now(),
        toroId: Number(form.toroId),
        termo: Number(form.termo),
        canastilla: Number(form.canastilla),
        cantidad: Number(form.cantidad),
        costoUnitario: Number(form.costoUnitario),
      }]);
    }
    setShowModal(false);
    setForm({ toroId: '', termo: '', canastilla: '', cantidad: '', costoUnitario: '' });
    setToroSearch('');
    setEditingItem(null);
  };

  const handleSaveNewToro = () => {
    const newToro = {
      id: Date.now(),
      codigo: toroForm.codigo,
      nombre: toroForm.nombre,
      raza: toroForm.raza,
      activo: true,
    };
    setToros([...toros, newToro]);
    setShowToroModal(false);
    setToroForm({ codigo: '', nombre: '', raza: '' });
    // Seleccionar el nuevo toro
    handleSelectToro(newToro);
  };

  const handleEdit = (item) => {
    const toro = getToro(item.toroId);
    setEditingItem(item);
    setForm({
      toroId: item.toroId.toString(),
      termo: item.termo.toString(),
      canastilla: item.canastilla.toString(),
      cantidad: item.cantidad.toString(),
      costoUnitario: item.costoUnitario.toString(),
    });
    setToroSearch(`${toro.codigo} - ${toro.nombre}`);
    setShowModal(true);
  };

  const handleDelete = (id) => {
    if (window.confirm('¿Estás seguro de eliminar este registro?')) {
      setInventory(inventory.filter(item => item.id !== id));
    }
  };

  return (
    <div className="space-y-6">
      <div className="flex items-center justify-between">
        <div>
          <h1 className="text-2xl font-bold text-gray-900">Inventario</h1>
          <p className="text-gray-500 text-sm">Gestión de pajillas por termo y canastilla</p>
        </div>
        <Button onClick={() => { setEditingItem(null); setForm({ toroId: '', termo: '', canastilla: '', cantidad: '', costoUnitario: '' }); setToroSearch(''); setShowModal(true); }}>
          <Icons.Plus /> Agregar Inventario
        </Button>
      </div>

      {/* Stats - 3 en una fila */}
      <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
        <StatCard title="Total Pajillas" value={totalPajillas.toLocaleString()} icon={Icons.Tank} compact />
        <StatCard title="Termos en Uso" value={termosEnUso} icon={Icons.Inventory} compact />
        <StatCard title="Toros Registrados" value={torosRegistrados} icon={Icons.List} compact />
      </div>

      {/* Search and View Toggle */}
      <div className="bg-white rounded-lg border border-gray-200 p-4">
        <div className="flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between">
          <div className="relative flex-1 max-w-md">
            <div className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400">
              <Icons.Search />
            </div>
            <input
              type="text"
              placeholder="Buscar por código, nombre, termo o canastilla..."
              value={searchTerm}
              onChange={(e) => setSearchTerm(e.target.value)}
              className="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500"
            />
          </div>
          <div className="flex items-center gap-1 bg-gray-100 rounded-lg p-1">
            <button
              onClick={() => setViewMode('termo')}
              className={`flex items-center gap-2 px-3 py-1.5 rounded-md text-sm font-medium transition-all ${
                viewMode === 'termo' ? 'bg-white text-gray-900 shadow-sm' : 'text-gray-600 hover:text-gray-900'
              }`}
            >
              <Icons.Tank /> Por Termo
            </button>
            <button
              onClick={() => setViewMode('lista')}
              className={`flex items-center gap-2 px-3 py-1.5 rounded-md text-sm font-medium transition-all ${
                viewMode === 'lista' ? 'bg-white text-gray-900 shadow-sm' : 'text-gray-600 hover:text-gray-900'
              }`}
            >
              <Icons.List /> Lista
            </button>
          </div>
        </div>
      </div>

      {/* Inventory Display */}
      {viewMode === 'termo' ? (
        <div className="space-y-3">
          <p className="text-sm text-gray-500">Items de Inventario ({inventory.length})</p>
          {Object.entries(inventoryByTermo).sort(([a], [b]) => Number(a) - Number(b)).map(([termo, items]) => {
            const termoTotal = items.reduce((s, i) => s + i.cantidad, 0);
            const isExpanded = expandedTermos.includes(Number(termo));
            
            // Crear array de 6 canastillas
            const canastillas = Array.from({ length: 6 }, (_, i) => {
              const canastillaItems = items.filter(item => item.canastilla === i + 1);
              const total = canastillaItems.reduce((s, item) => s + item.cantidad, 0);
              return { numero: i + 1, items: canastillaItems, total };
            });

            return (
              <div key={termo} className="bg-white rounded-lg border border-gray-200 overflow-hidden">
                <button
                  onClick={() => toggleTermo(Number(termo))}
                  className="w-full flex items-center justify-between px-4 py-3 hover:bg-gray-50 transition-colors"
                >
                  <div className="flex items-center gap-3">
                    <div className="w-7 h-7 bg-emerald-600 text-white rounded-lg flex items-center justify-center font-bold text-sm">
                      {termo}
                    </div>
                    <div className="text-left">
                      <h3 className="font-semibold text-gray-900 text-sm">Termo {termo}</h3>
                      <p className="text-xs text-gray-500">{items.length}/6 canastillas · {termoTotal} pajillas</p>
                    </div>
                  </div>
                  <div className="flex items-center gap-3">
                    <Badge variant="emerald">{termoTotal} total</Badge>
                    {isExpanded ? <Icons.ChevronUp /> : <Icons.ChevronDown />}
                  </div>
                </button>
                
                {isExpanded && (
                  <div className="px-4 pb-4 border-t border-gray-100">
                    {/* Grid de canastillas */}
                    <div className="grid grid-cols-6 gap-2 mt-3 mb-3">
                      {canastillas.map((c) => (
                        <div
                          key={c.numero}
                          className={`text-center py-2 px-1 rounded-lg border ${
                            c.total > 0 ? 'bg-emerald-50 border-emerald-200' : 'bg-gray-50 border-gray-200'
                          }`}
                        >
                          <p className="text-xs text-gray-500">C{c.numero}</p>
                          <p className={`text-base font-bold ${c.total > 0 ? 'text-emerald-600' : 'text-gray-400'}`}>
                            {c.total}
                          </p>
                        </div>
                      ))}
                    </div>
                    
                    {/* Lista de items */}
                    <div className="space-y-1.5">
                      {items.map((item) => {
                        const toro = getToro(item.toroId);
                        return (
                          <div key={item.id} className="flex items-center justify-between py-2 px-3 bg-gray-50 rounded-lg">
                            <div className="flex items-center gap-2">
                              <div className="w-6 h-6 bg-gray-200 rounded-full flex items-center justify-center">
                                <Icons.Tank />
                              </div>
                              <div>
                                <p className="font-medium text-gray-900 text-sm">{toro.nombre}</p>
                                <p className="text-xs text-gray-500">{toro.codigo} · Canastilla {item.canastilla}</p>
                              </div>
                            </div>
                            <div className="flex items-center gap-2">
                              <Badge variant="emerald">{item.cantidad} pajillas</Badge>
                              <button onClick={() => handleOpenMoveModal(item)} className="p-1 text-gray-400 hover:text-blue-600 hover:bg-white rounded transition-colors" title="Mover ubicación">
                                <Icons.Move />
                              </button>
                              <button onClick={() => handleEdit(item)} className="p-1 text-gray-400 hover:text-gray-600 hover:bg-white rounded transition-colors" title="Editar">
                                <Icons.Edit />
                              </button>
                            </div>
                          </div>
                        );
                      })}
                    </div>
                  </div>
                )}
              </div>
            );
          })}
        </div>
      ) : (
        <div className="bg-white rounded-lg border border-gray-200 overflow-hidden">
          <div className="overflow-x-auto">
            <table className="w-full">
              <thead>
                <tr className="bg-gray-50 border-b border-gray-200">
                  <th className="text-left px-4 py-2.5 text-xs font-semibold text-gray-500 uppercase">Código</th>
                  <th className="text-left px-4 py-2.5 text-xs font-semibold text-gray-500 uppercase">Nombre</th>
                  <th className="text-center px-4 py-2.5 text-xs font-semibold text-gray-500 uppercase">Termo</th>
                  <th className="text-center px-4 py-2.5 text-xs font-semibold text-gray-500 uppercase">Canastilla</th>
                  <th className="text-center px-4 py-2.5 text-xs font-semibold text-gray-500 uppercase">Cantidad</th>
                  <th className="text-right px-4 py-2.5 text-xs font-semibold text-gray-500 uppercase">Costo Unit.</th>
                  <th className="text-right px-4 py-2.5 text-xs font-semibold text-gray-500 uppercase">Valor Total</th>
                  <th className="text-center px-4 py-2.5 text-xs font-semibold text-gray-500 uppercase">Acciones</th>
                </tr>
              </thead>
              <tbody className="divide-y divide-gray-200">
                {inventory.map((item) => {
                  const toro = getToro(item.toroId);
                  return (
                    <tr key={item.id} className="hover:bg-gray-50 transition-colors">
                      <td className="px-4 py-2.5 text-sm font-mono text-gray-900">{toro.codigo}</td>
                      <td className="px-4 py-2.5 text-sm text-gray-600">{toro.nombre}</td>
                      <td className="px-4 py-2.5 text-center"><Badge variant="emerald">T{item.termo}</Badge></td>
                      <td className="px-4 py-2.5 text-center"><Badge>C{item.canastilla}</Badge></td>
                      <td className="px-4 py-2.5 text-center font-semibold">{item.cantidad}</td>
                      <td className="px-4 py-2.5 text-right text-sm text-gray-500">{formatCurrency(item.costoUnitario)}</td>
                      <td className="px-4 py-2.5 text-right text-sm font-semibold text-emerald-600">{formatCurrency(item.cantidad * item.costoUnitario)}</td>
                      <td className="px-4 py-2.5">
                        <div className="flex justify-center gap-1">
                          <button onClick={() => handleOpenMoveModal(item)} className="p-1 text-gray-400 hover:text-blue-600 hover:bg-blue-50 rounded" title="Mover ubicación">
                            <Icons.Move />
                          </button>
                          <button onClick={() => handleEdit(item)} className="p-1 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded" title="Editar">
                            <Icons.Edit />
                          </button>
                          <button onClick={() => handleDelete(item.id)} className="p-1 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded" title="Eliminar">
                            <Icons.Trash />
                          </button>
                        </div>
                      </td>
                    </tr>
                  );
                })}
              </tbody>
            </table>
          </div>
        </div>
      )}

      {/* Modal Agregar/Editar Inventario */}
      <Modal isOpen={showModal} onClose={() => setShowModal(false)} title={editingItem ? 'Editar Inventario' : 'Agregar Inventario'}>
        <div className="space-y-4">
          {/* Selector de Toro con Autocomplete */}
          <div className="space-y-1">
            <label className="block text-sm font-medium text-gray-700">Toro <span className="text-red-500">*</span></label>
            <div className="relative">
              <input
                type="text"
                value={toroSearch}
                onChange={(e) => { setToroSearch(e.target.value); setShowToroDropdown(true); }}
                onFocus={() => setShowToroDropdown(true)}
                placeholder="Seleccionar o agregar toro..."
                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500"
              />
              {showToroDropdown && (
                <div className="absolute z-10 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-auto">
                  {filteredToros.map((toro) => (
                    <button
                      key={toro.id}
                      onClick={() => handleSelectToro(toro)}
                      className="w-full text-left px-4 py-3 hover:bg-gray-50 border-b border-gray-100 last:border-0"
                    >
                      <p className="font-medium text-gray-900">{toro.codigo}</p>
                      <p className="text-sm text-gray-500">{toro.nombre}</p>
                    </button>
                  ))}
                  <button
                    onClick={() => { setShowToroDropdown(false); setShowToroModal(true); }}
                    className="w-full text-left px-4 py-3 hover:bg-emerald-50 text-emerald-600 font-medium flex items-center gap-2"
                  >
                    <Icons.Plus /> Agregar nuevo toro
                  </button>
                </div>
              )}
            </div>
          </div>

          <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
            <Input label="Termo #" type="number" value={form.termo} onChange={(v) => setForm({...form, termo: v})} min="1" required />
            <Input label="Canastilla #" type="number" value={form.canastilla} onChange={(v) => setForm({...form, canastilla: v})} min="1" required />
          </div>
          <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
            <Input label="Cantidad Pajillas" type="number" value={form.cantidad} onChange={(v) => setForm({...form, cantidad: v})} min="0" required />
            <Input label="Costo Unitario $" type="number" value={form.costoUnitario} onChange={(v) => setForm({...form, costoUnitario: v})} min="0" step="0.01" required />
          </div>

          <div className="flex gap-3 pt-4">
            <Button variant="secondary" onClick={() => setShowModal(false)} className="flex-1">Cancelar</Button>
            <Button onClick={handleSaveInventory} className="flex-1" disabled={!form.toroId || !form.termo || !form.canastilla || !form.cantidad}>
              {editingItem ? 'Actualizar' : 'Guardar'}
            </Button>
          </div>
        </div>
      </Modal>

      {/* Modal Nuevo Toro */}
      <Modal isOpen={showToroModal} onClose={() => setShowToroModal(false)} title="Agregar Nuevo Toro">
        <div className="space-y-4">
          <Input label="Código" value={toroForm.codigo} onChange={(v) => setToroForm({...toroForm, codigo: v})} placeholder="Ej: MS1947" required />
          <Input label="Nombre" value={toroForm.nombre} onChange={(v) => setToroForm({...toroForm, nombre: v})} placeholder="Ej: ATILA" required />
          <Input label="Raza" value={toroForm.raza} onChange={(v) => setToroForm({...toroForm, raza: v})} placeholder="Ej: Brahman" />
          
          <div className="flex gap-3 pt-4">
            <Button variant="secondary" onClick={() => setShowToroModal(false)} className="flex-1">Cancelar</Button>
            <Button onClick={handleSaveNewToro} className="flex-1" disabled={!toroForm.codigo || !toroForm.nombre}>
              Guardar Toro
            </Button>
          </div>
        </div>
      </Modal>

      {/* Modal Mover Ubicación */}
      <Modal isOpen={showMoveModal} onClose={() => setShowMoveModal(false)} title="Mover Ubicación">
        {movingItem && (
          <div className="space-y-4">
            <div className="bg-gray-50 p-3 rounded-lg">
              <p className="text-sm text-gray-500">Moviendo inventario de:</p>
              <p className="font-medium text-gray-900">{getToro(movingItem.toroId).codigo} - {getToro(movingItem.toroId).nombre}</p>
              <p className="text-sm text-gray-500">Ubicación actual: Termo {movingItem.termo}, Canastilla {movingItem.canastilla}</p>
              <p className="text-sm text-gray-500">Cantidad disponible: {movingItem.cantidad} pajillas</p>
            </div>
            
            <Input 
              label="Cantidad a mover" 
              type="number" 
              value={moveForm.cantidad} 
              onChange={(v) => setMoveForm({...moveForm, cantidad: v})} 
              min="1" 
              max={movingItem.cantidad}
              required 
            />
            
            <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
              <Select 
                label="Termo destino" 
                value={moveForm.termo} 
                onChange={(v) => setMoveForm({...moveForm, termo: v})}
                options={[1,2,3,4,5,6,7,8,9,10].map(n => ({ value: n.toString(), label: `Termo ${n}` }))}
                required
              />
              <Select 
                label="Canastilla destino" 
                value={moveForm.canastilla} 
                onChange={(v) => setMoveForm({...moveForm, canastilla: v})}
                options={[1,2,3,4,5,6].map(n => ({ value: n.toString(), label: `Canastilla ${n}` }))}
                required
              />
            </div>
            
            <div className="flex gap-3 pt-4">
              <Button variant="secondary" onClick={() => setShowMoveModal(false)} className="flex-1">Cancelar</Button>
              <Button 
                onClick={handleMoveInventory} 
                className="flex-1" 
                disabled={!moveForm.termo || !moveForm.canastilla || !moveForm.cantidad || Number(moveForm.cantidad) <= 0 || Number(moveForm.cantidad) > movingItem.cantidad}
              >
                <Icons.Move /> Mover
              </Button>
            </div>
          </div>
        )}
      </Modal>
    </div>
  );
};

// Compras Module
const ComprasModule = ({ inventory, setInventory, toros, setToros, proveedores, setProveedores, compras, setCompras, cxp, setCxp }) => {
  const [showModal, setShowModal] = useState(false);
  const [showDetailModal, setShowDetailModal] = useState(false);
  const [showProveedorModal, setShowProveedorModal] = useState(false);
  const [showToroModal, setShowToroModal] = useState(false);
  const [showAbonoModal, setShowAbonoModal] = useState(false);
  const [selectedCompra, setSelectedCompra] = useState(null);
  const [searchTerm, setSearchTerm] = useState('');
  const [currentItemIndex, setCurrentItemIndex] = useState(null);
  const [selectedPeriod, setSelectedPeriod] = useState('all');
  
  // Form state
  const [proveedorId, setProveedorId] = useState('');
  const [proveedorSearch, setProveedorSearch] = useState('');
  const [showProveedorDropdown, setShowProveedorDropdown] = useState(false);
  const [fecha, setFecha] = useState(getTodayISO());
  const [items, setItems] = useState([{ id: 1, toroId: '', toroSearch: '', showToroDropdown: false, cantidad: '', precioUnitario: '', termo: '1', canastilla: '1' }]);
  const [montoPagado, setMontoPagado] = useState('');
  const [notas, setNotas] = useState('');
  
  // Form para nuevo proveedor
  const [nuevoProveedorForm, setNuevoProveedorForm] = useState({ nombre: '', contacto: '', telefono: '', email: '' });
  
  // Form para nuevo toro
  const [nuevoToroForm, setNuevoToroForm] = useState({ codigo: '', nombre: '', raza: '' });
  
  // Form para abono
  const [abonoForm, setAbonoForm] = useState({ monto: '', metodo: 'Transferencia', notas: '' });

  // Filtrar por período
  const comprasFiltradas = filterByPeriod(compras, selectedPeriod);
  
  // Cálculos basados en período seleccionado
  const totalPeriodo = comprasFiltradas.reduce((sum, c) => sum + c.total, 0);
  const pendientePago = comprasFiltradas.reduce((sum, c) => sum + (c.total - c.pagado), 0);

  const getToro = (toroId) => toros.find(t => t.id === toroId) || null;
  const getProveedor = (provId) => proveedores.find(p => p.id === provId) || null;

  const filteredProveedores = proveedores.filter(p => 
    p.activo && p.nombre.toLowerCase().includes(proveedorSearch.toLowerCase())
  );

  const getFilteredToros = (search) => toros.filter(t => 
    t.activo && (t.codigo.toLowerCase().includes(search.toLowerCase()) || t.nombre.toLowerCase().includes(search.toLowerCase()))
  );

  const calcularSubtotal = (item) => {
    const cantidad = Number(item.cantidad) || 0;
    const precio = Number(item.precioUnitario) || 0;
    return cantidad * precio;
  };

  const calcularTotal = () => {
    return items.reduce((sum, item) => sum + calcularSubtotal(item), 0);
  };

  const calcularSaldoPendiente = () => {
    const total = calcularTotal();
    const pagado = Number(montoPagado) || 0;
    return total - pagado;
  };

  const handleSelectProveedor = (prov) => {
    setProveedorId(prov.id.toString());
    setProveedorSearch(prov.nombre);
    setShowProveedorDropdown(false);
  };

  const handleSelectToro = (index, toro) => {
    const newItems = [...items];
    newItems[index].toroId = toro.id.toString();
    newItems[index].toroSearch = `${toro.codigo} - ${toro.nombre}`;
    newItems[index].showToroDropdown = false;
    setItems(newItems);
  };

  const handleItemChange = (index, field, value) => {
    const newItems = [...items];
    newItems[index][field] = value;
    if (field === 'toroSearch') {
      newItems[index].showToroDropdown = true;
    }
    setItems(newItems);
  };
  
  const closeAllToroDropdowns = () => {
    setItems(prev => prev.map(item => ({ ...item, showToroDropdown: false })));
  };

  const addItem = (e) => {
    if (e) e.stopPropagation();
    const newItem = { 
      id: Date.now(), 
      toroId: '', 
      toroSearch: '', 
      showToroDropdown: false, 
      cantidad: '', 
      precioUnitario: '', 
      termo: '1', 
      canastilla: '1' 
    };
    setItems(prev => [...prev, newItem]);
  };

  const removeItem = (index) => {
    if (items.length > 1) {
      setItems(items.filter((_, i) => i !== index));
    }
  };

  const resetForm = () => {
    setProveedorId('');
    setProveedorSearch('');
    setFecha(getTodayISO());
    setItems([{ id: 1, toroId: '', toroSearch: '', showToroDropdown: false, cantidad: '', precioUnitario: '', termo: '1', canastilla: '1' }]);
    setMontoPagado('');
    setNotas('');
  };
  
  const handleSaveNuevoProveedor = () => {
    const newProv = {
      id: Date.now(),
      ...nuevoProveedorForm,
      activo: true,
    };
    setProveedores([...proveedores, newProv]);
    handleSelectProveedor(newProv);
    setShowProveedorModal(false);
    setNuevoProveedorForm({ nombre: '', contacto: '', telefono: '', email: '' });
  };
  
  const handleOpenToroModal = (index) => {
    setCurrentItemIndex(index);
    closeAllToroDropdowns();
    setShowToroModal(true);
  };
  
  const handleSaveNuevoToro = () => {
    const newToro = {
      id: Date.now(),
      ...nuevoToroForm,
      activo: true,
    };
    setToros([...toros, newToro]);
    if (currentItemIndex !== null) {
      handleSelectToro(currentItemIndex, newToro);
    }
    setShowToroModal(false);
    setNuevoToroForm({ codigo: '', nombre: '', raza: '' });
    setCurrentItemIndex(null);
  };
  
  const handleOpenAbonoModal = () => {
    const saldo = selectedCompra.total - selectedCompra.pagado;
    setAbonoForm({ monto: saldo.toString(), metodo: 'Transferencia', notas: '' });
    setShowAbonoModal(true);
  };
  
  const handleSaveAbono = () => {
    const montoAbono = Number(abonoForm.monto);
    if (montoAbono <= 0) return;
    
    const nuevoAbono = {
      id: Date.now(),
      fecha: getTodayISO(),
      monto: montoAbono,
      metodo: abonoForm.metodo,
      notas: abonoForm.notas,
    };
    
    const updatedCompras = compras.map(c => {
      if (c.id === selectedCompra.id) {
        return {
          ...c,
          pagado: c.pagado + montoAbono,
          abonos: [...(c.abonos || []), nuevoAbono],
        };
      }
      return c;
    });
    setCompras(updatedCompras);
    
    const updatedCxp = cxp.map(c => {
      if (c.compraId === selectedCompra.id) {
        return { ...c, pagado: c.pagado + montoAbono };
      }
      return c;
    });
    setCxp(updatedCxp);
    
    setSelectedCompra({
      ...selectedCompra,
      pagado: selectedCompra.pagado + montoAbono,
      abonos: [...(selectedCompra.abonos || []), nuevoAbono],
    });
    
    setShowAbonoModal(false);
    setAbonoForm({ monto: '', metodo: 'Transferencia', notas: '' });
  };

  const handleSaveCompra = () => {
    const total = calcularTotal();
    const pagado = Number(montoPagado) || 0;
    
    const newCompra = {
      id: Date.now(),
      proveedorId: Number(proveedorId),
      fecha,
      items: items.map(item => ({
        toroId: Number(item.toroId),
        cantidad: Number(item.cantidad),
        precioUnitario: Number(item.precioUnitario),
        subtotal: calcularSubtotal(item),
        termo: Number(item.termo),
        canastilla: Number(item.canastilla),
      })),
      total,
      pagado,
      notas,
      abonos: pagado > 0 ? [{ id: Date.now(), fecha, monto: pagado, metodo: 'Pago inicial', notas: '' }] : [],
    };

    setCompras([...compras, newCompra]);

    // Actualizar inventario
    items.forEach(item => {
      const existingIndex = inventory.findIndex(inv => 
        inv.toroId === Number(item.toroId) && 
        inv.termo === Number(item.termo) && 
        inv.canastilla === Number(item.canastilla)
      );

      if (existingIndex >= 0) {
        const newInventory = [...inventory];
        newInventory[existingIndex].cantidad += Number(item.cantidad);
        setInventory(newInventory);
      } else {
        setInventory([...inventory, {
          id: Date.now() + Math.random(),
          toroId: Number(item.toroId),
          termo: Number(item.termo),
          canastilla: Number(item.canastilla),
          cantidad: Number(item.cantidad),
          costoUnitario: Number(item.precioUnitario),
        }]);
      }
    });

    // Si hay saldo pendiente, agregar a CxP
    if (pagado < total) {
      setCxp([...cxp, {
        id: Date.now(),
        compraId: newCompra.id,
        proveedorId: Number(proveedorId),
        monto: total,
        pagado: pagado,
        fecha,
        concepto: `Compra ${items.length} item(s)`,
      }]);
    }

    setShowModal(false);
    resetForm();
  };

  const handleViewDetail = (compra) => {
    setSelectedCompra(compra);
    setShowDetailModal(true);
  };

  const filteredCompras = comprasFiltradas.filter(c => {
    const prov = getProveedor(c.proveedorId);
    return prov?.nombre.toLowerCase().includes(searchTerm.toLowerCase()) ||
           formatDate(c.fecha).toLowerCase().includes(searchTerm.toLowerCase());
  });

  const isFormValid = () => {
    return proveedorId && 
           items.every(item => item.toroId && item.cantidad && item.precioUnitario) &&
           calcularTotal() > 0;
  };

  return (
    <div className="space-y-6">
      <div className="flex items-center justify-between">
        <div>
          <h1 className="text-2xl font-bold text-gray-900">Compras</h1>
          <p className="text-gray-500 text-sm">Registro de compras de semen</p>
        </div>
        <Button onClick={() => { resetForm(); setShowModal(true); }}>
          <Icons.Plus /> Nueva Compra
        </Button>
      </div>

      {/* Stats */}
      <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
        <StatCard title={`Compras ${getPeriodLabel(selectedPeriod)}`} value={formatCurrency(totalPeriodo)} icon={Icons.Cart} compact />
        <StatCard title="Pendiente de Pago" value={formatCurrency(pendientePago)} icon={Icons.CxP} compact />
        <StatCard title="Transacciones" value={comprasFiltradas.length} icon={Icons.List} compact />
        <StatCard title="Proveedores" value={[...new Set(comprasFiltradas.map(c => c.proveedorId))].length} icon={Icons.Users} compact />
      </div>

      {/* Search & Period Filter */}
      <div className="bg-white rounded-lg border border-gray-200 p-4">
        <div className="flex gap-4 items-center">
          <div className="relative flex-1 max-w-md">
            <div className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400">
              <Icons.Search />
            </div>
            <input
              type="text"
              placeholder="Buscar por proveedor o fecha..."
              value={searchTerm}
              onChange={(e) => setSearchTerm(e.target.value)}
              className="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500"
            />
          </div>
          <PeriodFilter selectedPeriod={selectedPeriod} onPeriodChange={setSelectedPeriod} />
        </div>
      </div>

      {/* Lista de Compras */}
      <div className="bg-white rounded-lg border border-gray-200 overflow-hidden">
        <div className="overflow-x-auto">
          <table className="w-full">
            <thead>
              <tr className="bg-gray-50 border-b border-gray-200">
                <th className="text-left px-4 py-2.5 text-xs font-semibold text-gray-500 uppercase">Fecha</th>
                <th className="text-left px-4 py-2.5 text-xs font-semibold text-gray-500 uppercase">Proveedor</th>
                <th className="text-center px-4 py-2.5 text-xs font-semibold text-gray-500 uppercase">Items</th>
                <th className="text-right px-4 py-2.5 text-xs font-semibold text-gray-500 uppercase">Total</th>
                <th className="text-right px-4 py-2.5 text-xs font-semibold text-gray-500 uppercase">Pagado</th>
                <th className="text-right px-4 py-2.5 text-xs font-semibold text-gray-500 uppercase">Saldo</th>
                <th className="text-center px-4 py-2.5 text-xs font-semibold text-gray-500 uppercase">Estado</th>
                <th className="text-center px-4 py-2.5 text-xs font-semibold text-gray-500 uppercase">Acciones</th>
              </tr>
            </thead>
            <tbody className="divide-y divide-gray-200">
              {filteredCompras.length === 0 ? (
                <tr>
                  <td colSpan="8" className="px-4 py-8 text-center text-gray-500">
                    No hay compras registradas
                  </td>
                </tr>
              ) : (
                filteredCompras.map((compra) => {
                  const prov = getProveedor(compra.proveedorId);
                  const saldo = compra.total - compra.pagado;
                  return (
                    <tr key={compra.id} className="hover:bg-gray-50 cursor-pointer" onClick={() => handleViewDetail(compra)}>
                      <td className="px-4 py-2.5 text-sm text-gray-900">{formatDate(compra.fecha)}</td>
                      <td className="px-4 py-2.5 text-sm font-medium text-gray-900">{prov?.nombre || 'Desconocido'}</td>
                      <td className="px-4 py-2.5 text-center text-sm text-gray-500">{compra.items.length}</td>
                      <td className="px-4 py-2.5 text-right text-sm font-medium text-gray-900">{formatCurrency(compra.total)}</td>
                      <td className="px-4 py-2.5 text-right text-sm text-emerald-600">{formatCurrency(compra.pagado)}</td>
                      <td className="px-4 py-2.5 text-right text-sm text-red-600">{formatCurrency(saldo)}</td>
                      <td className="px-4 py-2.5 text-center">
                        <Badge variant={saldo === 0 ? 'success' : 'warning'}>
                          {saldo === 0 ? 'Pagado' : 'Pendiente'}
                        </Badge>
                      </td>
                      <td className="px-4 py-2.5 text-center">
                        <button 
                          onClick={(e) => { e.stopPropagation(); handleViewDetail(compra); }}
                          className="p-1 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded"
                        >
                          <Icons.Eye />
                        </button>
                      </td>
                    </tr>
                  );
                })
              )}
            </tbody>
          </table>
        </div>
      </div>

      {/* Modal Nueva Compra */}
      <Modal isOpen={showModal} onClose={() => setShowModal(false)} title="Nueva Compra" size="lg">
        <div className="space-y-4" onClick={() => { setShowProveedorDropdown(false); closeAllToroDropdowns(); }}>
          {/* Proveedor y Fecha */}
          <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
            <div className="space-y-1">
              <label className="block text-sm font-medium text-gray-700">Proveedor <span className="text-red-500">*</span></label>
              <div className="relative" onClick={(e) => e.stopPropagation()}>
                <input
                  type="text"
                  value={proveedorSearch}
                  onChange={(e) => { setProveedorSearch(e.target.value); setShowProveedorDropdown(true); }}
                  onFocus={() => setShowProveedorDropdown(true)}
                  placeholder="Seleccionar..."
                  className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500"
                />
                {showProveedorDropdown && (
                  <div className="absolute z-50 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-48 overflow-auto">
                    {filteredProveedores.map((prov) => (
                      <button
                        key={prov.id}
                        onClick={() => handleSelectProveedor(prov)}
                        className="w-full text-left px-3 py-2 hover:bg-gray-50 text-sm border-b border-gray-100 last:border-0"
                      >
                        {prov.nombre}
                      </button>
                    ))}
                    <button
                      onClick={() => { setShowProveedorDropdown(false); setShowProveedorModal(true); }}
                      className="w-full text-left px-3 py-2 hover:bg-emerald-50 text-sm text-emerald-600 font-medium flex items-center gap-2 border-t border-gray-200"
                    >
                      <Icons.Plus /> Agregar nuevo proveedor
                    </button>
                  </div>
                )}
              </div>
            </div>
            <Input label="Fecha" type="date" value={fecha} onChange={setFecha} required />
          </div>

          {/* Items */}
          <div className="space-y-2">
            <div className="flex items-center justify-between">
              <label className="block text-sm font-medium text-gray-700">Items (se agregarán al inventario automáticamente)</label>
              <button
                type="button"
                onClick={addItem}
                className="inline-flex items-center gap-1 px-3 py-1.5 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50"
              >
                <Icons.Plus /> Item
              </button>
            </div>
            
            <div className="space-y-3">
              {items.map((item, index) => (
                <div key={item.id} className="border border-gray-200 rounded-lg p-3 bg-gray-50">
                  <div className="flex gap-3 items-start">
                    {/* Toro selector */}
                    <div className="flex-1 relative" onClick={(e) => e.stopPropagation()}>
                      <label className="block text-xs font-medium text-gray-500 mb-1">Toro</label>
                      <input
                        type="text"
                        value={item.toroSearch}
                        onChange={(e) => handleItemChange(index, 'toroSearch', e.target.value)}
                        onFocus={() => {
                          closeAllToroDropdowns();
                          handleItemChange(index, 'showToroDropdown', true);
                        }}
                        placeholder="Seleccionar toro..."
                        className="w-full px-2 py-1.5 border border-gray-300 rounded text-sm focus:outline-none focus:ring-1 focus:ring-emerald-500 bg-white"
                      />
                      {item.showToroDropdown && (
                        <div className="absolute z-50 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-48 overflow-auto">
                          {getFilteredToros(item.toroSearch).map((toro) => (
                            <button
                              key={toro.id}
                              onClick={() => handleSelectToro(index, toro)}
                              className="w-full text-left px-3 py-2 hover:bg-gray-50 text-sm border-b border-gray-100 last:border-0"
                            >
                              <span className="font-mono text-gray-500">{toro.codigo}</span> - {toro.nombre}
                            </button>
                          ))}
                          <button
                            onClick={() => handleOpenToroModal(index)}
                            className="w-full text-left px-3 py-2 hover:bg-emerald-50 text-sm text-emerald-600 font-medium flex items-center gap-2 border-t border-gray-200"
                          >
                            <Icons.Plus /> Agregar nuevo toro
                          </button>
                        </div>
                      )}
                    </div>
                    
                    {/* Cantidad */}
                    <div className="w-20">
                      <label className="block text-xs font-medium text-gray-500 mb-1">Cantidad</label>
                      <input
                        type="number"
                        value={item.cantidad}
                        onChange={(e) => handleItemChange(index, 'cantidad', e.target.value)}
                        min="1"
                        className="w-full px-2 py-1.5 border border-gray-300 rounded text-sm text-center focus:outline-none focus:ring-1 focus:ring-emerald-500 bg-white"
                      />
                    </div>
                    
                    {/* Precio */}
                    <div className="w-24">
                      <label className="block text-xs font-medium text-gray-500 mb-1">Precio Unit.</label>
                      <input
                        type="number"
                        value={item.precioUnitario}
                        onChange={(e) => handleItemChange(index, 'precioUnitario', e.target.value)}
                        min="0"
                        step="0.01"
                        className="w-full px-2 py-1.5 border border-gray-300 rounded text-sm text-center focus:outline-none focus:ring-1 focus:ring-emerald-500 bg-white"
                      />
                    </div>
                    
                    {/* Subtotal */}
                    <div className="w-24 text-right">
                      <label className="block text-xs font-medium text-gray-500 mb-1">Subtotal</label>
                      <p className="py-1.5 text-sm font-semibold text-gray-900">{formatCurrency(calcularSubtotal(item))}</p>
                    </div>
                    
                    {/* Eliminar */}
                    <div className="pt-5">
                      {items.length > 1 && (
                        <button onClick={() => removeItem(index)} className="p-1 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded">
                          <Icons.X />
                        </button>
                      )}
                    </div>
                  </div>
                  
                  {/* Destino: Termo y Canastilla */}
                  {item.toroId && (
                    <div className="flex items-center gap-2 mt-2 pt-2 border-t border-gray-200">
                      <Icons.Tank />
                      <span className="text-xs text-gray-500">Destino:</span>
                      <select 
                        value={item.termo} 
                        onChange={(e) => handleItemChange(index, 'termo', e.target.value)}
                        className="text-xs border border-gray-300 rounded px-2 py-1 bg-white"
                      >
                        {[1,2,3,4,5,6,7,8,9,10].map(n => <option key={n} value={n}>Termo {n}</option>)}
                      </select>
                      <select 
                        value={item.canastilla} 
                        onChange={(e) => handleItemChange(index, 'canastilla', e.target.value)}
                        className="text-xs border border-gray-300 rounded px-2 py-1 bg-white"
                      >
                        {[1,2,3,4,5,6].map(n => <option key={n} value={n}>Canastilla {n}</option>)}
                      </select>
                    </div>
                  )}
                </div>
              ))}
            </div>
          </div>

          {/* Totales */}
          <div className="bg-gray-50 rounded-lg p-4 space-y-2">
            <div className="flex justify-between text-sm">
              <span className="text-gray-600">Total</span>
              <span className="font-bold text-lg">{formatCurrency(calcularTotal())}</span>
            </div>
            <div className="flex items-center justify-between gap-4">
              <span className="text-sm text-gray-600">Monto Pagado</span>
              <input
                type="number"
                value={montoPagado}
                onChange={(e) => setMontoPagado(e.target.value)}
                min="0"
                max={calcularTotal()}
                placeholder="0"
                className="w-32 px-3 py-1.5 border border-gray-300 rounded-lg text-sm text-right focus:outline-none focus:ring-2 focus:ring-emerald-500"
              />
            </div>
            <div className="flex justify-between text-sm pt-2 border-t border-gray-200">
              <span className="text-gray-600">Saldo Pendiente</span>
              <span className={`font-bold ${calcularSaldoPendiente() > 0 ? 'text-red-600' : 'text-emerald-600'}`}>
                {formatCurrency(calcularSaldoPendiente())}
              </span>
            </div>
          </div>

          {/* Notas */}
          <div className="space-y-1">
            <label className="block text-sm font-medium text-gray-700">Notas</label>
            <textarea
              value={notas}
              onChange={(e) => setNotas(e.target.value)}
              placeholder="Notas adicionales..."
              rows="2"
              className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500 resize-none"
            />
          </div>

          <div className="flex gap-3 pt-4">
            <Button variant="secondary" onClick={() => setShowModal(false)} className="flex-1">Cancelar</Button>
            <Button onClick={handleSaveCompra} className="flex-1" disabled={!isFormValid()}>
              Guardar Compra
            </Button>
          </div>
        </div>
      </Modal>
      
      {/* Modal Nuevo Proveedor */}
      <Modal isOpen={showProveedorModal} onClose={() => setShowProveedorModal(false)} title="Agregar Nuevo Proveedor" size="md">
        <div className="space-y-4">
          <Input 
            label="Nombre / Empresa" 
            value={nuevoProveedorForm.nombre} 
            onChange={(v) => setNuevoProveedorForm({...nuevoProveedorForm, nombre: v})} 
            placeholder="Nombre del proveedor" 
            required 
          />
          <Input 
            label="Contacto" 
            value={nuevoProveedorForm.contacto} 
            onChange={(v) => setNuevoProveedorForm({...nuevoProveedorForm, contacto: v})} 
            placeholder="Persona de contacto" 
          />
          <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
            <Input 
              label="Teléfono" 
              value={nuevoProveedorForm.telefono} 
              onChange={(v) => setNuevoProveedorForm({...nuevoProveedorForm, telefono: v})} 
              placeholder="Teléfono" 
            />
            <Input 
              label="Email" 
              type="email" 
              value={nuevoProveedorForm.email} 
              onChange={(v) => setNuevoProveedorForm({...nuevoProveedorForm, email: v})} 
              placeholder="correo@ejemplo.com" 
            />
          </div>
          <div className="flex gap-3 pt-4">
            <Button variant="secondary" onClick={() => setShowProveedorModal(false)} className="flex-1">Cancelar</Button>
            <Button onClick={handleSaveNuevoProveedor} className="flex-1" disabled={!nuevoProveedorForm.nombre}>
              Guardar Proveedor
            </Button>
          </div>
        </div>
      </Modal>
      
      {/* Modal Nuevo Toro */}
      <Modal isOpen={showToroModal} onClose={() => setShowToroModal(false)} title="Agregar Nuevo Toro" size="md">
        <div className="space-y-4">
          <Input 
            label="Código" 
            value={nuevoToroForm.codigo} 
            onChange={(v) => setNuevoToroForm({...nuevoToroForm, codigo: v})} 
            placeholder="Ej: MS1947" 
            required 
          />
          <Input 
            label="Nombre" 
            value={nuevoToroForm.nombre} 
            onChange={(v) => setNuevoToroForm({...nuevoToroForm, nombre: v})} 
            placeholder="Ej: ATILA" 
            required 
          />
          <Input 
            label="Raza" 
            value={nuevoToroForm.raza} 
            onChange={(v) => setNuevoToroForm({...nuevoToroForm, raza: v})} 
            placeholder="Ej: Brahman" 
          />
          <div className="flex gap-3 pt-4">
            <Button variant="secondary" onClick={() => setShowToroModal(false)} className="flex-1">Cancelar</Button>
            <Button onClick={handleSaveNuevoToro} className="flex-1" disabled={!nuevoToroForm.codigo || !nuevoToroForm.nombre}>
              Guardar Toro
            </Button>
          </div>
        </div>
      </Modal>

      {/* Modal Detalle de Compra */}
      <Modal isOpen={showDetailModal} onClose={() => setShowDetailModal(false)} title="Detalle de Compra" size="md">
        {selectedCompra && (
          <div className="space-y-4">
            {/* Header */}
            <div className="grid grid-cols-1 sm:grid-cols-2 gap-4 pb-4 border-b border-gray-200">
              <div>
                <p className="text-xs text-gray-500">Proveedor</p>
                <p className="font-semibold text-gray-900">{getProveedor(selectedCompra.proveedorId)?.nombre}</p>
              </div>
              <div>
                <p className="text-xs text-gray-500">Fecha</p>
                <p className="font-semibold text-gray-900">{formatDate(selectedCompra.fecha)}</p>
              </div>
            </div>

            {/* Items */}
            <div>
              <p className="text-xs text-gray-500 mb-2">Items</p>
              <div className="space-y-2">
                {selectedCompra.items.map((item, idx) => {
                  const toro = getToro(item.toroId);
                  return (
                    <div key={idx} className="flex justify-between items-center py-2 px-3 bg-gray-50 rounded-lg">
                      <div>
                        <p className="font-medium text-gray-900">{toro?.nombre || 'Desconocido'}</p>
                        <p className="text-xs text-gray-500">{toro?.codigo} · {item.cantidad} x {formatCurrency(item.precioUnitario)}</p>
                      </div>
                      <p className="font-semibold">{formatCurrency(item.subtotal)}</p>
                    </div>
                  );
                })}
              </div>
            </div>

            {/* Totales */}
            <div className="bg-gray-50 rounded-lg p-4 space-y-2">
              <div className="flex justify-between text-sm">
                <span className="text-gray-600">Total</span>
                <span className="font-bold">{formatCurrency(selectedCompra.total)}</span>
              </div>
              <div className="flex justify-between text-sm">
                <span className="text-gray-600">Pagado</span>
                <span className="font-bold text-emerald-600">{formatCurrency(selectedCompra.pagado)}</span>
              </div>
              <div className="flex justify-between text-sm pt-2 border-t border-gray-200">
                <span className="text-gray-600">Saldo</span>
                <span className={`font-bold ${selectedCompra.total - selectedCompra.pagado > 0 ? 'text-red-600' : 'text-emerald-600'}`}>
                  {formatCurrency(selectedCompra.total - selectedCompra.pagado)}
                </span>
              </div>
            </div>

            {/* Historial de Abonos */}
            <div>
              <div className="flex items-center justify-between mb-2">
                <p className="text-xs text-gray-500">Historial de Abonos</p>
                {selectedCompra.total - selectedCompra.pagado > 0 && (
                  <button
                    onClick={handleOpenAbonoModal}
                    className="text-xs text-emerald-600 hover:text-emerald-700 font-medium flex items-center gap-1"
                  >
                    <Icons.Plus /> Registrar Abono
                  </button>
                )}
              </div>
              {selectedCompra.abonos && selectedCompra.abonos.length > 0 ? (
                <div className="space-y-2">
                  {selectedCompra.abonos.map((abono, idx) => (
                    <div key={idx} className="flex justify-between items-center py-2 px-3 bg-emerald-50 rounded-lg border border-emerald-100">
                      <div>
                        <p className="font-medium text-emerald-700">{formatCurrency(abono.monto)}</p>
                        <p className="text-xs text-emerald-600">{formatDate(abono.fecha)}{abono.notas ? ` · ${abono.notas}` : ''}</p>
                      </div>
                      <Badge variant="success">{abono.metodo}</Badge>
                    </div>
                  ))}
                </div>
              ) : (
                <p className="text-sm text-gray-400 text-center py-3 bg-gray-50 rounded-lg">Sin abonos registrados</p>
              )}
            </div>

            {/* Notas */}
            {selectedCompra.notas && (
              <div>
                <p className="text-xs text-gray-500 mb-1">Notas</p>
                <p className="text-sm text-gray-700 bg-gray-50 rounded-lg p-3">{selectedCompra.notas}</p>
              </div>
            )}

            <div className="pt-4 flex gap-2">
              <Button 
                variant="primary" 
                onClick={() => generarComprobante('compra', selectedCompra, getProveedor(selectedCompra.proveedorId), selectedCompra.items, getToro, compras.findIndex(c => c.id === selectedCompra.id) + 1)}
                className="flex-1"
              >
                <Icons.Document /> Comprobante
              </Button>
              <Button variant="secondary" onClick={() => setShowDetailModal(false)} className="flex-1">
                Cerrar
              </Button>
            </div>
          </div>
        )}
      </Modal>
      
      {/* Modal Registrar Abono */}
      <Modal isOpen={showAbonoModal} onClose={() => setShowAbonoModal(false)} title="Registrar Abono" size="sm">
        <div className="space-y-4">
          <div className="bg-gray-50 rounded-lg p-3 text-center">
            <p className="text-xs text-gray-500">Saldo pendiente</p>
            <p className="text-xl font-bold text-red-600">
              {selectedCompra && formatCurrency(selectedCompra.total - selectedCompra.pagado)}
            </p>
          </div>
          
          <Input 
            label="Monto del Abono" 
            type="number"
            value={abonoForm.monto} 
            onChange={(v) => setAbonoForm({...abonoForm, monto: v})} 
            placeholder="0" 
            required 
          />
          
          <Select 
            label="Método de Pago" 
            value={abonoForm.metodo} 
            onChange={(v) => setAbonoForm({...abonoForm, metodo: v})}
            options={[
              { value: 'Transferencia', label: 'Transferencia' },
              { value: 'Efectivo', label: 'Efectivo' },
              { value: 'Cheque', label: 'Cheque' },
              { value: 'Tarjeta', label: 'Tarjeta' },
              { value: 'Otro', label: 'Otro' },
            ]}
          />
          
          <div className="space-y-1">
            <label className="block text-sm font-medium text-gray-700">Notas / Referencia</label>
            <input
              type="text"
              value={abonoForm.notas}
              onChange={(e) => setAbonoForm({...abonoForm, notas: e.target.value})}
              placeholder="Ej: Transferencia #12345"
              className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500"
            />
          </div>
          
          <div className="flex gap-3 pt-4">
            <Button variant="secondary" onClick={() => setShowAbonoModal(false)} className="flex-1">Cancelar</Button>
            <Button onClick={handleSaveAbono} className="flex-1" disabled={!abonoForm.monto || Number(abonoForm.monto) <= 0}>
              Registrar Abono
            </Button>
          </div>
        </div>
      </Modal>
    </div>
  );
};

// Ventas Module
const VentasModule = ({ inventory, setInventory, toros, clientes, setClientes, ventas, setVentas, cxc, setCxc }) => {
  const [showModal, setShowModal] = useState(false);
  const [showDetailModal, setShowDetailModal] = useState(false);
  const [showClienteModal, setShowClienteModal] = useState(false);
  const [showAbonoModal, setShowAbonoModal] = useState(false);
  const [selectedVenta, setSelectedVenta] = useState(null);
  const [searchTerm, setSearchTerm] = useState('');
  const [selectedPeriod, setSelectedPeriod] = useState('all');
  
  // Form state
  const [clienteId, setClienteId] = useState('');
  const [clienteSearch, setClienteSearch] = useState('');
  const [showClienteDropdown, setShowClienteDropdown] = useState(false);
  const [fecha, setFecha] = useState(getTodayISO());
  const [items, setItems] = useState([{ id: 1, toroId: '', toroSearch: '', showToroDropdown: false, inventoryId: '', cantidad: '', precioUnitario: '', stockDisponible: 0, ubicaciones: [] }]);
  const [montoCobrado, setMontoCobrado] = useState('');
  const [notas, setNotas] = useState('');
  
  // Form para nuevo cliente
  const [nuevoClienteForm, setNuevoClienteForm] = useState({ nombre: '', contacto: '', telefono: '', email: '' });
  
  // Form para abono
  const [abonoForm, setAbonoForm] = useState({ monto: '', metodo: 'Transferencia', notas: '' });

  // Filtrar por período
  const ventasFiltradas = filterByPeriod(ventas, selectedPeriod);
  
  // Cálculos basados en período seleccionado
  const totalPeriodo = ventasFiltradas.reduce((sum, v) => sum + v.total, 0);
  const pendienteCobro = ventasFiltradas.reduce((sum, v) => sum + (v.total - v.cobrado), 0);

  const getToro = (toroId) => toros.find(t => t.id === toroId) || null;
  const getCliente = (cliId) => clientes.find(c => c.id === cliId) || null;
  
  // Calcular stock disponible de un toro
  const getStockDisponible = (toroId) => {
    return inventory
      .filter(inv => inv.toroId === toroId)
      .reduce((sum, inv) => sum + inv.cantidad, 0);
  };

  const filteredClientes = clientes.filter(c => 
    c.activo && c.nombre.toLowerCase().includes(clienteSearch.toLowerCase())
  );

  const getFilteredToros = (search) => {
    const torosConStock = toros.filter(t => {
      if (!t.activo) return false;
      const stock = getStockDisponible(t.id);
      if (stock <= 0) return false;
      return t.codigo.toLowerCase().includes(search.toLowerCase()) || 
             t.nombre.toLowerCase().includes(search.toLowerCase());
    });
    return torosConStock;
  };

  const calcularSubtotal = (item) => {
    const cantidad = Number(item.cantidad) || 0;
    const precio = Number(item.precioUnitario) || 0;
    return cantidad * precio;
  };

  const calcularTotal = () => {
    return items.reduce((sum, item) => sum + calcularSubtotal(item), 0);
  };

  const calcularSaldoPendiente = () => {
    const total = calcularTotal();
    const cobrado = Number(montoCobrado) || 0;
    return total - cobrado;
  };

  const handleSelectCliente = (cli) => {
    setClienteId(cli.id.toString());
    setClienteSearch(cli.nombre);
    setShowClienteDropdown(false);
  };

  const handleSelectToro = (index, toro) => {
    const stock = getStockDisponible(toro.id);
    // Obtener ubicaciones disponibles del toro
    const ubicaciones = inventory
      .filter(inv => inv.toroId === toro.id && inv.cantidad > 0)
      .map(inv => ({
        inventoryId: inv.id,
        termo: inv.termo,
        canastilla: inv.canastilla,
        cantidad: inv.cantidad
      }));
    
    const newItems = [...items];
    newItems[index].toroId = toro.id.toString();
    newItems[index].toroSearch = `${toro.codigo} - ${toro.nombre}`;
    newItems[index].showToroDropdown = false;
    newItems[index].stockDisponible = stock;
    newItems[index].ubicaciones = ubicaciones;
    newItems[index].inventoryId = ubicaciones.length === 1 ? ubicaciones[0].inventoryId.toString() : '';
    setItems(newItems);
  };

  const handleItemChange = (index, field, value) => {
    const newItems = [...items];
    newItems[index][field] = value;
    if (field === 'toroSearch') {
      newItems[index].showToroDropdown = true;
    }
    setItems(newItems);
  };
  
  const closeAllToroDropdowns = () => {
    setItems(prev => prev.map(item => ({ ...item, showToroDropdown: false })));
  };

  const addItem = (e) => {
    if (e) e.stopPropagation();
    const newItem = { 
      id: Date.now(), 
      toroId: '', 
      toroSearch: '', 
      showToroDropdown: false, 
      inventoryId: '',
      cantidad: '', 
      precioUnitario: '',
      stockDisponible: 0,
      ubicaciones: []
    };
    setItems(prev => [...prev, newItem]);
  };

  const removeItem = (index) => {
    if (items.length > 1) {
      setItems(prev => prev.filter((_, i) => i !== index));
    }
  };

  const resetForm = () => {
    setClienteId('');
    setClienteSearch('');
    setFecha(getTodayISO());
    setItems([{ id: 1, toroId: '', toroSearch: '', showToroDropdown: false, inventoryId: '', cantidad: '', precioUnitario: '', stockDisponible: 0, ubicaciones: [] }]);
    setMontoCobrado('');
    setNotas('');
  };
  
  // Obtener stock disponible de una ubicación específica
  const getStockUbicacion = (inventoryId) => {
    const inv = inventory.find(i => i.id === Number(inventoryId));
    return inv ? inv.cantidad : 0;
  };
  
  const handleSaveNuevoCliente = () => {
    const newCli = {
      id: Date.now(),
      ...nuevoClienteForm,
      activo: true,
    };
    setClientes([...clientes, newCli]);
    handleSelectCliente(newCli);
    setShowClienteModal(false);
    setNuevoClienteForm({ nombre: '', contacto: '', telefono: '', email: '' });
  };

  const handleSaveVenta = () => {
    const total = calcularTotal();
    const cobrado = Number(montoCobrado) || 0;
    
    const newVenta = {
      id: Date.now(),
      clienteId: Number(clienteId),
      fecha,
      items: items.map(item => {
        const inv = inventory.find(i => i.id === Number(item.inventoryId));
        return {
          toroId: Number(item.toroId),
          inventoryId: Number(item.inventoryId),
          termo: inv?.termo,
          canastilla: inv?.canastilla,
          cantidad: Number(item.cantidad),
          precioUnitario: Number(item.precioUnitario),
          subtotal: calcularSubtotal(item),
        };
      }),
      total,
      cobrado,
      notas,
      abonos: cobrado > 0 ? [{ id: Date.now(), fecha, monto: cobrado, metodo: 'Pago inicial', notas: '' }] : [],
    };

    setVentas([...ventas, newVenta]);

    // Descontar del inventario (de la ubicación específica seleccionada)
    let newInventory = [...inventory];
    
    items.forEach(item => {
      const cantidadADescontar = Number(item.cantidad);
      const inventoryId = Number(item.inventoryId);
      
      const invIndex = newInventory.findIndex(i => i.id === inventoryId);
      if (invIndex >= 0) {
        const nuevaCantidad = newInventory[invIndex].cantidad - cantidadADescontar;
        if (nuevaCantidad <= 0) {
          // Eliminar si queda en 0
          newInventory = newInventory.filter(i => i.id !== inventoryId);
        } else {
          newInventory[invIndex] = {
            ...newInventory[invIndex],
            cantidad: nuevaCantidad
          };
        }
      }
    });
    
    setInventory(newInventory);

    // Si hay saldo pendiente, agregar a CxC
    if (cobrado < total) {
      setCxc(prev => [...prev, {
        id: Date.now(),
        ventaId: newVenta.id,
        clienteId: Number(clienteId),
        monto: total,
        cobrado: cobrado,
        fecha,
        concepto: `Venta ${items.length} item(s)`,
      }]);
    }

    setShowModal(false);
    resetForm();
  };

  const handleViewDetail = (venta) => {
    setSelectedVenta(venta);
    setShowDetailModal(true);
  };
  
  const handleOpenAbonoModal = () => {
    const saldo = selectedVenta.total - selectedVenta.cobrado;
    setAbonoForm({ monto: saldo.toString(), metodo: 'Transferencia', notas: '' });
    setShowAbonoModal(true);
  };
  
  const handleSaveAbono = () => {
    const montoAbono = Number(abonoForm.monto);
    if (montoAbono <= 0) return;
    
    const nuevoAbono = {
      id: Date.now(),
      fecha: getTodayISO(),
      monto: montoAbono,
      metodo: abonoForm.metodo,
      notas: abonoForm.notas,
    };
    
    const updatedVentas = ventas.map(v => {
      if (v.id === selectedVenta.id) {
        return {
          ...v,
          cobrado: v.cobrado + montoAbono,
          abonos: [...(v.abonos || []), nuevoAbono],
        };
      }
      return v;
    });
    setVentas(updatedVentas);
    
    const updatedCxc = cxc.map(c => {
      if (c.ventaId === selectedVenta.id) {
        return { ...c, cobrado: c.cobrado + montoAbono };
      }
      return c;
    });
    setCxc(updatedCxc);
    
    setSelectedVenta({
      ...selectedVenta,
      cobrado: selectedVenta.cobrado + montoAbono,
      abonos: [...(selectedVenta.abonos || []), nuevoAbono],
    });
    
    setShowAbonoModal(false);
    setAbonoForm({ monto: '', metodo: 'Transferencia', notas: '' });
  };

  const filteredVentas = ventasFiltradas.filter(v => {
    const cli = getCliente(v.clienteId);
    return cli?.nombre.toLowerCase().includes(searchTerm.toLowerCase()) ||
           formatDate(v.fecha).toLowerCase().includes(searchTerm.toLowerCase());
  });

  const isFormValid = () => {
    return clienteId && 
           items.every(item => {
             const cantidad = Number(item.cantidad);
             const stockUbicacion = getStockUbicacion(item.inventoryId);
             return item.toroId && item.inventoryId && cantidad > 0 && cantidad <= stockUbicacion && item.precioUnitario;
           }) &&
           calcularTotal() > 0;
  };

  return (
    <div className="space-y-6">
      <div className="flex items-center justify-between">
        <div>
          <h1 className="text-2xl font-bold text-gray-900">Ventas</h1>
          <p className="text-gray-500 text-sm">Registro de ventas de semen</p>
        </div>
        <Button onClick={() => { resetForm(); setShowModal(true); }}>
          <Icons.Plus /> Nueva Venta
        </Button>
      </div>

      {/* Stats */}
      <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
        <StatCard title={`Ventas ${getPeriodLabel(selectedPeriod)}`} value={formatCurrency(totalPeriodo)} icon={Icons.Transactions} compact />
        <StatCard title="Pendiente de Cobro" value={formatCurrency(pendienteCobro)} icon={Icons.CxC} compact />
        <StatCard title="Transacciones" value={ventasFiltradas.length} icon={Icons.List} compact />
        <StatCard title="Clientes" value={[...new Set(ventasFiltradas.map(v => v.clienteId))].length} icon={Icons.Users} compact />
      </div>

      {/* Search & Period Filter */}
      <div className="bg-white rounded-lg border border-gray-200 p-4">
        <div className="flex gap-4 items-center">
          <div className="relative flex-1 max-w-md">
            <div className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400">
              <Icons.Search />
            </div>
            <input
              type="text"
              placeholder="Buscar por cliente o fecha..."
              value={searchTerm}
              onChange={(e) => setSearchTerm(e.target.value)}
              className="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500"
            />
          </div>
          <PeriodFilter selectedPeriod={selectedPeriod} onPeriodChange={setSelectedPeriod} />
        </div>
      </div>

      {/* Lista de Ventas */}
      <div className="bg-white rounded-lg border border-gray-200 overflow-hidden">
        <div className="overflow-x-auto">
          <table className="w-full">
            <thead>
              <tr className="bg-gray-50 border-b border-gray-200">
                <th className="text-left px-4 py-2.5 text-xs font-semibold text-gray-500 uppercase">Fecha</th>
                <th className="text-left px-4 py-2.5 text-xs font-semibold text-gray-500 uppercase">Cliente</th>
                <th className="text-center px-4 py-2.5 text-xs font-semibold text-gray-500 uppercase">Items</th>
                <th className="text-right px-4 py-2.5 text-xs font-semibold text-gray-500 uppercase">Total</th>
                <th className="text-right px-4 py-2.5 text-xs font-semibold text-gray-500 uppercase">Cobrado</th>
                <th className="text-right px-4 py-2.5 text-xs font-semibold text-gray-500 uppercase">Saldo</th>
                <th className="text-center px-4 py-2.5 text-xs font-semibold text-gray-500 uppercase">Estado</th>
                <th className="text-center px-4 py-2.5 text-xs font-semibold text-gray-500 uppercase">Acciones</th>
              </tr>
            </thead>
            <tbody className="divide-y divide-gray-200">
              {filteredVentas.length === 0 ? (
                <tr>
                  <td colSpan="8" className="px-4 py-8 text-center text-gray-500">
                    No hay ventas registradas
                  </td>
                </tr>
              ) : (
                filteredVentas.map((venta) => {
                  const cli = getCliente(venta.clienteId);
                  const saldo = venta.total - venta.cobrado;
                  return (
                    <tr key={venta.id} className="hover:bg-gray-50 cursor-pointer" onClick={() => handleViewDetail(venta)}>
                      <td className="px-4 py-2.5 text-sm text-gray-900">{formatDate(venta.fecha)}</td>
                      <td className="px-4 py-2.5 text-sm font-medium text-gray-900">{cli?.nombre || 'Desconocido'}</td>
                      <td className="px-4 py-2.5 text-center text-sm text-gray-500">{venta.items.length}</td>
                      <td className="px-4 py-2.5 text-right text-sm font-medium text-gray-900">{formatCurrency(venta.total)}</td>
                      <td className="px-4 py-2.5 text-right text-sm text-emerald-600">{formatCurrency(venta.cobrado)}</td>
                      <td className="px-4 py-2.5 text-right text-sm text-red-600">{formatCurrency(saldo)}</td>
                      <td className="px-4 py-2.5 text-center">
                        <Badge variant={saldo === 0 ? 'success' : 'warning'}>
                          {saldo === 0 ? 'Cobrado' : 'Pendiente'}
                        </Badge>
                      </td>
                      <td className="px-4 py-2.5 text-center">
                        <button 
                          onClick={(e) => { e.stopPropagation(); handleViewDetail(venta); }}
                          className="p-1 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded"
                        >
                          <Icons.Eye />
                        </button>
                      </td>
                    </tr>
                  );
                })
              )}
            </tbody>
          </table>
        </div>
      </div>

      {/* Modal Nueva Venta */}
      <Modal isOpen={showModal} onClose={() => setShowModal(false)} title="Nueva Venta" size="lg">
        <div className="space-y-4" onClick={() => { setShowClienteDropdown(false); closeAllToroDropdowns(); }}>
          {/* Cliente y Fecha */}
          <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
            <div className="space-y-1">
              <label className="block text-sm font-medium text-gray-700">Cliente <span className="text-red-500">*</span></label>
              <div className="relative" onClick={(e) => e.stopPropagation()}>
                <input
                  type="text"
                  value={clienteSearch}
                  onChange={(e) => { setClienteSearch(e.target.value); setShowClienteDropdown(true); }}
                  onFocus={() => setShowClienteDropdown(true)}
                  placeholder="Seleccionar..."
                  className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500"
                />
                {showClienteDropdown && (
                  <div className="absolute z-50 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-48 overflow-auto">
                    {filteredClientes.map((cli) => (
                      <button
                        key={cli.id}
                        onClick={() => handleSelectCliente(cli)}
                        className="w-full text-left px-3 py-2 hover:bg-gray-50 text-sm border-b border-gray-100 last:border-0"
                      >
                        {cli.nombre}
                      </button>
                    ))}
                    <button
                      onClick={() => { setShowClienteDropdown(false); setShowClienteModal(true); }}
                      className="w-full text-left px-3 py-2 hover:bg-emerald-50 text-sm text-emerald-600 font-medium flex items-center gap-2 border-t border-gray-200"
                    >
                      <Icons.Plus /> Agregar nuevo cliente
                    </button>
                  </div>
                )}
              </div>
            </div>
            <Input label="Fecha" type="date" value={fecha} onChange={setFecha} required />
          </div>

          {/* Items */}
          <div className="space-y-2">
            <div className="flex items-center justify-between">
              <label className="block text-sm font-medium text-gray-700">Items (se descontarán del inventario)</label>
              <button
                type="button"
                onClick={addItem}
                className="inline-flex items-center gap-1 px-3 py-1.5 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50"
              >
                <Icons.Plus /> Item
              </button>
            </div>
            
            <div className="space-y-3">
              {items.map((item, index) => (
                <div key={item.id} className="border border-gray-200 rounded-lg p-3 bg-gray-50">
                  <div className="flex gap-3 items-start">
                    {/* Toro selector */}
                    <div className="w-56 relative" onClick={(e) => e.stopPropagation()}>
                      <label className="block text-xs font-medium text-gray-500 mb-1">Toro</label>
                      <input
                        type="text"
                        value={item.toroSearch}
                        onChange={(e) => handleItemChange(index, 'toroSearch', e.target.value)}
                        onFocus={() => {
                          closeAllToroDropdowns();
                          setTimeout(() => handleItemChange(index, 'showToroDropdown', true), 10);
                        }}
                        placeholder="Seleccionar toro..."
                        className="w-full px-2 py-1.5 border border-gray-300 rounded text-sm focus:outline-none focus:ring-1 focus:ring-emerald-500 bg-white"
                      />
                      {item.showToroDropdown && (
                        <div className="absolute z-50 w-72 mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-48 overflow-auto">
                          {getFilteredToros(item.toroSearch).length === 0 ? (
                            <p className="px-3 py-2 text-sm text-gray-500">No hay toros con stock disponible</p>
                          ) : (
                            getFilteredToros(item.toroSearch).map((toro) => {
                              const stock = getStockDisponible(toro.id);
                              return (
                                <button
                                  key={toro.id}
                                  onClick={() => handleSelectToro(index, toro)}
                                  className="w-full text-left px-3 py-2 hover:bg-gray-50 text-sm border-b border-gray-100 last:border-0 flex justify-between items-center gap-2"
                                >
                                  <span className="truncate">
                                    <span className="font-mono text-gray-500">{toro.codigo}</span> - {toro.nombre}
                                  </span>
                                  <span className="text-xs bg-emerald-100 text-emerald-700 px-2 py-0.5 rounded-full whitespace-nowrap">
                                    {stock}
                                  </span>
                                </button>
                              );
                            })
                          )}
                        </div>
                      )}
                      {item.toroId && (
                        <p className="mt-1 text-xs text-emerald-600 flex items-center gap-1">
                          <Icons.Check /> Disponible: {item.stockDisponible}
                        </p>
                      )}
                    </div>
                    
                    {/* Ubicación */}
                    <div className="w-28">
                      <label className="block text-xs font-medium text-gray-500 mb-1">Ubicación *</label>
                      <select
                        value={item.inventoryId}
                        onChange={(e) => handleItemChange(index, 'inventoryId', e.target.value)}
                        disabled={!item.toroId}
                        className="w-full px-2 py-1.5 border border-gray-300 rounded text-sm focus:outline-none focus:ring-1 focus:ring-emerald-500 bg-white disabled:bg-gray-100"
                      >
                        <option value="">Selec...</option>
                        {item.ubicaciones && item.ubicaciones.map(ub => (
                          <option key={ub.inventoryId} value={ub.inventoryId}>
                            T{ub.termo}-C{ub.canastilla} ({ub.cantidad})
                          </option>
                        ))}
                      </select>
                    </div>
                    
                    {/* Cantidad */}
                    <div className="w-20">
                      <label className="block text-xs font-medium text-gray-500 mb-1">Cantidad</label>
                      <input
                        type="number"
                        value={item.cantidad}
                        onChange={(e) => handleItemChange(index, 'cantidad', e.target.value)}
                        min="1"
                        max={getStockUbicacion(item.inventoryId)}
                        disabled={!item.inventoryId}
                        className={`w-full px-2 py-1.5 border rounded text-sm text-center focus:outline-none focus:ring-1 focus:ring-emerald-500 bg-white disabled:bg-gray-100 ${
                          item.cantidad && Number(item.cantidad) > getStockUbicacion(item.inventoryId) 
                            ? 'border-red-500 bg-red-50' 
                            : 'border-gray-300'
                        }`}
                      />
                      {item.cantidad && Number(item.cantidad) > getStockUbicacion(item.inventoryId) && (
                        <p className="text-xs text-red-500 mt-1">Excede stock</p>
                      )}
                    </div>
                    
                    {/* Precio */}
                    <div className="w-24">
                      <label className="block text-xs font-medium text-gray-500 mb-1">Precio Unit.</label>
                      <input
                        type="number"
                        value={item.precioUnitario}
                        onChange={(e) => handleItemChange(index, 'precioUnitario', e.target.value)}
                        min="0"
                        step="0.01"
                        className="w-full px-2 py-1.5 border border-gray-300 rounded text-sm text-center focus:outline-none focus:ring-1 focus:ring-emerald-500 bg-white"
                      />
                    </div>
                    
                    {/* Subtotal */}
                    <div className="w-24 text-right">
                      <label className="block text-xs font-medium text-gray-500 mb-1">Subtotal</label>
                      <p className="py-1.5 text-sm font-semibold text-gray-900">{formatCurrency(calcularSubtotal(item))}</p>
                    </div>
                    
                    {/* Eliminar */}
                    <div className="pt-5">
                      {items.length > 1 && (
                        <button 
                          type="button"
                          onClick={(e) => { e.stopPropagation(); removeItem(index); }} 
                          className="p-1 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded"
                        >
                          <Icons.X />
                        </button>
                      )}
                    </div>
                  </div>
                </div>
              ))}
            </div>
          </div>

          {/* Totales */}
          <div className="bg-gray-50 rounded-lg p-4 space-y-2">
            <div className="flex justify-between text-sm">
              <span className="text-gray-600">Total</span>
              <span className="font-bold text-lg">{formatCurrency(calcularTotal())}</span>
            </div>
            <div className="flex items-center justify-between gap-4">
              <span className="text-sm text-gray-600">Monto Cobrado</span>
              <input
                type="number"
                value={montoCobrado}
                onChange={(e) => setMontoCobrado(e.target.value)}
                min="0"
                max={calcularTotal()}
                placeholder="0"
                className="w-32 px-3 py-1.5 border border-gray-300 rounded-lg text-sm text-right focus:outline-none focus:ring-2 focus:ring-emerald-500"
              />
            </div>
            <div className="flex justify-between text-sm pt-2 border-t border-gray-200">
              <span className="text-gray-600">Saldo Pendiente</span>
              <span className={`font-bold ${calcularSaldoPendiente() > 0 ? 'text-red-600' : 'text-emerald-600'}`}>
                {formatCurrency(calcularSaldoPendiente())}
              </span>
            </div>
          </div>

          {/* Notas */}
          <div className="space-y-1">
            <label className="block text-sm font-medium text-gray-700">Notas</label>
            <textarea
              value={notas}
              onChange={(e) => setNotas(e.target.value)}
              placeholder="Notas adicionales..."
              rows="2"
              className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500 resize-none"
            />
          </div>

          <div className="flex gap-3 pt-4">
            <Button variant="secondary" onClick={() => setShowModal(false)} className="flex-1">Cancelar</Button>
            <Button onClick={handleSaveVenta} className="flex-1" disabled={!isFormValid()}>
              Guardar Venta
            </Button>
          </div>
        </div>
      </Modal>
      
      {/* Modal Nuevo Cliente */}
      <Modal isOpen={showClienteModal} onClose={() => setShowClienteModal(false)} title="Agregar Nuevo Cliente" size="md">
        <div className="space-y-4">
          <Input 
            label="Nombre / Empresa" 
            value={nuevoClienteForm.nombre} 
            onChange={(v) => setNuevoClienteForm({...nuevoClienteForm, nombre: v})} 
            placeholder="Nombre del cliente" 
            required 
          />
          <Input 
            label="Contacto" 
            value={nuevoClienteForm.contacto} 
            onChange={(v) => setNuevoClienteForm({...nuevoClienteForm, contacto: v})} 
            placeholder="Persona de contacto" 
          />
          <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
            <Input 
              label="Teléfono" 
              value={nuevoClienteForm.telefono} 
              onChange={(v) => setNuevoClienteForm({...nuevoClienteForm, telefono: v})} 
              placeholder="Teléfono" 
            />
            <Input 
              label="Email" 
              type="email" 
              value={nuevoClienteForm.email} 
              onChange={(v) => setNuevoClienteForm({...nuevoClienteForm, email: v})} 
              placeholder="correo@ejemplo.com" 
            />
          </div>
          <div className="flex gap-3 pt-4">
            <Button variant="secondary" onClick={() => setShowClienteModal(false)} className="flex-1">Cancelar</Button>
            <Button onClick={handleSaveNuevoCliente} className="flex-1" disabled={!nuevoClienteForm.nombre}>
              Guardar Cliente
            </Button>
          </div>
        </div>
      </Modal>

      {/* Modal Detalle de Venta */}
      <Modal isOpen={showDetailModal} onClose={() => setShowDetailModal(false)} title="Detalle de Venta" size="md">
        {selectedVenta && (
          <div className="space-y-4">
            {/* Header */}
            <div className="grid grid-cols-1 sm:grid-cols-2 gap-4 pb-4 border-b border-gray-200">
              <div>
                <p className="text-xs text-gray-500">Cliente</p>
                <p className="font-semibold text-gray-900">{getCliente(selectedVenta.clienteId)?.nombre}</p>
              </div>
              <div>
                <p className="text-xs text-gray-500">Fecha</p>
                <p className="font-semibold text-gray-900">{formatDate(selectedVenta.fecha)}</p>
              </div>
            </div>

            {/* Items */}
            <div>
              <p className="text-xs text-gray-500 mb-2">Items</p>
              <div className="space-y-2">
                {selectedVenta.items.map((item, idx) => {
                  const toro = getToro(item.toroId);
                  return (
                    <div key={idx} className="flex justify-between items-center py-2 px-3 bg-gray-50 rounded-lg">
                      <div>
                        <p className="font-medium text-gray-900">{toro?.nombre || 'Desconocido'}</p>
                        <p className="text-xs text-gray-500">{toro?.codigo} · {item.cantidad} x {formatCurrency(item.precioUnitario)}</p>
                      </div>
                      <p className="font-semibold">{formatCurrency(item.subtotal)}</p>
                    </div>
                  );
                })}
              </div>
            </div>

            {/* Totales */}
            <div className="bg-gray-50 rounded-lg p-4 space-y-2">
              <div className="flex justify-between text-sm">
                <span className="text-gray-600">Total</span>
                <span className="font-bold">{formatCurrency(selectedVenta.total)}</span>
              </div>
              <div className="flex justify-between text-sm">
                <span className="text-gray-600">Cobrado</span>
                <span className="font-bold text-emerald-600">{formatCurrency(selectedVenta.cobrado)}</span>
              </div>
              <div className="flex justify-between text-sm pt-2 border-t border-gray-200">
                <span className="text-gray-600">Saldo</span>
                <span className={`font-bold ${selectedVenta.total - selectedVenta.cobrado > 0 ? 'text-red-600' : 'text-emerald-600'}`}>
                  {formatCurrency(selectedVenta.total - selectedVenta.cobrado)}
                </span>
              </div>
            </div>

            {/* Historial de Abonos */}
            <div>
              <div className="flex items-center justify-between mb-2">
                <p className="text-xs text-gray-500">Historial de Cobros</p>
                {selectedVenta.total - selectedVenta.cobrado > 0 && (
                  <button
                    onClick={handleOpenAbonoModal}
                    className="text-xs text-emerald-600 hover:text-emerald-700 font-medium flex items-center gap-1"
                  >
                    <Icons.Plus /> Registrar Cobro
                  </button>
                )}
              </div>
              {selectedVenta.abonos && selectedVenta.abonos.length > 0 ? (
                <div className="space-y-2">
                  {selectedVenta.abonos.map((abono, idx) => (
                    <div key={idx} className="flex justify-between items-center py-2 px-3 bg-emerald-50 rounded-lg border border-emerald-100">
                      <div>
                        <p className="font-medium text-emerald-700">{formatCurrency(abono.monto)}</p>
                        <p className="text-xs text-emerald-600">{formatDate(abono.fecha)}{abono.notas ? ` · ${abono.notas}` : ''}</p>
                      </div>
                      <Badge variant="success">{abono.metodo}</Badge>
                    </div>
                  ))}
                </div>
              ) : (
                <p className="text-sm text-gray-400 text-center py-3 bg-gray-50 rounded-lg">Sin cobros registrados</p>
              )}
            </div>

            {/* Notas */}
            {selectedVenta.notas && (
              <div>
                <p className="text-xs text-gray-500 mb-1">Notas</p>
                <p className="text-sm text-gray-700 bg-gray-50 rounded-lg p-3">{selectedVenta.notas}</p>
              </div>
            )}

            <div className="pt-4 flex gap-2">
              <Button 
                variant="primary" 
                onClick={() => generarComprobante('venta', selectedVenta, getCliente(selectedVenta.clienteId), selectedVenta.items, getToro, ventas.findIndex(v => v.id === selectedVenta.id) + 1)}
                className="flex-1"
              >
                <Icons.Document /> Comprobante
              </Button>
              <Button variant="secondary" onClick={() => setShowDetailModal(false)} className="flex-1">
                Cerrar
              </Button>
            </div>
          </div>
        )}
      </Modal>
      
      {/* Modal Registrar Cobro */}
      <Modal isOpen={showAbonoModal} onClose={() => setShowAbonoModal(false)} title="Registrar Cobro" size="sm">
        <div className="space-y-4">
          <div className="bg-gray-50 rounded-lg p-3 text-center">
            <p className="text-xs text-gray-500">Saldo pendiente</p>
            <p className="text-xl font-bold text-red-600">
              {selectedVenta && formatCurrency(selectedVenta.total - selectedVenta.cobrado)}
            </p>
          </div>
          
          <Input 
            label="Monto del Cobro" 
            type="number"
            value={abonoForm.monto} 
            onChange={(v) => setAbonoForm({...abonoForm, monto: v})} 
            placeholder="0" 
            required 
          />
          
          <Select 
            label="Método de Pago" 
            value={abonoForm.metodo} 
            onChange={(v) => setAbonoForm({...abonoForm, metodo: v})}
            options={[
              { value: 'Transferencia', label: 'Transferencia' },
              { value: 'Efectivo', label: 'Efectivo' },
              { value: 'Cheque', label: 'Cheque' },
              { value: 'Tarjeta', label: 'Tarjeta' },
              { value: 'Otro', label: 'Otro' },
            ]}
          />
          
          <div className="space-y-1">
            <label className="block text-sm font-medium text-gray-700">Notas / Referencia</label>
            <input
              type="text"
              value={abonoForm.notas}
              onChange={(e) => setAbonoForm({...abonoForm, notas: e.target.value})}
              placeholder="Ej: Transferencia #12345"
              className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500"
            />
          </div>
          
          <div className="flex gap-3 pt-4">
            <Button variant="secondary" onClick={() => setShowAbonoModal(false)} className="flex-1">Cancelar</Button>
            <Button onClick={handleSaveAbono} className="flex-1" disabled={!abonoForm.monto || Number(abonoForm.monto) <= 0}>
              Registrar Cobro
            </Button>
          </div>
        </div>
      </Modal>
    </div>
  );
};

// CxC Module (Cuentas por Cobrar)
const CxCModule = ({ cxc, setCxc, ventas, setVentas, clientes }) => {
  const [showAbonoModal, setShowAbonoModal] = useState(false);
  const [showDetailModal, setShowDetailModal] = useState(false);
  const [selectedCuenta, setSelectedCuenta] = useState(null);
  const [selectedVenta, setSelectedVenta] = useState(null);
  const [searchTerm, setSearchTerm] = useState('');
  const [filterStatus, setFilterStatus] = useState('all');
  const [selectedPeriod, setSelectedPeriod] = useState('all');
  
  const [abonoForm, setAbonoForm] = useState({ monto: '', metodo: 'Transferencia', notas: '' });

  const getCliente = (cliId) => clientes.find(c => c.id === cliId) || null;
  const getVenta = (ventaId) => ventas.find(v => v.id === ventaId) || null;

  // Filtrar por período
  const cxcFiltradas = filterByPeriod(cxc, selectedPeriod);
  
  // Cálculos
  const totalCxC = cxcFiltradas.reduce((sum, c) => sum + (c.monto - c.cobrado), 0);
  const cuentasPendientes = cxcFiltradas.filter(c => c.monto - c.cobrado > 0).length;
  const cuentasVencidas = cxcFiltradas.filter(c => {
    const dias = Math.floor((new Date() - new Date(c.fecha)) / (1000 * 60 * 60 * 24));
    return dias > 30 && c.monto - c.cobrado > 0;
  }).length;

  const filteredCxc = cxcFiltradas.filter(c => {
    const cliente = getCliente(c.clienteId);
    const matchSearch = cliente?.nombre.toLowerCase().includes(searchTerm.toLowerCase()) ||
                       formatDate(c.fecha).toLowerCase().includes(searchTerm.toLowerCase());
    
    if (filterStatus === 'pendiente') return matchSearch && c.monto - c.cobrado > 0;
    if (filterStatus === 'cobrado') return matchSearch && c.monto - c.cobrado === 0;
    return matchSearch;
  });

  const handleViewDetail = (cuenta) => {
    setSelectedCuenta(cuenta);
    const venta = getVenta(cuenta.ventaId);
    setSelectedVenta(venta);
    setShowDetailModal(true);
  };

  const handleOpenAbonoModal = () => {
    const saldo = selectedCuenta.monto - selectedCuenta.cobrado;
    setAbonoForm({ monto: saldo.toString(), metodo: 'Transferencia', notas: '' });
    setShowAbonoModal(true);
  };

  const handleSaveAbono = () => {
    const montoAbono = Number(abonoForm.monto);
    if (montoAbono <= 0) return;
    
    const nuevoAbono = {
      id: Date.now(),
      fecha: getTodayISO(),
      monto: montoAbono,
      metodo: abonoForm.metodo,
      notas: abonoForm.notas,
    };
    
    // Actualizar CxC
    const updatedCxc = cxc.map(c => {
      if (c.id === selectedCuenta.id) {
        return { ...c, cobrado: c.cobrado + montoAbono };
      }
      return c;
    });
    setCxc(updatedCxc);
    
    // Actualizar Venta
    const updatedVentas = ventas.map(v => {
      if (v.id === selectedCuenta.ventaId) {
        return {
          ...v,
          cobrado: v.cobrado + montoAbono,
          abonos: [...(v.abonos || []), nuevoAbono],
        };
      }
      return v;
    });
    setVentas(updatedVentas);
    
    // Actualizar estados locales
    setSelectedCuenta({ ...selectedCuenta, cobrado: selectedCuenta.cobrado + montoAbono });
    if (selectedVenta) {
      setSelectedVenta({
        ...selectedVenta,
        cobrado: selectedVenta.cobrado + montoAbono,
        abonos: [...(selectedVenta.abonos || []), nuevoAbono],
      });
    }
    
    setShowAbonoModal(false);
    setAbonoForm({ monto: '', metodo: 'Transferencia', notas: '' });
  };

  return (
    <div className="space-y-6">
      <div className="flex items-center justify-between">
        <div>
          <h1 className="text-2xl font-bold text-gray-900">Cuentas por Cobrar</h1>
          <p className="text-gray-500 text-sm">Gestión de cobros pendientes a clientes</p>
        </div>
      </div>

      {/* Stats */}
      <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
        <StatCard title="Total por Cobrar" value={formatCurrency(totalCxC)} icon={Icons.CxC} compact />
        <StatCard title="Cuentas Pendientes" value={cuentasPendientes} icon={Icons.List} compact />
        <StatCard title="Vencidas (+30 días)" value={cuentasVencidas} icon={Icons.Gastos} compact />
      </div>

      {/* Filters */}
      <div className="bg-white rounded-lg border border-gray-200 p-4">
        <div className="flex gap-4 items-center">
          <div className="relative flex-1 max-w-md">
            <div className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400">
              <Icons.Search />
            </div>
            <input
              type="text"
              placeholder="Buscar por cliente o fecha..."
              value={searchTerm}
              onChange={(e) => setSearchTerm(e.target.value)}
              className="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500"
            />
          </div>
          <select
            value={filterStatus}
            onChange={(e) => setFilterStatus(e.target.value)}
            className="px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500"
          >
            <option value="all">Todos</option>
            <option value="pendiente">Pendientes</option>
            <option value="cobrado">Cobrados</option>
          </select>
          <PeriodFilter selectedPeriod={selectedPeriod} onPeriodChange={setSelectedPeriod} />
        </div>
      </div>

      {/* Lista */}
      <div className="bg-white rounded-lg border border-gray-200 overflow-hidden">
        <div className="overflow-x-auto">
          <table className="w-full">
            <thead>
              <tr className="bg-gray-50 border-b border-gray-200">
                <th className="text-left px-4 py-2.5 text-xs font-semibold text-gray-500 uppercase">Fecha</th>
                <th className="text-left px-4 py-2.5 text-xs font-semibold text-gray-500 uppercase">Cliente</th>
                <th className="text-left px-4 py-2.5 text-xs font-semibold text-gray-500 uppercase">Concepto</th>
                <th className="text-right px-4 py-2.5 text-xs font-semibold text-gray-500 uppercase">Monto</th>
                <th className="text-right px-4 py-2.5 text-xs font-semibold text-gray-500 uppercase">Cobrado</th>
                <th className="text-right px-4 py-2.5 text-xs font-semibold text-gray-500 uppercase">Saldo</th>
                <th className="text-center px-4 py-2.5 text-xs font-semibold text-gray-500 uppercase">Estado</th>
                <th className="text-center px-4 py-2.5 text-xs font-semibold text-gray-500 uppercase">Acciones</th>
              </tr>
            </thead>
            <tbody className="divide-y divide-gray-200">
              {filteredCxc.length === 0 ? (
                <tr>
                  <td colSpan="8" className="px-4 py-8 text-center text-gray-500">
                    No hay cuentas por cobrar
                  </td>
                </tr>
              ) : (
                filteredCxc.map((cuenta) => {
                  const cliente = getCliente(cuenta.clienteId);
                  const saldo = cuenta.monto - cuenta.cobrado;
                  const dias = Math.floor((new Date() - new Date(cuenta.fecha)) / (1000 * 60 * 60 * 24));
                  return (
                    <tr key={cuenta.id} className="hover:bg-gray-50 cursor-pointer" onClick={() => handleViewDetail(cuenta)}>
                      <td className="px-4 py-2.5 text-sm text-gray-900">{formatDate(cuenta.fecha)}</td>
                      <td className="px-4 py-2.5 text-sm font-medium text-gray-900">{cliente?.nombre || 'Desconocido'}</td>
                      <td className="px-4 py-2.5 text-sm text-gray-500">{cuenta.concepto}</td>
                      <td className="px-4 py-2.5 text-right text-sm font-medium text-gray-900">{formatCurrency(cuenta.monto)}</td>
                      <td className="px-4 py-2.5 text-right text-sm text-emerald-600">{formatCurrency(cuenta.cobrado)}</td>
                      <td className="px-4 py-2.5 text-right text-sm text-red-600 font-medium">{formatCurrency(saldo)}</td>
                      <td className="px-4 py-2.5 text-center">
                        {saldo === 0 ? (
                          <Badge variant="success">Cobrado</Badge>
                        ) : dias > 30 ? (
                          <Badge variant="danger">Vencido</Badge>
                        ) : (
                          <Badge variant="warning">Pendiente</Badge>
                        )}
                      </td>
                      <td className="px-4 py-2.5 text-center">
                        <button 
                          onClick={(e) => { e.stopPropagation(); handleViewDetail(cuenta); }}
                          className="p-1 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded"
                        >
                          <Icons.Eye />
                        </button>
                      </td>
                    </tr>
                  );
                })
              )}
            </tbody>
          </table>
        </div>
      </div>

      {/* Modal Detalle */}
      <Modal isOpen={showDetailModal} onClose={() => setShowDetailModal(false)} title="Detalle de Cuenta por Cobrar" size="md">
        {selectedCuenta && (
          <div className="space-y-4">
            <div className="grid grid-cols-1 sm:grid-cols-2 gap-4 pb-4 border-b border-gray-200">
              <div>
                <p className="text-xs text-gray-500">Cliente</p>
                <p className="font-semibold text-gray-900">{getCliente(selectedCuenta.clienteId)?.nombre}</p>
              </div>
              <div>
                <p className="text-xs text-gray-500">Fecha</p>
                <p className="font-semibold text-gray-900">{formatDate(selectedCuenta.fecha)}</p>
              </div>
            </div>

            <div>
              <p className="text-xs text-gray-500 mb-1">Concepto</p>
              <p className="text-sm text-gray-900">{selectedCuenta.concepto}</p>
            </div>

            <div className="bg-gray-50 rounded-lg p-4 space-y-2">
              <div className="flex justify-between text-sm">
                <span className="text-gray-600">Monto Total</span>
                <span className="font-bold">{formatCurrency(selectedCuenta.monto)}</span>
              </div>
              <div className="flex justify-between text-sm">
                <span className="text-gray-600">Cobrado</span>
                <span className="font-bold text-emerald-600">{formatCurrency(selectedCuenta.cobrado)}</span>
              </div>
              <div className="flex justify-between text-sm pt-2 border-t border-gray-200">
                <span className="text-gray-600">Saldo Pendiente</span>
                <span className={`font-bold ${selectedCuenta.monto - selectedCuenta.cobrado > 0 ? 'text-red-600' : 'text-emerald-600'}`}>
                  {formatCurrency(selectedCuenta.monto - selectedCuenta.cobrado)}
                </span>
              </div>
            </div>

            {/* Historial de Cobros */}
            <div>
              <div className="flex items-center justify-between mb-2">
                <p className="text-xs text-gray-500">Historial de Cobros</p>
                {selectedCuenta.monto - selectedCuenta.cobrado > 0 && (
                  <button
                    onClick={handleOpenAbonoModal}
                    className="text-xs text-emerald-600 hover:text-emerald-700 font-medium flex items-center gap-1"
                  >
                    <Icons.Plus /> Registrar Cobro
                  </button>
                )}
              </div>
              {selectedVenta?.abonos && selectedVenta.abonos.length > 0 ? (
                <div className="space-y-2">
                  {selectedVenta.abonos.map((abono, idx) => (
                    <div key={idx} className="flex justify-between items-center py-2 px-3 bg-emerald-50 rounded-lg border border-emerald-100">
                      <div>
                        <p className="font-medium text-emerald-700">{formatCurrency(abono.monto)}</p>
                        <p className="text-xs text-emerald-600">{formatDate(abono.fecha)}{abono.notas ? ` · ${abono.notas}` : ''}</p>
                      </div>
                      <Badge variant="success">{abono.metodo}</Badge>
                    </div>
                  ))}
                </div>
              ) : (
                <p className="text-sm text-gray-400 text-center py-3 bg-gray-50 rounded-lg">Sin cobros registrados</p>
              )}
            </div>

            <div className="pt-4">
              <Button variant="secondary" onClick={() => setShowDetailModal(false)} className="w-full">Cerrar</Button>
            </div>
          </div>
        )}
      </Modal>

      {/* Modal Registrar Cobro */}
      <Modal isOpen={showAbonoModal} onClose={() => setShowAbonoModal(false)} title="Registrar Cobro" size="sm">
        <div className="space-y-4">
          <div className="bg-gray-50 rounded-lg p-3 text-center">
            <p className="text-xs text-gray-500">Saldo pendiente</p>
            <p className="text-xl font-bold text-red-600">
              {selectedCuenta && formatCurrency(selectedCuenta.monto - selectedCuenta.cobrado)}
            </p>
          </div>
          
          <Input label="Monto del Cobro" type="number" value={abonoForm.monto} onChange={(v) => setAbonoForm({...abonoForm, monto: v})} placeholder="0" required />
          
          <Select 
            label="Método de Pago" 
            value={abonoForm.metodo} 
            onChange={(v) => setAbonoForm({...abonoForm, metodo: v})}
            options={[
              { value: 'Transferencia', label: 'Transferencia' },
              { value: 'Efectivo', label: 'Efectivo' },
              { value: 'Cheque', label: 'Cheque' },
              { value: 'Tarjeta', label: 'Tarjeta' },
              { value: 'Otro', label: 'Otro' },
            ]}
          />
          
          <div className="space-y-1">
            <label className="block text-sm font-medium text-gray-700">Notas / Referencia</label>
            <input
              type="text"
              value={abonoForm.notas}
              onChange={(e) => setAbonoForm({...abonoForm, notas: e.target.value})}
              placeholder="Ej: Transferencia #12345"
              className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500"
            />
          </div>
          
          <div className="flex gap-3 pt-4">
            <Button variant="secondary" onClick={() => setShowAbonoModal(false)} className="flex-1">Cancelar</Button>
            <Button onClick={handleSaveAbono} className="flex-1" disabled={!abonoForm.monto || Number(abonoForm.monto) <= 0}>
              Registrar Cobro
            </Button>
          </div>
        </div>
      </Modal>
    </div>
  );
};

// CxP Module (Cuentas por Pagar)
const CxPModule = ({ cxp, setCxp, compras, setCompras, proveedores }) => {
  const [showAbonoModal, setShowAbonoModal] = useState(false);
  const [showDetailModal, setShowDetailModal] = useState(false);
  const [selectedCuenta, setSelectedCuenta] = useState(null);
  const [selectedCompra, setSelectedCompra] = useState(null);
  const [searchTerm, setSearchTerm] = useState('');
  const [filterStatus, setFilterStatus] = useState('all');
  const [selectedPeriod, setSelectedPeriod] = useState('all');
  
  const [abonoForm, setAbonoForm] = useState({ monto: '', metodo: 'Transferencia', notas: '' });

  const getProveedor = (provId) => proveedores.find(p => p.id === provId) || null;
  const getCompra = (compraId) => compras.find(c => c.id === compraId) || null;

  // Filtrar por período
  const cxpFiltradas = filterByPeriod(cxp, selectedPeriod);
  
  // Cálculos
  const totalCxP = cxpFiltradas.reduce((sum, c) => sum + (c.monto - c.pagado), 0);
  const cuentasPendientes = cxpFiltradas.filter(c => c.monto - c.pagado > 0).length;
  const cuentasVencidas = cxpFiltradas.filter(c => {
    const dias = Math.floor((new Date() - new Date(c.fecha)) / (1000 * 60 * 60 * 24));
    return dias > 30 && c.monto - c.pagado > 0;
  }).length;

  const filteredCxp = cxpFiltradas.filter(c => {
    const proveedor = getProveedor(c.proveedorId);
    const matchSearch = proveedor?.nombre.toLowerCase().includes(searchTerm.toLowerCase()) ||
                       formatDate(c.fecha).toLowerCase().includes(searchTerm.toLowerCase());
    
    if (filterStatus === 'pendiente') return matchSearch && c.monto - c.pagado > 0;
    if (filterStatus === 'pagado') return matchSearch && c.monto - c.pagado === 0;
    return matchSearch;
  });

  const handleViewDetail = (cuenta) => {
    setSelectedCuenta(cuenta);
    const compra = getCompra(cuenta.compraId);
    setSelectedCompra(compra);
    setShowDetailModal(true);
  };

  const handleOpenAbonoModal = () => {
    const saldo = selectedCuenta.monto - selectedCuenta.pagado;
    setAbonoForm({ monto: saldo.toString(), metodo: 'Transferencia', notas: '' });
    setShowAbonoModal(true);
  };

  const handleSaveAbono = () => {
    const montoAbono = Number(abonoForm.monto);
    if (montoAbono <= 0) return;
    
    const nuevoAbono = {
      id: Date.now(),
      fecha: getTodayISO(),
      monto: montoAbono,
      metodo: abonoForm.metodo,
      notas: abonoForm.notas,
    };
    
    // Actualizar CxP
    const updatedCxp = cxp.map(c => {
      if (c.id === selectedCuenta.id) {
        return { ...c, pagado: c.pagado + montoAbono };
      }
      return c;
    });
    setCxp(updatedCxp);
    
    // Actualizar Compra
    const updatedCompras = compras.map(c => {
      if (c.id === selectedCuenta.compraId) {
        return {
          ...c,
          pagado: c.pagado + montoAbono,
          abonos: [...(c.abonos || []), nuevoAbono],
        };
      }
      return c;
    });
    setCompras(updatedCompras);
    
    // Actualizar estados locales
    setSelectedCuenta({ ...selectedCuenta, pagado: selectedCuenta.pagado + montoAbono });
    if (selectedCompra) {
      setSelectedCompra({
        ...selectedCompra,
        pagado: selectedCompra.pagado + montoAbono,
        abonos: [...(selectedCompra.abonos || []), nuevoAbono],
      });
    }
    
    setShowAbonoModal(false);
    setAbonoForm({ monto: '', metodo: 'Transferencia', notas: '' });
  };

  return (
    <div className="space-y-6">
      <div className="flex items-center justify-between">
        <div>
          <h1 className="text-2xl font-bold text-gray-900">Cuentas por Pagar</h1>
          <p className="text-gray-500 text-sm">Gestión de pagos pendientes a proveedores</p>
        </div>
      </div>

      {/* Stats */}
      <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
        <StatCard title="Total por Pagar" value={formatCurrency(totalCxP)} icon={Icons.CxP} compact />
        <StatCard title="Cuentas Pendientes" value={cuentasPendientes} icon={Icons.List} compact />
        <StatCard title="Vencidas (+30 días)" value={cuentasVencidas} icon={Icons.Gastos} compact />
      </div>

      {/* Filters */}
      <div className="bg-white rounded-lg border border-gray-200 p-4">
        <div className="flex gap-4 items-center">
          <div className="relative flex-1 max-w-md">
            <div className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400">
              <Icons.Search />
            </div>
            <input
              type="text"
              placeholder="Buscar por proveedor o fecha..."
              value={searchTerm}
              onChange={(e) => setSearchTerm(e.target.value)}
              className="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500"
            />
          </div>
          <select
            value={filterStatus}
            onChange={(e) => setFilterStatus(e.target.value)}
            className="px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500"
          >
            <option value="all">Todos</option>
            <option value="pendiente">Pendientes</option>
            <option value="pagado">Pagados</option>
          </select>
          <PeriodFilter selectedPeriod={selectedPeriod} onPeriodChange={setSelectedPeriod} />
        </div>
      </div>

      {/* Lista */}
      <div className="bg-white rounded-lg border border-gray-200 overflow-hidden">
        <div className="overflow-x-auto">
          <table className="w-full">
            <thead>
              <tr className="bg-gray-50 border-b border-gray-200">
                <th className="text-left px-4 py-2.5 text-xs font-semibold text-gray-500 uppercase">Fecha</th>
                <th className="text-left px-4 py-2.5 text-xs font-semibold text-gray-500 uppercase">Proveedor</th>
                <th className="text-left px-4 py-2.5 text-xs font-semibold text-gray-500 uppercase">Concepto</th>
                <th className="text-right px-4 py-2.5 text-xs font-semibold text-gray-500 uppercase">Monto</th>
                <th className="text-right px-4 py-2.5 text-xs font-semibold text-gray-500 uppercase">Pagado</th>
                <th className="text-right px-4 py-2.5 text-xs font-semibold text-gray-500 uppercase">Saldo</th>
                <th className="text-center px-4 py-2.5 text-xs font-semibold text-gray-500 uppercase">Estado</th>
                <th className="text-center px-4 py-2.5 text-xs font-semibold text-gray-500 uppercase">Acciones</th>
              </tr>
            </thead>
            <tbody className="divide-y divide-gray-200">
              {filteredCxp.length === 0 ? (
                <tr>
                  <td colSpan="8" className="px-4 py-8 text-center text-gray-500">
                    No hay cuentas por pagar
                  </td>
                </tr>
              ) : (
                filteredCxp.map((cuenta) => {
                  const proveedor = getProveedor(cuenta.proveedorId);
                  const saldo = cuenta.monto - cuenta.pagado;
                  const dias = Math.floor((new Date() - new Date(cuenta.fecha)) / (1000 * 60 * 60 * 24));
                  return (
                    <tr key={cuenta.id} className="hover:bg-gray-50 cursor-pointer" onClick={() => handleViewDetail(cuenta)}>
                      <td className="px-4 py-2.5 text-sm text-gray-900">{formatDate(cuenta.fecha)}</td>
                      <td className="px-4 py-2.5 text-sm font-medium text-gray-900">{proveedor?.nombre || 'Desconocido'}</td>
                      <td className="px-4 py-2.5 text-sm text-gray-500">{cuenta.concepto}</td>
                      <td className="px-4 py-2.5 text-right text-sm font-medium text-gray-900">{formatCurrency(cuenta.monto)}</td>
                      <td className="px-4 py-2.5 text-right text-sm text-emerald-600">{formatCurrency(cuenta.pagado)}</td>
                      <td className="px-4 py-2.5 text-right text-sm text-red-600 font-medium">{formatCurrency(saldo)}</td>
                      <td className="px-4 py-2.5 text-center">
                        {saldo === 0 ? (
                          <Badge variant="success">Pagado</Badge>
                        ) : dias > 30 ? (
                          <Badge variant="danger">Vencido</Badge>
                        ) : (
                          <Badge variant="warning">Pendiente</Badge>
                        )}
                      </td>
                      <td className="px-4 py-2.5 text-center">
                        <button 
                          onClick={(e) => { e.stopPropagation(); handleViewDetail(cuenta); }}
                          className="p-1 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded"
                        >
                          <Icons.Eye />
                        </button>
                      </td>
                    </tr>
                  );
                })
              )}
            </tbody>
          </table>
        </div>
      </div>

      {/* Modal Detalle */}
      <Modal isOpen={showDetailModal} onClose={() => setShowDetailModal(false)} title="Detalle de Cuenta por Pagar" size="md">
        {selectedCuenta && (
          <div className="space-y-4">
            <div className="grid grid-cols-1 sm:grid-cols-2 gap-4 pb-4 border-b border-gray-200">
              <div>
                <p className="text-xs text-gray-500">Proveedor</p>
                <p className="font-semibold text-gray-900">{getProveedor(selectedCuenta.proveedorId)?.nombre}</p>
              </div>
              <div>
                <p className="text-xs text-gray-500">Fecha</p>
                <p className="font-semibold text-gray-900">{formatDate(selectedCuenta.fecha)}</p>
              </div>
            </div>

            <div>
              <p className="text-xs text-gray-500 mb-1">Concepto</p>
              <p className="text-sm text-gray-900">{selectedCuenta.concepto}</p>
            </div>

            <div className="bg-gray-50 rounded-lg p-4 space-y-2">
              <div className="flex justify-between text-sm">
                <span className="text-gray-600">Monto Total</span>
                <span className="font-bold">{formatCurrency(selectedCuenta.monto)}</span>
              </div>
              <div className="flex justify-between text-sm">
                <span className="text-gray-600">Pagado</span>
                <span className="font-bold text-emerald-600">{formatCurrency(selectedCuenta.pagado)}</span>
              </div>
              <div className="flex justify-between text-sm pt-2 border-t border-gray-200">
                <span className="text-gray-600">Saldo Pendiente</span>
                <span className={`font-bold ${selectedCuenta.monto - selectedCuenta.pagado > 0 ? 'text-red-600' : 'text-emerald-600'}`}>
                  {formatCurrency(selectedCuenta.monto - selectedCuenta.pagado)}
                </span>
              </div>
            </div>

            {/* Historial de Pagos */}
            <div>
              <div className="flex items-center justify-between mb-2">
                <p className="text-xs text-gray-500">Historial de Pagos</p>
                {selectedCuenta.monto - selectedCuenta.pagado > 0 && (
                  <button
                    onClick={handleOpenAbonoModal}
                    className="text-xs text-emerald-600 hover:text-emerald-700 font-medium flex items-center gap-1"
                  >
                    <Icons.Plus /> Registrar Pago
                  </button>
                )}
              </div>
              {selectedCompra?.abonos && selectedCompra.abonos.length > 0 ? (
                <div className="space-y-2">
                  {selectedCompra.abonos.map((abono, idx) => (
                    <div key={idx} className="flex justify-between items-center py-2 px-3 bg-emerald-50 rounded-lg border border-emerald-100">
                      <div>
                        <p className="font-medium text-emerald-700">{formatCurrency(abono.monto)}</p>
                        <p className="text-xs text-emerald-600">{formatDate(abono.fecha)}{abono.notas ? ` · ${abono.notas}` : ''}</p>
                      </div>
                      <Badge variant="success">{abono.metodo}</Badge>
                    </div>
                  ))}
                </div>
              ) : (
                <p className="text-sm text-gray-400 text-center py-3 bg-gray-50 rounded-lg">Sin pagos registrados</p>
              )}
            </div>

            <div className="pt-4">
              <Button variant="secondary" onClick={() => setShowDetailModal(false)} className="w-full">Cerrar</Button>
            </div>
          </div>
        )}
      </Modal>

      {/* Modal Registrar Pago */}
      <Modal isOpen={showAbonoModal} onClose={() => setShowAbonoModal(false)} title="Registrar Pago" size="sm">
        <div className="space-y-4">
          <div className="bg-gray-50 rounded-lg p-3 text-center">
            <p className="text-xs text-gray-500">Saldo pendiente</p>
            <p className="text-xl font-bold text-red-600">
              {selectedCuenta && formatCurrency(selectedCuenta.monto - selectedCuenta.pagado)}
            </p>
          </div>
          
          <Input label="Monto del Pago" type="number" value={abonoForm.monto} onChange={(v) => setAbonoForm({...abonoForm, monto: v})} placeholder="0" required />
          
          <Select 
            label="Método de Pago" 
            value={abonoForm.metodo} 
            onChange={(v) => setAbonoForm({...abonoForm, metodo: v})}
            options={[
              { value: 'Transferencia', label: 'Transferencia' },
              { value: 'Efectivo', label: 'Efectivo' },
              { value: 'Cheque', label: 'Cheque' },
              { value: 'Tarjeta', label: 'Tarjeta' },
              { value: 'Otro', label: 'Otro' },
            ]}
          />
          
          <div className="space-y-1">
            <label className="block text-sm font-medium text-gray-700">Notas / Referencia</label>
            <input
              type="text"
              value={abonoForm.notas}
              onChange={(e) => setAbonoForm({...abonoForm, notas: e.target.value})}
              placeholder="Ej: Transferencia #12345"
              className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500"
            />
          </div>
          
          <div className="flex gap-3 pt-4">
            <Button variant="secondary" onClick={() => setShowAbonoModal(false)} className="flex-1">Cancelar</Button>
            <Button onClick={handleSaveAbono} className="flex-1" disabled={!abonoForm.monto || Number(abonoForm.monto) <= 0}>
              Registrar Pago
            </Button>
          </div>
        </div>
      </Modal>
    </div>
  );
};

// Gastos Module
const GastosModule = ({ gastos, setGastos, categorias }) => {
  const [showModal, setShowModal] = useState(false);
  const [showDetailModal, setShowDetailModal] = useState(false);
  const [editingGasto, setEditingGasto] = useState(null);
  const [selectedGasto, setSelectedGasto] = useState(null);
  const [searchTerm, setSearchTerm] = useState('');
  const [filterCategoria, setFilterCategoria] = useState('all');
  const [selectedPeriod, setSelectedPeriod] = useState('all');
  
  // Form state
  const [gastoForm, setGastoForm] = useState({
    categoriaId: '',
    descripcion: '',
    monto: '',
    fecha: getTodayISO(),
    notas: '',
  });

  const [showDeleteConfirm, setShowDeleteConfirm] = useState(false);
  const [gastoToDelete, setGastoToDelete] = useState(null);

  const getCategoria = (catId) => categorias.find(c => c.id === catId) || null;
  
  const iconMap = {
    truck: '🚚',
    snowflake: '❄️',
    users: '👥',
    tool: '🔧',
    zap: '⚡',
    more: '•••',
  };

  // Filtrar por período
  const gastosFiltrados = filterByPeriod(gastos, selectedPeriod);
  
  // Cálculos basados en período seleccionado
  const totalPeriodo = gastosFiltrados.reduce((sum, g) => sum + g.monto, 0);
  
  // Gastos por categoría del período seleccionado
  const gastosPorCategoria = categorias.map(cat => {
    const total = gastosFiltrados
      .filter(g => g.categoriaId === cat.id)
      .reduce((sum, g) => sum + g.monto, 0);
    return { ...cat, total };
  }).filter(c => c.total > 0).sort((a, b) => b.total - a.total);

  const filteredGastos = gastosFiltrados.filter(g => {
    const cat = getCategoria(g.categoriaId);
    const matchSearch = g.descripcion.toLowerCase().includes(searchTerm.toLowerCase()) ||
                       cat?.nombre.toLowerCase().includes(searchTerm.toLowerCase()) ||
                       formatDate(g.fecha).toLowerCase().includes(searchTerm.toLowerCase());
    
    if (filterCategoria === 'all') return matchSearch;
    return matchSearch && g.categoriaId === Number(filterCategoria);
  });

  const resetForm = () => {
    setGastoForm({
      categoriaId: '',
      descripcion: '',
      monto: '',
      fecha: getTodayISO(),
      notas: '',
    });
    setEditingGasto(null);
  };

  const handleOpenModal = (gasto = null) => {
    if (gasto) {
      setEditingGasto(gasto);
      setGastoForm({
        categoriaId: gasto.categoriaId.toString(),
        descripcion: gasto.descripcion,
        monto: gasto.monto.toString(),
        fecha: gasto.fecha,
        notas: gasto.notas || '',
      });
    } else {
      resetForm();
    }
    setShowModal(true);
  };

  const handleSaveGasto = () => {
    if (editingGasto) {
      // Editar
      const updatedGastos = gastos.map(g => {
        if (g.id === editingGasto.id) {
          return {
            ...g,
            categoriaId: Number(gastoForm.categoriaId),
            descripcion: gastoForm.descripcion,
            monto: Number(gastoForm.monto),
            fecha: gastoForm.fecha,
            notas: gastoForm.notas,
          };
        }
        return g;
      });
      setGastos(updatedGastos);
    } else {
      // Nuevo
      const newGasto = {
        id: Date.now(),
        categoriaId: Number(gastoForm.categoriaId),
        descripcion: gastoForm.descripcion,
        monto: Number(gastoForm.monto),
        fecha: gastoForm.fecha,
        notas: gastoForm.notas,
      };
      setGastos([...gastos, newGasto]);
    }
    
    setShowModal(false);
    resetForm();
  };

  const handleViewDetail = (gasto) => {
    setSelectedGasto(gasto);
    setShowDetailModal(true);
  };

  const handleRequestDelete = (gasto, e) => {
    if (e) e.stopPropagation();
    setGastoToDelete(gasto);
    setShowDeleteConfirm(true);
  };

  const handleConfirmDelete = () => {
    if (gastoToDelete) {
      setGastos(gastos.filter(g => g.id !== gastoToDelete.id));
      setShowDetailModal(false);
    }
    setShowDeleteConfirm(false);
    setGastoToDelete(null);
  };

  const isFormValid = () => {
    return gastoForm.categoriaId && gastoForm.descripcion && gastoForm.monto && Number(gastoForm.monto) > 0;
  };

  return (
    <div className="space-y-6">
      <div className="flex items-center justify-between">
        <div>
          <h1 className="text-2xl font-bold text-gray-900">Gastos</h1>
          <p className="text-gray-500 text-sm">Registro de gastos operativos</p>
        </div>
        <Button onClick={() => handleOpenModal()}>
          <Icons.Plus /> Nuevo Gasto
        </Button>
      </div>

      {/* Stats */}
      <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
        <StatCard title={`Gastos ${getPeriodLabel(selectedPeriod)}`} value={formatCurrency(totalPeriodo)} icon={Icons.Gastos} compact />
        <StatCard title="Registros" value={gastosFiltrados.length} icon={Icons.List} compact />
        <StatCard title="Categorías Usadas" value={gastosPorCategoria.length} icon={Icons.Catalogos} compact />
        <StatCard title="Promedio" value={gastosFiltrados.length > 0 ? formatCurrency(totalPeriodo / gastosFiltrados.length) : '$0'} icon={Icons.Chart} compact />
      </div>

      {/* Gastos por categoría del período */}
      {gastosPorCategoria.length > 0 && (
        <div className="bg-white rounded-lg border border-gray-200 p-4">
          <p className="text-xs font-semibold text-gray-500 uppercase mb-3">Distribución {getPeriodLabel(selectedPeriod)}</p>
          <div className="grid grid-cols-3 gap-3">
            {gastosPorCategoria.slice(0, 6).map((cat) => (
              <div key={cat.id} className="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                <div className="flex items-center gap-2">
                  <span className="text-lg">{iconMap[cat.icono] || '•••'}</span>
                  <span className="text-sm text-gray-700">{cat.nombre}</span>
                </div>
                <span className="text-sm font-semibold text-gray-900">{formatCurrency(cat.total)}</span>
              </div>
            ))}
          </div>
        </div>
      )}

      {/* Filters */}
      <div className="bg-white rounded-lg border border-gray-200 p-4">
        <div className="flex gap-4 items-center">
          <div className="relative flex-1 max-w-md">
            <div className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400">
              <Icons.Search />
            </div>
            <input
              type="text"
              placeholder="Buscar por descripción, categoría o fecha..."
              value={searchTerm}
              onChange={(e) => setSearchTerm(e.target.value)}
              className="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500"
            />
          </div>
          <select
            value={filterCategoria}
            onChange={(e) => setFilterCategoria(e.target.value)}
            className="px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500"
          >
            <option value="all">Todas las categorías</option>
            {categorias.filter(c => c.activo).map(cat => (
              <option key={cat.id} value={cat.id}>{iconMap[cat.icono]} {cat.nombre}</option>
            ))}
          </select>
          <PeriodFilter selectedPeriod={selectedPeriod} onPeriodChange={setSelectedPeriod} />
        </div>
      </div>

      {/* Lista de Gastos */}
      <div className="bg-white rounded-lg border border-gray-200 overflow-hidden">
        <div className="overflow-x-auto">
          <table className="w-full">
            <thead>
              <tr className="bg-gray-50 border-b border-gray-200">
                <th className="text-left px-4 py-2.5 text-xs font-semibold text-gray-500 uppercase">Fecha</th>
                <th className="text-left px-4 py-2.5 text-xs font-semibold text-gray-500 uppercase">Categoría</th>
                <th className="text-left px-4 py-2.5 text-xs font-semibold text-gray-500 uppercase">Descripción</th>
                <th className="text-right px-4 py-2.5 text-xs font-semibold text-gray-500 uppercase">Monto</th>
                <th className="text-center px-4 py-2.5 text-xs font-semibold text-gray-500 uppercase">Acciones</th>
              </tr>
            </thead>
            <tbody className="divide-y divide-gray-200">
              {filteredGastos.length === 0 ? (
                <tr>
                  <td colSpan="5" className="px-4 py-8 text-center text-gray-500">
                    No hay gastos registrados
                  </td>
                </tr>
              ) : (
                filteredGastos.sort((a, b) => new Date(b.fecha) - new Date(a.fecha)).map((gasto) => {
                  const cat = getCategoria(gasto.categoriaId);
                  return (
                    <tr key={gasto.id} className="hover:bg-gray-50 cursor-pointer" onClick={() => handleViewDetail(gasto)}>
                      <td className="px-4 py-2.5 text-sm text-gray-900">{formatDate(gasto.fecha)}</td>
                      <td className="px-4 py-2.5">
                        <div className="flex items-center gap-2">
                          <span>{iconMap[cat?.icono] || '•••'}</span>
                          <span className="text-sm text-gray-700">{cat?.nombre || 'Sin categoría'}</span>
                        </div>
                      </td>
                      <td className="px-4 py-2.5 text-sm text-gray-900">{gasto.descripcion}</td>
                      <td className="px-4 py-2.5 text-right text-sm font-semibold text-gray-900">{formatCurrency(gasto.monto)}</td>
                      <td className="px-4 py-2.5 text-center">
                        <div className="flex justify-center gap-1">
                          <button 
                            onClick={(e) => { e.stopPropagation(); handleOpenModal(gasto); }}
                            className="p-1 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded"
                          >
                            <Icons.Edit />
                          </button>
                          <button 
                            onClick={(e) => handleRequestDelete(gasto, e)}
                            className="p-1 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded"
                          >
                            <Icons.Trash />
                          </button>
                        </div>
                      </td>
                    </tr>
                  );
                })
              )}
            </tbody>
          </table>
        </div>
      </div>

      {/* Modal Nuevo/Editar Gasto */}
      <Modal isOpen={showModal} onClose={() => setShowModal(false)} title={editingGasto ? 'Editar Gasto' : 'Nuevo Gasto'} size="md">
        <div className="space-y-4">
          <div className="space-y-1">
            <label className="block text-sm font-medium text-gray-700">Categoría <span className="text-red-500">*</span></label>
            <select
              value={gastoForm.categoriaId}
              onChange={(e) => setGastoForm({...gastoForm, categoriaId: e.target.value})}
              className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500"
            >
              <option value="">Seleccionar categoría...</option>
              {categorias.filter(c => c.activo).map(cat => (
                <option key={cat.id} value={cat.id}>{iconMap[cat.icono]} {cat.nombre}</option>
              ))}
            </select>
          </div>
          
          <Input 
            label="Descripción" 
            value={gastoForm.descripcion} 
            onChange={(v) => setGastoForm({...gastoForm, descripcion: v})} 
            placeholder="Ej: Compra de nitrógeno líquido" 
            required 
          />
          
          <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
            <Input 
              label="Monto" 
              type="number" 
              value={gastoForm.monto} 
              onChange={(v) => setGastoForm({...gastoForm, monto: v})} 
              placeholder="0" 
              required 
            />
            <Input 
              label="Fecha" 
              type="date" 
              value={gastoForm.fecha} 
              onChange={(v) => setGastoForm({...gastoForm, fecha: v})} 
              required 
            />
          </div>
          
          <div className="space-y-1">
            <label className="block text-sm font-medium text-gray-700">Notas</label>
            <textarea
              value={gastoForm.notas}
              onChange={(e) => setGastoForm({...gastoForm, notas: e.target.value})}
              placeholder="Notas adicionales..."
              rows="2"
              className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500 resize-none"
            />
          </div>

          <div className="flex gap-3 pt-4">
            <Button variant="secondary" onClick={() => setShowModal(false)} className="flex-1">Cancelar</Button>
            <Button onClick={handleSaveGasto} className="flex-1" disabled={!isFormValid()}>
              {editingGasto ? 'Actualizar' : 'Guardar'}
            </Button>
          </div>
        </div>
      </Modal>

      {/* Modal Detalle */}
      <Modal isOpen={showDetailModal} onClose={() => setShowDetailModal(false)} title="Detalle de Gasto" size="sm">
        {selectedGasto && (
          <div className="space-y-4">
            <div className="flex items-center gap-3 pb-4 border-b border-gray-200">
              <div className="w-12 h-12 bg-gray-100 rounded-lg flex items-center justify-center text-2xl">
                {iconMap[getCategoria(selectedGasto.categoriaId)?.icono] || '•••'}
              </div>
              <div>
                <p className="font-semibold text-gray-900">{getCategoria(selectedGasto.categoriaId)?.nombre}</p>
                <p className="text-sm text-gray-500">{formatDate(selectedGasto.fecha)}</p>
              </div>
            </div>

            <div>
              <p className="text-xs text-gray-500 mb-1">Descripción</p>
              <p className="text-sm text-gray-900">{selectedGasto.descripcion}</p>
            </div>

            <div className="bg-gray-50 rounded-lg p-4 text-center">
              <p className="text-xs text-gray-500 mb-1">Monto</p>
              <p className="text-2xl font-bold text-gray-900">{formatCurrency(selectedGasto.monto)}</p>
            </div>

            {selectedGasto.notas && (
              <div>
                <p className="text-xs text-gray-500 mb-1">Notas</p>
                <p className="text-sm text-gray-700 bg-gray-50 rounded-lg p-3">{selectedGasto.notas}</p>
              </div>
            )}

            <div className="flex gap-3 pt-4">
              <Button variant="secondary" onClick={() => { setShowDetailModal(false); handleOpenModal(selectedGasto); }} className="flex-1">
                <Icons.Edit /> Editar
              </Button>
              <Button variant="secondary" onClick={() => handleRequestDelete(selectedGasto)} className="flex-1 text-red-600 hover:bg-red-50">
                <Icons.Trash /> Eliminar
              </Button>
            </div>
          </div>
        )}
      </Modal>

      {/* Modal Confirmar Eliminación */}
      <Modal isOpen={showDeleteConfirm} onClose={() => setShowDeleteConfirm(false)} title="Confirmar Eliminación" size="sm">
        <div className="space-y-4">
          <p className="text-sm text-gray-600">
            ¿Estás seguro de eliminar este gasto?
          </p>
          {gastoToDelete && (
            <div className="bg-gray-50 rounded-lg p-3">
              <p className="font-medium text-gray-900">{gastoToDelete.descripcion}</p>
              <p className="text-sm text-gray-500">{formatCurrency(gastoToDelete.monto)} · {formatDate(gastoToDelete.fecha)}</p>
            </div>
          )}
          <div className="flex gap-3 pt-2">
            <Button variant="secondary" onClick={() => setShowDeleteConfirm(false)} className="flex-1">Cancelar</Button>
            <button 
              onClick={handleConfirmDelete}
              className="flex-1 px-4 py-2 bg-red-600 text-white text-sm font-medium rounded-lg hover:bg-red-700"
            >
              Sí, Eliminar
            </button>
          </div>
        </div>
      </Modal>
    </div>
  );
};

// Reportes Module
const ReportesModule = ({ inventory, toros, compras, ventas, cxc, cxp, gastos, clientes, proveedores, categorias }) => {
  const [selectedReport, setSelectedReport] = useState('inventario');
  const [selectedPeriod, setSelectedPeriod] = useState('all');
  const [subFilter, setSubFilter] = useState('all'); // Para filtros secundarios

  // Datos filtrados por período
  const ventasFiltradas = filterByPeriod(ventas, selectedPeriod);
  const comprasFiltradas = filterByPeriod(compras, selectedPeriod);
  const gastosFiltrados = filterByPeriod(gastos, selectedPeriod);

  // Helpers
  const getToro = (id) => toros.find(t => t.id === id) || { codigo: '???', nombre: 'Desconocido' };
  const getCliente = (id) => clientes.find(c => c.id === id) || { nombre: 'Desconocido' };
  const getProveedor = (id) => proveedores.find(p => p.id === id) || { nombre: 'Desconocido' };
  const getCategoria = (id) => categorias.find(c => c.id === id) || { nombre: 'Sin categoría' };

  const reportTypes = [
    { id: 'inventario', label: 'Inventario', icon: Icons.Tank },
    { id: 'ventas', label: 'Ventas', icon: Icons.Transactions },
    { id: 'compras', label: 'Compras', icon: Icons.Cart },
    { id: 'gastos', label: 'Gastos', icon: Icons.Gastos },
    { id: 'financiero', label: 'Financiero', icon: Icons.Finanzas },
    { id: 'cuentas', label: 'CxC / CxP', icon: Icons.CxC },
    { id: 'flujoCaja', label: 'Flujo de Caja', icon: Icons.Chart },
  ];

  // ========== REPORTE DE INVENTARIO ==========
  const renderInventarioReport = () => {
    // Agrupar por toro
    const inventarioByToro = inventory.reduce((acc, item) => {
      if (!acc[item.toroId]) {
        acc[item.toroId] = { cantidad: 0, valor: 0, ubicaciones: [] };
      }
      acc[item.toroId].cantidad += item.cantidad;
      acc[item.toroId].valor += item.cantidad * (item.costoUnitario || 0);
      acc[item.toroId].ubicaciones.push({ termo: item.termo, canastilla: item.canastilla, cantidad: item.cantidad });
      return acc;
    }, {});

    const inventarioData = Object.entries(inventarioByToro).map(([toroId, data]) => {
      const toro = getToro(Number(toroId));
      return { ...toro, toroId: Number(toroId), ...data };
    }).sort((a, b) => b.cantidad - a.cantidad);

    const totalPajillas = inventory.reduce((sum, i) => sum + i.cantidad, 0);
    const valorTotal = inventory.reduce((sum, i) => sum + (i.cantidad * (i.costoUnitario || 0)), 0);

    return (
      <div className="space-y-4">
        {/* Resumen */}
        <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
          <div className="bg-emerald-50 rounded-lg p-4 border border-emerald-200">
            <p className="text-sm text-emerald-600">Total Pajillas</p>
            <p className="text-2xl font-bold text-emerald-700">{totalPajillas.toLocaleString()}</p>
          </div>
          <div className="bg-blue-50 rounded-lg p-4 border border-blue-200">
            <p className="text-sm text-blue-600">Valor Total</p>
            <p className="text-2xl font-bold text-blue-700">{formatCurrency(valorTotal)}</p>
          </div>
          <div className="bg-purple-50 rounded-lg p-4 border border-purple-200">
            <p className="text-sm text-purple-600">Toros en Stock</p>
            <p className="text-2xl font-bold text-purple-700">{inventarioData.length}</p>
          </div>
        </div>

        {/* Tabla */}
        <div className="bg-white rounded-lg border border-gray-200 overflow-hidden">
          <table className="w-full">
            <thead className="bg-gray-50">
              <tr>
                <th className="text-left px-4 py-3 text-xs font-semibold text-gray-500 uppercase">Código</th>
                <th className="text-left px-4 py-3 text-xs font-semibold text-gray-500 uppercase">Nombre</th>
                <th className="text-left px-4 py-3 text-xs font-semibold text-gray-500 uppercase">Ubicaciones</th>
                <th className="text-right px-4 py-3 text-xs font-semibold text-gray-500 uppercase">Cantidad</th>
                <th className="text-right px-4 py-3 text-xs font-semibold text-gray-500 uppercase">Valor</th>
              </tr>
            </thead>
            <tbody className="divide-y divide-gray-200">
              {inventarioData.map((item) => (
                <tr key={item.toroId} className="hover:bg-gray-50">
                  <td className="px-4 py-3 text-sm font-mono">{item.codigo}</td>
                  <td className="px-4 py-3 text-sm">{item.nombre}</td>
                  <td className="px-4 py-3 text-sm">
                    <div className="flex flex-wrap gap-1">
                      {item.ubicaciones.map((ub, idx) => (
                        <span key={idx} className="text-xs bg-gray-100 px-2 py-0.5 rounded">
                          T{ub.termo}-C{ub.canastilla}: {ub.cantidad}
                        </span>
                      ))}
                    </div>
                  </td>
                  <td className="px-4 py-3 text-sm text-right font-semibold">{item.cantidad}</td>
                  <td className="px-4 py-3 text-sm text-right">{formatCurrency(item.valor)}</td>
                </tr>
              ))}
            </tbody>
            <tfoot className="bg-gray-50 font-semibold">
              <tr>
                <td colSpan="3" className="px-4 py-3 text-sm">TOTAL</td>
                <td className="px-4 py-3 text-sm text-right">{totalPajillas}</td>
                <td className="px-4 py-3 text-sm text-right">{formatCurrency(valorTotal)}</td>
              </tr>
            </tfoot>
          </table>
        </div>
      </div>
    );
  };

  // ========== REPORTE DE VENTAS ==========
  const renderVentasReport = () => {
    const totalVentas = ventasFiltradas.reduce((sum, v) => sum + v.total, 0);
    const totalCobrado = ventasFiltradas.reduce((sum, v) => sum + (v.cobrado || 0), 0);
    const totalPendiente = totalVentas - totalCobrado;

    // Agrupar por cliente
    const ventasByCliente = ventasFiltradas.reduce((acc, v) => {
      if (!acc[v.clienteId]) acc[v.clienteId] = { total: 0, count: 0 };
      acc[v.clienteId].total += v.total;
      acc[v.clienteId].count += 1;
      return acc;
    }, {});

    // Agrupar por toro (desde items)
    const ventasByToro = ventasFiltradas.reduce((acc, v) => {
      (v.items || []).forEach(item => {
        if (!acc[item.toroId]) acc[item.toroId] = { cantidad: 0, total: 0 };
        acc[item.toroId].cantidad += item.cantidad;
        acc[item.toroId].total += item.subtotal;
      });
      return acc;
    }, {});

    return (
      <div className="space-y-4">
        {/* Resumen */}
        <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
          <div className="bg-emerald-50 rounded-lg p-4 border border-emerald-200">
            <p className="text-sm text-emerald-600">Total Ventas</p>
            <p className="text-2xl font-bold text-emerald-700">{formatCurrency(totalVentas)}</p>
          </div>
          <div className="bg-blue-50 rounded-lg p-4 border border-blue-200">
            <p className="text-sm text-blue-600">Cobrado</p>
            <p className="text-2xl font-bold text-blue-700">{formatCurrency(totalCobrado)}</p>
          </div>
          <div className="bg-amber-50 rounded-lg p-4 border border-amber-200">
            <p className="text-sm text-amber-600">Pendiente</p>
            <p className="text-2xl font-bold text-amber-700">{formatCurrency(totalPendiente)}</p>
          </div>
          <div className="bg-purple-50 rounded-lg p-4 border border-purple-200">
            <p className="text-sm text-purple-600">Transacciones</p>
            <p className="text-2xl font-bold text-purple-700">{ventasFiltradas.length}</p>
          </div>
        </div>

        <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
          {/* Por Cliente */}
          <div className="bg-white rounded-lg border border-gray-200 overflow-hidden">
            <div className="px-4 py-3 bg-gray-50 border-b font-semibold text-sm">Ventas por Cliente</div>
            <div className="max-h-64 overflow-auto">
              <table className="w-full">
                <thead className="bg-gray-50 sticky top-0">
                  <tr>
                    <th className="text-left px-4 py-2 text-xs font-semibold text-gray-500">Cliente</th>
                    <th className="text-right px-4 py-2 text-xs font-semibold text-gray-500">Ventas</th>
                    <th className="text-right px-4 py-2 text-xs font-semibold text-gray-500">Total</th>
                  </tr>
                </thead>
                <tbody className="divide-y divide-gray-200">
                  {Object.entries(ventasByCliente)
                    .sort((a, b) => b[1].total - a[1].total)
                    .map(([clienteId, data]) => (
                      <tr key={clienteId} className="hover:bg-gray-50">
                        <td className="px-4 py-2 text-sm">{getCliente(Number(clienteId)).nombre}</td>
                        <td className="px-4 py-2 text-sm text-right">{data.count}</td>
                        <td className="px-4 py-2 text-sm text-right font-semibold">{formatCurrency(data.total)}</td>
                      </tr>
                    ))}
                </tbody>
              </table>
            </div>
          </div>

          {/* Por Toro */}
          <div className="bg-white rounded-lg border border-gray-200 overflow-hidden">
            <div className="px-4 py-3 bg-gray-50 border-b font-semibold text-sm">Ventas por Toro</div>
            <div className="max-h-64 overflow-auto">
              <table className="w-full">
                <thead className="bg-gray-50 sticky top-0">
                  <tr>
                    <th className="text-left px-4 py-2 text-xs font-semibold text-gray-500">Toro</th>
                    <th className="text-right px-4 py-2 text-xs font-semibold text-gray-500">Pajillas</th>
                    <th className="text-right px-4 py-2 text-xs font-semibold text-gray-500">Total</th>
                  </tr>
                </thead>
                <tbody className="divide-y divide-gray-200">
                  {Object.entries(ventasByToro)
                    .sort((a, b) => b[1].total - a[1].total)
                    .map(([toroId, data]) => {
                      const toro = getToro(Number(toroId));
                      return (
                        <tr key={toroId} className="hover:bg-gray-50">
                          <td className="px-4 py-2 text-sm"><span className="font-mono text-gray-500">{toro.codigo}</span> - {toro.nombre}</td>
                          <td className="px-4 py-2 text-sm text-right">{data.cantidad}</td>
                          <td className="px-4 py-2 text-sm text-right font-semibold">{formatCurrency(data.total)}</td>
                        </tr>
                      );
                    })}
                </tbody>
              </table>
            </div>
          </div>
        </div>

        {/* Detalle de ventas */}
        <div className="bg-white rounded-lg border border-gray-200 overflow-hidden">
          <div className="px-4 py-3 bg-gray-50 border-b font-semibold text-sm">Detalle de Ventas</div>
          <div className="max-h-72 overflow-auto">
            <table className="w-full">
              <thead className="bg-gray-50 sticky top-0">
                <tr>
                  <th className="text-left px-4 py-2 text-xs font-semibold text-gray-500">Fecha</th>
                  <th className="text-left px-4 py-2 text-xs font-semibold text-gray-500">Cliente</th>
                  <th className="text-center px-4 py-2 text-xs font-semibold text-gray-500">Items</th>
                  <th className="text-right px-4 py-2 text-xs font-semibold text-gray-500">Total</th>
                  <th className="text-right px-4 py-2 text-xs font-semibold text-gray-500">Cobrado</th>
                  <th className="text-center px-4 py-2 text-xs font-semibold text-gray-500">Estado</th>
                </tr>
              </thead>
              <tbody className="divide-y divide-gray-200">
                {ventasFiltradas.map((v) => (
                  <tr key={v.id} className="hover:bg-gray-50">
                    <td className="px-4 py-2 text-sm">{formatDate(v.fecha)}</td>
                    <td className="px-4 py-2 text-sm">{getCliente(v.clienteId).nombre}</td>
                    <td className="px-4 py-2 text-sm text-center">{v.items?.length || 0}</td>
                    <td className="px-4 py-2 text-sm text-right font-semibold">{formatCurrency(v.total)}</td>
                    <td className="px-4 py-2 text-sm text-right">{formatCurrency(v.cobrado || 0)}</td>
                    <td className="px-4 py-2 text-center">
                      <Badge variant={v.cobrado >= v.total ? 'success' : 'warning'}>
                        {v.cobrado >= v.total ? 'Pagado' : 'Pendiente'}
                      </Badge>
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    );
  };

  // ========== REPORTE DE COMPRAS ==========
  const renderComprasReport = () => {
    const totalCompras = comprasFiltradas.reduce((sum, c) => sum + c.total, 0);
    const totalPagado = comprasFiltradas.reduce((sum, c) => sum + (c.pagado || 0), 0);
    const totalPendiente = totalCompras - totalPagado;
    const totalPajillasCompradas = comprasFiltradas.reduce((sum, c) => 
      sum + (c.items || []).reduce((s, i) => s + i.cantidad, 0), 0);

    // Agrupar por proveedor
    const comprasByProveedor = comprasFiltradas.reduce((acc, c) => {
      if (!acc[c.proveedorId]) acc[c.proveedorId] = { total: 0, count: 0 };
      acc[c.proveedorId].total += c.total;
      acc[c.proveedorId].count += 1;
      return acc;
    }, {});

    // Agrupar por toro
    const comprasByToro = comprasFiltradas.reduce((acc, c) => {
      (c.items || []).forEach(item => {
        if (!acc[item.toroId]) acc[item.toroId] = { cantidad: 0, total: 0 };
        acc[item.toroId].cantidad += item.cantidad;
        acc[item.toroId].total += item.subtotal;
      });
      return acc;
    }, {});

    return (
      <div className="space-y-4">
        {/* Resumen */}
        <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
          <div className="bg-blue-50 rounded-lg p-4 border border-blue-200">
            <p className="text-sm text-blue-600">Total Compras</p>
            <p className="text-2xl font-bold text-blue-700">{formatCurrency(totalCompras)}</p>
          </div>
          <div className="bg-emerald-50 rounded-lg p-4 border border-emerald-200">
            <p className="text-sm text-emerald-600">Pagado</p>
            <p className="text-2xl font-bold text-emerald-700">{formatCurrency(totalPagado)}</p>
          </div>
          <div className="bg-red-50 rounded-lg p-4 border border-red-200">
            <p className="text-sm text-red-600">Pendiente</p>
            <p className="text-2xl font-bold text-red-700">{formatCurrency(totalPendiente)}</p>
          </div>
          <div className="bg-purple-50 rounded-lg p-4 border border-purple-200">
            <p className="text-sm text-purple-600">Pajillas Compradas</p>
            <p className="text-2xl font-bold text-purple-700">{totalPajillasCompradas}</p>
          </div>
        </div>

        <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
          {/* Por Proveedor */}
          <div className="bg-white rounded-lg border border-gray-200 overflow-hidden">
            <div className="px-4 py-3 bg-gray-50 border-b font-semibold text-sm">Compras por Proveedor</div>
            <div className="max-h-64 overflow-auto">
              <table className="w-full">
                <thead className="bg-gray-50 sticky top-0">
                  <tr>
                    <th className="text-left px-4 py-2 text-xs font-semibold text-gray-500">Proveedor</th>
                    <th className="text-right px-4 py-2 text-xs font-semibold text-gray-500">Compras</th>
                    <th className="text-right px-4 py-2 text-xs font-semibold text-gray-500">Total</th>
                  </tr>
                </thead>
                <tbody className="divide-y divide-gray-200">
                  {Object.entries(comprasByProveedor)
                    .sort((a, b) => b[1].total - a[1].total)
                    .map(([provId, data]) => (
                      <tr key={provId} className="hover:bg-gray-50">
                        <td className="px-4 py-2 text-sm">{getProveedor(Number(provId)).nombre}</td>
                        <td className="px-4 py-2 text-sm text-right">{data.count}</td>
                        <td className="px-4 py-2 text-sm text-right font-semibold">{formatCurrency(data.total)}</td>
                      </tr>
                    ))}
                </tbody>
              </table>
            </div>
          </div>

          {/* Por Toro */}
          <div className="bg-white rounded-lg border border-gray-200 overflow-hidden">
            <div className="px-4 py-3 bg-gray-50 border-b font-semibold text-sm">Compras por Toro</div>
            <div className="max-h-64 overflow-auto">
              <table className="w-full">
                <thead className="bg-gray-50 sticky top-0">
                  <tr>
                    <th className="text-left px-4 py-2 text-xs font-semibold text-gray-500">Toro</th>
                    <th className="text-right px-4 py-2 text-xs font-semibold text-gray-500">Pajillas</th>
                    <th className="text-right px-4 py-2 text-xs font-semibold text-gray-500">Total</th>
                  </tr>
                </thead>
                <tbody className="divide-y divide-gray-200">
                  {Object.entries(comprasByToro)
                    .sort((a, b) => b[1].total - a[1].total)
                    .map(([toroId, data]) => {
                      const toro = getToro(Number(toroId));
                      return (
                        <tr key={toroId} className="hover:bg-gray-50">
                          <td className="px-4 py-2 text-sm"><span className="font-mono text-gray-500">{toro.codigo}</span> - {toro.nombre}</td>
                          <td className="px-4 py-2 text-sm text-right">{data.cantidad}</td>
                          <td className="px-4 py-2 text-sm text-right font-semibold">{formatCurrency(data.total)}</td>
                        </tr>
                      );
                    })}
                </tbody>
              </table>
            </div>
          </div>
        </div>

        {/* Detalle de compras */}
        <div className="bg-white rounded-lg border border-gray-200 overflow-hidden">
          <div className="px-4 py-3 bg-gray-50 border-b font-semibold text-sm">Detalle de Compras</div>
          <div className="max-h-72 overflow-auto">
            <table className="w-full">
              <thead className="bg-gray-50 sticky top-0">
                <tr>
                  <th className="text-left px-4 py-2 text-xs font-semibold text-gray-500">Fecha</th>
                  <th className="text-left px-4 py-2 text-xs font-semibold text-gray-500">Proveedor</th>
                  <th className="text-center px-4 py-2 text-xs font-semibold text-gray-500">Items</th>
                  <th className="text-right px-4 py-2 text-xs font-semibold text-gray-500">Total</th>
                  <th className="text-right px-4 py-2 text-xs font-semibold text-gray-500">Pagado</th>
                  <th className="text-center px-4 py-2 text-xs font-semibold text-gray-500">Estado</th>
                </tr>
              </thead>
              <tbody className="divide-y divide-gray-200">
                {comprasFiltradas.map((c) => (
                  <tr key={c.id} className="hover:bg-gray-50">
                    <td className="px-4 py-2 text-sm">{formatDate(c.fecha)}</td>
                    <td className="px-4 py-2 text-sm">{getProveedor(c.proveedorId).nombre}</td>
                    <td className="px-4 py-2 text-sm text-center">{c.items?.length || 0}</td>
                    <td className="px-4 py-2 text-sm text-right font-semibold">{formatCurrency(c.total)}</td>
                    <td className="px-4 py-2 text-sm text-right">{formatCurrency(c.pagado || 0)}</td>
                    <td className="px-4 py-2 text-center">
                      <Badge variant={c.pagado >= c.total ? 'success' : 'warning'}>
                        {c.pagado >= c.total ? 'Pagado' : 'Pendiente'}
                      </Badge>
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    );
  };

  // ========== REPORTE DE GASTOS ==========
  const renderGastosReport = () => {
    const totalGastos = gastosFiltrados.reduce((sum, g) => sum + g.monto, 0);

    // Agrupar por categoría
    const gastosByCategoria = gastosFiltrados.reduce((acc, g) => {
      const catId = g.categoriaId || 0;
      if (!acc[catId]) acc[catId] = { total: 0, count: 0 };
      acc[catId].total += g.monto;
      acc[catId].count += 1;
      return acc;
    }, {});

    return (
      <div className="space-y-4">
        {/* Resumen */}
        <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
          <div className="bg-red-50 rounded-lg p-4 border border-red-200">
            <p className="text-sm text-red-600">Total Gastos</p>
            <p className="text-2xl font-bold text-red-700">{formatCurrency(totalGastos)}</p>
          </div>
          <div className="bg-purple-50 rounded-lg p-4 border border-purple-200">
            <p className="text-sm text-purple-600">Registros</p>
            <p className="text-2xl font-bold text-purple-700">{gastosFiltrados.length}</p>
          </div>
          <div className="bg-blue-50 rounded-lg p-4 border border-blue-200">
            <p className="text-sm text-blue-600">Promedio</p>
            <p className="text-2xl font-bold text-blue-700">{formatCurrency(gastosFiltrados.length > 0 ? totalGastos / gastosFiltrados.length : 0)}</p>
          </div>
        </div>

        <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
          {/* Por Categoría */}
          <div className="bg-white rounded-lg border border-gray-200 overflow-hidden">
            <div className="px-4 py-3 bg-gray-50 border-b font-semibold text-sm">Gastos por Categoría</div>
            <div className="max-h-64 overflow-auto">
              <table className="w-full">
                <thead className="bg-gray-50 sticky top-0">
                  <tr>
                    <th className="text-left px-4 py-2 text-xs font-semibold text-gray-500">Categoría</th>
                    <th className="text-right px-4 py-2 text-xs font-semibold text-gray-500">Registros</th>
                    <th className="text-right px-4 py-2 text-xs font-semibold text-gray-500">Total</th>
                    <th className="text-right px-4 py-2 text-xs font-semibold text-gray-500">%</th>
                  </tr>
                </thead>
                <tbody className="divide-y divide-gray-200">
                  {Object.entries(gastosByCategoria)
                    .sort((a, b) => b[1].total - a[1].total)
                    .map(([catId, data]) => (
                      <tr key={catId} className="hover:bg-gray-50">
                        <td className="px-4 py-2 text-sm">{getCategoria(Number(catId)).nombre}</td>
                        <td className="px-4 py-2 text-sm text-right">{data.count}</td>
                        <td className="px-4 py-2 text-sm text-right font-semibold">{formatCurrency(data.total)}</td>
                        <td className="px-4 py-2 text-sm text-right text-gray-500">
                          {totalGastos > 0 ? ((data.total / totalGastos) * 100).toFixed(1) : 0}%
                        </td>
                      </tr>
                    ))}
                </tbody>
              </table>
            </div>
          </div>

          {/* Barra de distribución */}
          <div className="bg-white rounded-lg border border-gray-200 p-4">
            <div className="font-semibold text-sm mb-4">Distribución de Gastos</div>
            <div className="space-y-3">
              {Object.entries(gastosByCategoria)
                .sort((a, b) => b[1].total - a[1].total)
                .slice(0, 6)
                .map(([catId, data]) => {
                  const pct = totalGastos > 0 ? (data.total / totalGastos) * 100 : 0;
                  return (
                    <div key={catId}>
                      <div className="flex justify-between text-sm mb-1">
                        <span>{getCategoria(Number(catId)).nombre}</span>
                        <span className="font-semibold">{formatCurrency(data.total)}</span>
                      </div>
                      <div className="w-full bg-gray-200 rounded-full h-2">
                        <div className="bg-emerald-500 h-2 rounded-full" style={{ width: `${pct}%` }}></div>
                      </div>
                    </div>
                  );
                })}
            </div>
          </div>
        </div>

        {/* Detalle */}
        <div className="bg-white rounded-lg border border-gray-200 overflow-hidden">
          <div className="px-4 py-3 bg-gray-50 border-b font-semibold text-sm">Detalle de Gastos</div>
          <div className="max-h-72 overflow-auto">
            <table className="w-full">
              <thead className="bg-gray-50 sticky top-0">
                <tr>
                  <th className="text-left px-4 py-2 text-xs font-semibold text-gray-500">Fecha</th>
                  <th className="text-left px-4 py-2 text-xs font-semibold text-gray-500">Categoría</th>
                  <th className="text-left px-4 py-2 text-xs font-semibold text-gray-500">Descripción</th>
                  <th className="text-right px-4 py-2 text-xs font-semibold text-gray-500">Monto</th>
                </tr>
              </thead>
              <tbody className="divide-y divide-gray-200">
                {gastosFiltrados.map((g) => (
                  <tr key={g.id} className="hover:bg-gray-50">
                    <td className="px-4 py-2 text-sm">{formatDate(g.fecha)}</td>
                    <td className="px-4 py-2 text-sm">{getCategoria(g.categoriaId).nombre}</td>
                    <td className="px-4 py-2 text-sm text-gray-600">{g.descripcion || '-'}</td>
                    <td className="px-4 py-2 text-sm text-right font-semibold">{formatCurrency(g.monto)}</td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    );
  };

  // ========== REPORTE FINANCIERO ==========
  const renderFinancieroReport = () => {
    const totalVentas = ventasFiltradas.reduce((sum, v) => sum + v.total, 0);
    const totalCompras = comprasFiltradas.reduce((sum, c) => sum + c.total, 0);
    const totalGastos = gastosFiltrados.reduce((sum, g) => sum + g.monto, 0);
    const utilidadBruta = totalVentas - totalCompras;
    const utilidadNeta = utilidadBruta - totalGastos;
    const margenBruto = totalVentas > 0 ? (utilidadBruta / totalVentas) * 100 : 0;
    const margenNeto = totalVentas > 0 ? (utilidadNeta / totalVentas) * 100 : 0;

    return (
      <div className="space-y-4">
        {/* Estado de Resultados */}
        <div className="bg-white rounded-lg border border-gray-200 overflow-hidden">
          <div className="px-4 py-3 bg-gray-50 border-b font-semibold">Estado de Resultados</div>
          <div className="p-4">
            <div className="space-y-3">
              <div className="flex justify-between items-center py-2 border-b">
                <span className="text-gray-600">Ingresos por Ventas</span>
                <span className="font-semibold text-emerald-600">{formatCurrency(totalVentas)}</span>
              </div>
              <div className="flex justify-between items-center py-2 border-b">
                <span className="text-gray-600">(-) Costo de Ventas (Compras)</span>
                <span className="font-semibold text-red-600">-{formatCurrency(totalCompras)}</span>
              </div>
              <div className="flex justify-between items-center py-2 border-b bg-blue-50 -mx-4 px-4">
                <span className="font-semibold text-blue-900">Utilidad Bruta</span>
                <span className={`font-bold ${utilidadBruta >= 0 ? 'text-blue-600' : 'text-red-600'}`}>
                  {formatCurrency(utilidadBruta)}
                </span>
              </div>
              <div className="flex justify-between items-center py-2 border-b">
                <span className="text-gray-600">(-) Gastos Operativos</span>
                <span className="font-semibold text-red-600">-{formatCurrency(totalGastos)}</span>
              </div>
              <div className="flex justify-between items-center py-3 bg-emerald-50 -mx-4 px-4 rounded-b">
                <span className="font-bold text-emerald-900">Utilidad Neta</span>
                <span className={`font-bold text-xl ${utilidadNeta >= 0 ? 'text-emerald-600' : 'text-red-600'}`}>
                  {formatCurrency(utilidadNeta)}
                </span>
              </div>
            </div>
          </div>
        </div>

        {/* Indicadores */}
        <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
          <div className="bg-white rounded-lg border border-gray-200 p-4">
            <p className="text-sm text-gray-500">Margen Bruto</p>
            <p className={`text-2xl font-bold ${margenBruto >= 0 ? 'text-blue-600' : 'text-red-600'}`}>
              {margenBruto.toFixed(1)}%
            </p>
          </div>
          <div className="bg-white rounded-lg border border-gray-200 p-4">
            <p className="text-sm text-gray-500">Margen Neto</p>
            <p className={`text-2xl font-bold ${margenNeto >= 0 ? 'text-emerald-600' : 'text-red-600'}`}>
              {margenNeto.toFixed(1)}%
            </p>
          </div>
          <div className="bg-white rounded-lg border border-gray-200 p-4">
            <p className="text-sm text-gray-500">Total Transacciones</p>
            <p className="text-2xl font-bold text-gray-700">
              {ventasFiltradas.length + comprasFiltradas.length}
            </p>
          </div>
          <div className="bg-white rounded-lg border border-gray-200 p-4">
            <p className="text-sm text-gray-500">Ticket Promedio Venta</p>
            <p className="text-2xl font-bold text-purple-600">
              {formatCurrency(ventasFiltradas.length > 0 ? totalVentas / ventasFiltradas.length : 0)}
            </p>
          </div>
        </div>

        {/* Resumen Visual */}
        <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
          <div className="bg-emerald-50 rounded-lg p-6 border border-emerald-200 text-center">
            <Icons.Transactions />
            <p className="text-sm text-emerald-600 mt-2">Ventas</p>
            <p className="text-3xl font-bold text-emerald-700">{formatCurrency(totalVentas)}</p>
            <p className="text-xs text-emerald-600 mt-1">{ventasFiltradas.length} transacciones</p>
          </div>
          <div className="bg-blue-50 rounded-lg p-6 border border-blue-200 text-center">
            <Icons.Cart />
            <p className="text-sm text-blue-600 mt-2">Compras</p>
            <p className="text-3xl font-bold text-blue-700">{formatCurrency(totalCompras)}</p>
            <p className="text-xs text-blue-600 mt-1">{comprasFiltradas.length} transacciones</p>
          </div>
          <div className="bg-red-50 rounded-lg p-6 border border-red-200 text-center">
            <Icons.Gastos />
            <p className="text-sm text-red-600 mt-2">Gastos</p>
            <p className="text-3xl font-bold text-red-700">{formatCurrency(totalGastos)}</p>
            <p className="text-xs text-red-600 mt-1">{gastosFiltrados.length} registros</p>
          </div>
        </div>
      </div>
    );
  };

  // ========== REPORTE DE CxC / CxP ==========
  const renderCuentasReport = () => {
    const totalCxC = cxc.reduce((sum, c) => sum + ((c.monto || 0) - (c.cobrado || 0)), 0);
    const totalCxP = cxp.reduce((sum, c) => sum + ((c.monto || 0) - (c.pagado || 0)), 0);
    const cxcPendientes = cxc.filter(c => (c.monto - (c.cobrado || 0)) > 0);
    const cxpPendientes = cxp.filter(c => (c.monto - (c.pagado || 0)) > 0);

    // Calcular antigüedad
    const calcularAntiguedad = (fecha) => {
      const hoy = new Date();
      const fechaDoc = new Date(fecha);
      const dias = Math.floor((hoy - fechaDoc) / (1000 * 60 * 60 * 24));
      return dias;
    };

    return (
      <div className="space-y-4">
        {/* Resumen */}
        <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
          <div className="bg-emerald-50 rounded-lg p-4 border border-emerald-200">
            <p className="text-sm text-emerald-600">Total CxC</p>
            <p className="text-2xl font-bold text-emerald-700">{formatCurrency(totalCxC)}</p>
          </div>
          <div className="bg-blue-50 rounded-lg p-4 border border-blue-200">
            <p className="text-sm text-blue-600">Cuentas CxC</p>
            <p className="text-2xl font-bold text-blue-700">{cxcPendientes.length}</p>
          </div>
          <div className="bg-red-50 rounded-lg p-4 border border-red-200">
            <p className="text-sm text-red-600">Total CxP</p>
            <p className="text-2xl font-bold text-red-700">{formatCurrency(totalCxP)}</p>
          </div>
          <div className="bg-amber-50 rounded-lg p-4 border border-amber-200">
            <p className="text-sm text-amber-600">Cuentas CxP</p>
            <p className="text-2xl font-bold text-amber-700">{cxpPendientes.length}</p>
          </div>
        </div>

        <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
          {/* CxC */}
          <div className="bg-white rounded-lg border border-gray-200 overflow-hidden">
            <div className="px-4 py-3 bg-emerald-50 border-b font-semibold text-sm flex justify-between items-center">
              <span>Cuentas por Cobrar</span>
              <span className="text-emerald-600">{formatCurrency(totalCxC)}</span>
            </div>
            <div className="max-h-80 overflow-auto">
              <table className="w-full">
                <thead className="bg-gray-50 sticky top-0">
                  <tr>
                    <th className="text-left px-4 py-2 text-xs font-semibold text-gray-500">Cliente</th>
                    <th className="text-left px-4 py-2 text-xs font-semibold text-gray-500">Fecha</th>
                    <th className="text-center px-4 py-2 text-xs font-semibold text-gray-500">Días</th>
                    <th className="text-right px-4 py-2 text-xs font-semibold text-gray-500">Saldo</th>
                  </tr>
                </thead>
                <tbody className="divide-y divide-gray-200">
                  {cxcPendientes
                    .sort((a, b) => a.fecha.localeCompare(b.fecha))
                    .map((c) => {
                      const dias = calcularAntiguedad(c.fecha);
                      return (
                        <tr key={c.id} className="hover:bg-gray-50">
                          <td className="px-4 py-2 text-sm">{getCliente(c.clienteId).nombre}</td>
                          <td className="px-4 py-2 text-sm">{formatDate(c.fecha)}</td>
                          <td className="px-4 py-2 text-center">
                            <Badge variant={dias > 60 ? 'danger' : dias > 30 ? 'warning' : 'success'}>
                              {dias}d
                            </Badge>
                          </td>
                          <td className="px-4 py-2 text-sm text-right font-semibold text-emerald-600">
                            {formatCurrency(c.monto - (c.cobrado || 0))}
                          </td>
                        </tr>
                      );
                    })}
                  {cxcPendientes.length === 0 && (
                    <tr><td colSpan="4" className="px-4 py-8 text-center text-gray-500">No hay cuentas pendientes</td></tr>
                  )}
                </tbody>
              </table>
            </div>
          </div>

          {/* CxP */}
          <div className="bg-white rounded-lg border border-gray-200 overflow-hidden">
            <div className="px-4 py-3 bg-red-50 border-b font-semibold text-sm flex justify-between items-center">
              <span>Cuentas por Pagar</span>
              <span className="text-red-600">{formatCurrency(totalCxP)}</span>
            </div>
            <div className="max-h-80 overflow-auto">
              <table className="w-full">
                <thead className="bg-gray-50 sticky top-0">
                  <tr>
                    <th className="text-left px-4 py-2 text-xs font-semibold text-gray-500">Proveedor</th>
                    <th className="text-left px-4 py-2 text-xs font-semibold text-gray-500">Fecha</th>
                    <th className="text-center px-4 py-2 text-xs font-semibold text-gray-500">Días</th>
                    <th className="text-right px-4 py-2 text-xs font-semibold text-gray-500">Saldo</th>
                  </tr>
                </thead>
                <tbody className="divide-y divide-gray-200">
                  {cxpPendientes
                    .sort((a, b) => a.fecha.localeCompare(b.fecha))
                    .map((c) => {
                      const dias = calcularAntiguedad(c.fecha);
                      return (
                        <tr key={c.id} className="hover:bg-gray-50">
                          <td className="px-4 py-2 text-sm">{getProveedor(c.proveedorId).nombre}</td>
                          <td className="px-4 py-2 text-sm">{formatDate(c.fecha)}</td>
                          <td className="px-4 py-2 text-center">
                            <Badge variant={dias > 60 ? 'danger' : dias > 30 ? 'warning' : 'success'}>
                              {dias}d
                            </Badge>
                          </td>
                          <td className="px-4 py-2 text-sm text-right font-semibold text-red-600">
                            {formatCurrency(c.monto - (c.pagado || 0))}
                          </td>
                        </tr>
                      );
                    })}
                  {cxpPendientes.length === 0 && (
                    <tr><td colSpan="4" className="px-4 py-8 text-center text-gray-500">No hay cuentas pendientes</td></tr>
                  )}
                </tbody>
              </table>
            </div>
          </div>
        </div>

        {/* Balance */}
        <div className="bg-white rounded-lg border border-gray-200 p-6">
          <div className="flex items-center justify-between">
            <div className="text-center flex-1">
              <p className="text-sm text-gray-500">Por Cobrar</p>
              <p className="text-2xl font-bold text-emerald-600">{formatCurrency(totalCxC)}</p>
            </div>
            <div className="text-4xl text-gray-300 px-8">−</div>
            <div className="text-center flex-1">
              <p className="text-sm text-gray-500">Por Pagar</p>
              <p className="text-2xl font-bold text-red-600">{formatCurrency(totalCxP)}</p>
            </div>
            <div className="text-4xl text-gray-300 px-8">=</div>
            <div className="text-center flex-1">
              <p className="text-sm text-gray-500">Balance</p>
              <p className={`text-2xl font-bold ${(totalCxC - totalCxP) >= 0 ? 'text-blue-600' : 'text-red-600'}`}>
                {formatCurrency(totalCxC - totalCxP)}
              </p>
            </div>
          </div>
        </div>
      </div>
    );
  };

  // ========== REPORTE DE FLUJO DE CAJA ==========
  const renderFlujoCajaReport = () => {
    // Agrupar datos por mes
    const getMonthKey = (dateStr) => {
      const parts = parseDateString(dateStr);
      if (!parts) return null;
      return `${parts.year}-${String(parts.month).padStart(2, '0')}`;
    };

    const getMonthLabel = (monthKey) => {
      const [year, month] = monthKey.split('-');
      const months = ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic'];
      return `${months[parseInt(month) - 1]} ${year.slice(-2)}`;
    };

    // Calcular ingresos por mes (cobros reales de ventas)
    const cobrosByMonth = {};
    cxc.forEach(c => {
      (c.cobros || []).forEach(cobro => {
        const key = getMonthKey(cobro.fecha);
        if (key) {
          cobrosByMonth[key] = (cobrosByMonth[key] || 0) + cobro.monto;
        }
      });
    });

    // Ventas de contado (pagadas inmediatamente)
    ventas.forEach(v => {
      if (v.cobrado >= v.total) {
        const key = getMonthKey(v.fecha);
        if (key && !cxc.find(c => c.ventaId === v.id)) {
          cobrosByMonth[key] = (cobrosByMonth[key] || 0) + v.total;
        }
      }
    });

    // Calcular egresos por mes (pagos reales de compras + gastos)
    const pagosByMonth = {};
    cxp.forEach(c => {
      (c.pagos || []).forEach(pago => {
        const key = getMonthKey(pago.fecha);
        if (key) {
          pagosByMonth[key] = (pagosByMonth[key] || 0) + pago.monto;
        }
      });
    });

    // Compras de contado
    compras.forEach(c => {
      if (c.pagado >= c.total) {
        const key = getMonthKey(c.fecha);
        if (key && !cxp.find(cp => cp.compraId === c.id)) {
          pagosByMonth[key] = (pagosByMonth[key] || 0) + c.total;
        }
      }
    });

    // Gastos por mes
    gastos.forEach(g => {
      const key = getMonthKey(g.fecha);
      if (key) {
        pagosByMonth[key] = (pagosByMonth[key] || 0) + g.monto;
      }
    });

    // Obtener todos los meses únicos y ordenar
    const allMonths = [...new Set([...Object.keys(cobrosByMonth), ...Object.keys(pagosByMonth)])].sort();

    // Crear datos para el gráfico
    const chartData = allMonths.map(month => {
      const ingresos = cobrosByMonth[month] || 0;
      const egresos = pagosByMonth[month] || 0;
      return {
        mes: getMonthLabel(month),
        monthKey: month,
        ingresos,
        egresos,
        flujoNeto: ingresos - egresos
      };
    });

    // Calcular flujo acumulado
    let acumulado = 0;
    chartData.forEach(d => {
      acumulado += d.flujoNeto;
      d.acumulado = acumulado;
    });

    // Proyección (próximos 3 meses basado en promedio)
    const promedioIngresos = chartData.length > 0 ? chartData.reduce((s, d) => s + d.ingresos, 0) / chartData.length : 0;
    const promedioEgresos = chartData.length > 0 ? chartData.reduce((s, d) => s + d.egresos, 0) / chartData.length : 0;
    
    const today = new Date();
    const proyeccion = [];
    for (let i = 1; i <= 3; i++) {
      const futureDate = new Date(today.getFullYear(), today.getMonth() + i, 1);
      const monthKey = `${futureDate.getFullYear()}-${String(futureDate.getMonth() + 1).padStart(2, '0')}`;
      const months = ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic'];
      acumulado += (promedioIngresos - promedioEgresos);
      proyeccion.push({
        mes: `${months[futureDate.getMonth()]} ${String(futureDate.getFullYear()).slice(-2)}`,
        monthKey,
        ingresos: Math.round(promedioIngresos),
        egresos: Math.round(promedioEgresos),
        flujoNeto: Math.round(promedioIngresos - promedioEgresos),
        acumulado: Math.round(acumulado),
        proyectado: true
      });
    }

    const allData = [...chartData, ...proyeccion];

    // Totales
    const totalIngresos = chartData.reduce((s, d) => s + d.ingresos, 0);
    const totalEgresos = chartData.reduce((s, d) => s + d.egresos, 0);
    const flujoNetoTotal = totalIngresos - totalEgresos;

    // CxC y CxP pendientes (flujo futuro esperado)
    const cxcPendiente = cxc.reduce((sum, c) => sum + ((c.monto || 0) - (c.cobrado || 0)), 0);
    const cxpPendiente = cxp.reduce((sum, c) => sum + ((c.monto || 0) - (c.pagado || 0)), 0);

    return (
      <div className="space-y-4">
        {/* Resumen */}
        <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
          <div className="bg-emerald-50 rounded-lg p-4 border border-emerald-200">
            <p className="text-sm text-emerald-600">Ingresos (Cobros)</p>
            <p className="text-2xl font-bold text-emerald-700">{formatCurrency(totalIngresos)}</p>
          </div>
          <div className="bg-red-50 rounded-lg p-4 border border-red-200">
            <p className="text-sm text-red-600">Egresos (Pagos + Gastos)</p>
            <p className="text-2xl font-bold text-red-700">{formatCurrency(totalEgresos)}</p>
          </div>
          <div className={`rounded-lg p-4 border ${flujoNetoTotal >= 0 ? 'bg-blue-50 border-blue-200' : 'bg-amber-50 border-amber-200'}`}>
            <p className={`text-sm ${flujoNetoTotal >= 0 ? 'text-blue-600' : 'text-amber-600'}`}>Flujo Neto</p>
            <p className={`text-2xl font-bold ${flujoNetoTotal >= 0 ? 'text-blue-700' : 'text-amber-700'}`}>{formatCurrency(flujoNetoTotal)}</p>
          </div>
          <div className="bg-purple-50 rounded-lg p-4 border border-purple-200">
            <p className="text-sm text-purple-600">Flujo Futuro Esperado</p>
            <p className="text-2xl font-bold text-purple-700">{formatCurrency(cxcPendiente - cxpPendiente)}</p>
            <p className="text-xs text-purple-500">CxC - CxP pendientes</p>
          </div>
        </div>

        {/* Proyección próximos 3 meses */}
        <div className="bg-white rounded-lg border border-gray-200 p-4">
          <h3 className="font-semibold text-gray-900 mb-4 flex items-center gap-2">
            <Icons.Chart /> Flujo de Caja Proyectado
          </h3>
          <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4 mb-6">
            {proyeccion.map((p, idx) => (
              <div key={idx} className="bg-blue-50 rounded-lg p-4 border border-blue-200">
                <p className="text-sm text-blue-600 font-medium">{p.mes.toUpperCase()}</p>
                <p className={`text-2xl font-bold ${p.flujoNeto >= 0 ? 'text-blue-700' : 'text-red-600'}`}>
                  ↗ {formatCurrency(p.flujoNeto)}
                </p>
                <p className="text-xs text-blue-500">+{formatCurrency(p.ingresos)} / -{formatCurrency(p.egresos)}</p>
              </div>
            ))}
          </div>

          {/* Gráfico */}
          {allData.length > 0 && (
            <div className="h-64">
              <div className="flex justify-center gap-6 mb-4 text-xs">
                <span className="flex items-center gap-1"><span className="w-3 h-3 rounded-full bg-emerald-500"></span> Ingresos</span>
                <span className="flex items-center gap-1"><span className="w-3 h-3 rounded-full bg-red-500"></span> Egresos</span>
                <span className="flex items-center gap-1"><span className="w-3 h-3 rounded-full bg-blue-500"></span> Flujo Neto</span>
                <span className="flex items-center gap-1"><span className="w-3 h-0.5 bg-purple-500" style={{width: '12px'}}></span> Proyectado</span>
              </div>
              <div className="relative h-48 flex items-end gap-1">
                {allData.map((d, idx) => {
                  const maxVal = Math.max(...allData.map(x => Math.max(x.ingresos, x.egresos, Math.abs(x.flujoNeto)))) || 1;
                  const ingresosHeight = (d.ingresos / maxVal) * 100;
                  const egresosHeight = (d.egresos / maxVal) * 100;
                  return (
                    <div key={idx} className={`flex-1 flex flex-col items-center ${d.proyectado ? 'opacity-60' : ''}`}>
                      <div className="w-full flex gap-0.5 items-end h-40">
                        <div 
                          className="flex-1 bg-emerald-500 rounded-t" 
                          style={{ height: `${ingresosHeight}%`, minHeight: d.ingresos > 0 ? '4px' : '0' }}
                        ></div>
                        <div 
                          className="flex-1 bg-red-500 rounded-t" 
                          style={{ height: `${egresosHeight}%`, minHeight: d.egresos > 0 ? '4px' : '0' }}
                        ></div>
                      </div>
                      <p className={`text-xs mt-1 ${d.proyectado ? 'text-purple-600 font-medium' : 'text-gray-500'}`}>{d.mes}</p>
                    </div>
                  );
                })}
              </div>
            </div>
          )}

          {allData.length === 0 && (
            <div className="text-center py-12 text-gray-500">
              No hay datos suficientes para mostrar el flujo de caja.
              <br />Registra ventas, compras y gastos para ver el análisis.
            </div>
          )}
        </div>

        {/* Detalle mensual */}
        <div className="bg-white rounded-lg border border-gray-200 overflow-hidden">
          <div className="px-4 py-3 bg-gray-50 border-b font-semibold text-sm">Detalle Mensual</div>
          <div className="overflow-x-auto">
            <table className="w-full">
              <thead className="bg-gray-50">
                <tr>
                  <th className="text-left px-4 py-2 text-xs font-semibold text-gray-500">Mes</th>
                  <th className="text-right px-4 py-2 text-xs font-semibold text-gray-500">Ingresos</th>
                  <th className="text-right px-4 py-2 text-xs font-semibold text-gray-500">Egresos</th>
                  <th className="text-right px-4 py-2 text-xs font-semibold text-gray-500">Flujo Neto</th>
                  <th className="text-right px-4 py-2 text-xs font-semibold text-gray-500">Acumulado</th>
                  <th className="text-center px-4 py-2 text-xs font-semibold text-gray-500">Tipo</th>
                </tr>
              </thead>
              <tbody className="divide-y divide-gray-200">
                {allData.map((d, idx) => (
                  <tr key={idx} className={`hover:bg-gray-50 ${d.proyectado ? 'bg-purple-50/50' : ''}`}>
                    <td className="px-4 py-2 text-sm font-medium">{d.mes}</td>
                    <td className="px-4 py-2 text-sm text-right text-emerald-600">{formatCurrency(d.ingresos)}</td>
                    <td className="px-4 py-2 text-sm text-right text-red-600">{formatCurrency(d.egresos)}</td>
                    <td className={`px-4 py-2 text-sm text-right font-semibold ${d.flujoNeto >= 0 ? 'text-blue-600' : 'text-amber-600'}`}>
                      {formatCurrency(d.flujoNeto)}
                    </td>
                    <td className={`px-4 py-2 text-sm text-right ${d.acumulado >= 0 ? 'text-gray-700' : 'text-red-600'}`}>
                      {formatCurrency(d.acumulado)}
                    </td>
                    <td className="px-4 py-2 text-center">
                      <Badge variant={d.proyectado ? 'info' : 'success'}>
                        {d.proyectado ? 'Proyectado' : 'Real'}
                      </Badge>
                    </td>
                  </tr>
                ))}
                {allData.length === 0 && (
                  <tr><td colSpan="6" className="px-4 py-8 text-center text-gray-500">Sin datos</td></tr>
                )}
              </tbody>
            </table>
          </div>
        </div>

        {/* Indicadores de liquidez */}
        <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
          <div className="bg-white rounded-lg border border-gray-200 p-4">
            <h3 className="font-semibold text-gray-900 mb-3">💰 Posición de Liquidez</h3>
            <div className="space-y-2">
              <div className="flex justify-between items-center py-1 border-b">
                <span className="text-sm text-gray-600">Por Cobrar (CxC)</span>
                <span className="font-semibold text-emerald-600">+{formatCurrency(cxcPendiente)}</span>
              </div>
              <div className="flex justify-between items-center py-1 border-b">
                <span className="text-sm text-gray-600">Por Pagar (CxP)</span>
                <span className="font-semibold text-red-600">-{formatCurrency(cxpPendiente)}</span>
              </div>
              <div className="flex justify-between items-center py-2 bg-gray-50 -mx-4 px-4">
                <span className="font-semibold">Flujo Neto Esperado</span>
                <span className={`font-bold ${(cxcPendiente - cxpPendiente) >= 0 ? 'text-blue-600' : 'text-red-600'}`}>
                  {formatCurrency(cxcPendiente - cxpPendiente)}
                </span>
              </div>
            </div>
          </div>

          <div className="bg-white rounded-lg border border-gray-200 p-4">
            <h3 className="font-semibold text-gray-900 mb-3">📊 Indicadores</h3>
            <div className="space-y-2">
              <div className="flex justify-between items-center py-1 border-b">
                <span className="text-sm text-gray-600">Promedio Ingresos/Mes</span>
                <span className="font-semibold text-emerald-600">{formatCurrency(promedioIngresos)}</span>
              </div>
              <div className="flex justify-between items-center py-1 border-b">
                <span className="text-sm text-gray-600">Promedio Egresos/Mes</span>
                <span className="font-semibold text-red-600">{formatCurrency(promedioEgresos)}</span>
              </div>
              <div className="flex justify-between items-center py-1">
                <span className="text-sm text-gray-600">Ratio Cobertura</span>
                <span className={`font-semibold ${promedioEgresos > 0 && promedioIngresos/promedioEgresos >= 1 ? 'text-emerald-600' : 'text-amber-600'}`}>
                  {promedioEgresos > 0 ? (promedioIngresos/promedioEgresos).toFixed(2) : 'N/A'}x
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>
    );
  };

  // Renderizar reporte según selección
  const renderReport = () => {
    switch (selectedReport) {
      case 'inventario': return renderInventarioReport();
      case 'ventas': return renderVentasReport();
      case 'compras': return renderComprasReport();
      case 'gastos': return renderGastosReport();
      case 'financiero': return renderFinancieroReport();
      case 'cuentas': return renderCuentasReport();
      case 'flujoCaja': return renderFlujoCajaReport();
      default: return renderInventarioReport();
    }
  };

  return (
    <div className="space-y-6">
      {/* Header con logo para impresión */}
      <div className="flex items-center justify-between print:mb-4">
        <div className="flex items-center gap-4">
          <LogoNombre className="h-8 hidden print:block" inverted={false} />
          <div className="print:border-l print:border-gray-300 print:pl-4">
            <h1 className="text-2xl font-bold text-gray-900">Reportes</h1>
            <p className="text-gray-500 text-sm">Análisis y reportes del sistema</p>
          </div>
        </div>
        <div className="print:hidden">
          {selectedReport !== 'inventario' && selectedReport !== 'cuentas' && selectedReport !== 'flujoCaja' && (
            <PeriodFilter selectedPeriod={selectedPeriod} onPeriodChange={setSelectedPeriod} />
          )}
        </div>
      </div>

      {/* Selector de reportes */}
      <div className="flex gap-2 overflow-x-auto pb-2">
        {reportTypes.map((report) => (
          <button
            key={report.id}
            onClick={() => setSelectedReport(report.id)}
            className={`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium whitespace-nowrap transition-colors ${
              selectedReport === report.id
                ? 'bg-emerald-600 text-white'
                : 'bg-white border border-gray-200 text-gray-600 hover:bg-gray-50'
            }`}
          >
            <report.icon />
            {report.label}
          </button>
        ))}
      </div>

      {/* Contenido del reporte */}
      {renderReport()}
    </div>
  );
};


// Análisis IA Module - Reestructurado
const AnalisisIAModule = ({ inventory, toros, compras, ventas, cxc, cxp, gastos, clientes, proveedores, categorias = [] }) => {
  const [analyzing, setAnalyzing] = useState(false);

  // Helpers
  const getToro = (id) => toros.find(t => t.id === id) || { codigo: '???', nombre: 'Desconocido' };
  const getCliente = (id) => clientes.find(c => c.id === id) || { nombre: 'Desconocido' };
  const getCategoria = (id) => categorias.find(c => c.id === id) || { nombre: 'Sin categoría' };

  // ========== CÁLCULOS ==========
  
  // Inventario por toro
  const inventarioByToro = inventory.reduce((acc, item) => {
    if (!acc[item.toroId]) acc[item.toroId] = 0;
    acc[item.toroId] += item.cantidad;
    return acc;
  }, {});

  // Ventas por toro
  const ventasByToro = ventas.reduce((acc, v) => {
    (v.items || []).forEach(item => {
      if (!acc[item.toroId]) acc[item.toroId] = { cantidad: 0, total: 0 };
      acc[item.toroId].cantidad += item.cantidad;
      acc[item.toroId].total += item.subtotal;
    });
    return acc;
  }, {});

  // Compras por toro
  const comprasByToro = compras.reduce((acc, c) => {
    (c.items || []).forEach(item => {
      if (!acc[item.toroId]) acc[item.toroId] = { cantidad: 0, total: 0 };
      acc[item.toroId].cantidad += item.cantidad;
      acc[item.toroId].total += item.subtotal;
    });
    return acc;
  }, {});

  // Gastos por categoría
  const gastosByCategoria = gastos.reduce((acc, g) => {
    const catId = g.categoriaId || 0;
    if (!acc[catId]) acc[catId] = 0;
    acc[catId] += g.monto;
    return acc;
  }, {});

  // Totales
  const totalVentas = ventas.reduce((sum, v) => sum + v.total, 0);
  const totalCompras = compras.reduce((sum, c) => sum + c.total, 0);
  const totalGastos = gastos.reduce((sum, g) => sum + g.monto, 0);
  const totalCxC = cxc.reduce((sum, c) => sum + ((c.monto || 0) - (c.cobrado || 0)), 0);
  const totalCxP = cxp.reduce((sum, c) => sum + ((c.monto || 0) - (c.pagado || 0)), 0);
  const totalPajillas = inventory.reduce((sum, i) => sum + i.cantidad, 0);
  const utilidadNeta = totalVentas - totalCompras - totalGastos;

  // Stock bajo
  const stockBajo = Object.entries(inventarioByToro)
    .filter(([_, cant]) => cant < 10 && cant > 0)
    .map(([toroId, cant]) => ({ toro: getToro(Number(toroId)), cantidad: cant }));

  // Toros sin stock
  const sinStock = toros.filter(t => t.activo !== false && !inventarioByToro[t.id]);

  // Toros a reabastecer (con ventas pero bajo stock)
  const torosReabastecer = Object.entries(ventasByToro)
    .filter(([toroId]) => {
      const stock = inventarioByToro[toroId] || 0;
      return stock < 15;
    })
    .map(([toroId, data]) => ({
      toro: getToro(Number(toroId)),
      stock: inventarioByToro[toroId] || 0,
      vendido: data.cantidad
    }))
    .sort((a, b) => a.stock - b.stock)
    .slice(0, 5);

  // Bajo movimiento (mucho stock, pocas ventas)
  const bajoMovimiento = Object.entries(inventarioByToro)
    .filter(([toroId, cant]) => {
      const vendido = ventasByToro[toroId]?.cantidad || 0;
      return cant > 30 && vendido < 5;
    })
    .map(([toroId, cant]) => ({
      toro: getToro(Number(toroId)),
      stock: cant,
      vendido: ventasByToro[toroId]?.cantidad || 0
    }));

  // Tendencias de gastos por categoría
  const totalGastosVal = Object.values(gastosByCategoria).reduce((s, v) => s + v, 0) || 1;
  const tendenciasGastos = Object.entries(gastosByCategoria)
    .map(([catId, monto]) => ({
      categoria: getCategoria(Number(catId)).nombre,
      monto,
      porcentaje: Math.round((monto / totalGastosVal) * 100)
    }))
    .sort((a, b) => b.monto - a.monto);

  // Generar resumen ejecutivo
  const generarResumenEjecutivo = () => {
    const partes = [];
    
    if (Object.keys(ventasByToro).length === 1) {
      partes.push('solo se han realizado ventas de un toro');
    }
    
    const gastosAltos = tendenciasGastos.filter(g => g.porcentaje > 30);
    if (gastosAltos.length > 0) {
      partes.push(`los gastos en ${gastosAltos[0].categoria.toLowerCase()} son altos`);
    }
    
    if (bajoMovimiento.length > 0) {
      partes.push('no se ha utilizado en su totalidad el potencial de ventas de otros toros');
    }
    
    if (partes.length === 0) {
      return 'El negocio muestra un comportamiento estable. Continúe monitoreando los indicadores clave.';
    }
    
    return `Se identificó que el inventario de pajillas es amplio, pero ${partes.join('. ')}. Se recomienda ajustar el modelo financiero antes de la próxima compra.`;
  };

  // Simular análisis
  const runAnalysis = () => {
    setAnalyzing(true);
    setTimeout(() => setAnalyzing(false), 1200);
  };

  useEffect(() => { runAnalysis(); }, []);

  // Alertas
  const alertas = [];
  
  if (utilidadNeta < 0) {
    alertas.push({
      tipo: 'error',
      titulo: 'Pérdida económica significativa',
      mensaje: `Las ganancias netas están en ${formatCurrency(utilidadNeta)}, lo que sugiere un problema financiero severo que requiere atención inmediata.`
    });
  }
  
  if (totalCxP > totalCxC && totalCxP > 100) {
    alertas.push({
      tipo: 'warning',
      titulo: 'Cuentas por pagar elevadas',
      mensaje: `Cuentas por pagar son ${formatCurrency(totalCxP)}, sugiriendo que podrían existir problemas de liquidez.`
    });
  }

  return (
    <div className="space-y-6">
      {/* Header */}
      <div className="flex items-center justify-between">
        <div className="flex items-center gap-3">
          <div className="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center">
            <Icons.Analisis />
          </div>
          <div>
            <h1 className="text-xl font-bold text-gray-900">Análisis con IA</h1>
            <p className="text-gray-500 text-sm">Insights generados automáticamente</p>
          </div>
        </div>
        <Button onClick={runAnalysis} disabled={analyzing} variant="secondary">
          {analyzing ? (
            <><div className="w-4 h-4 border-2 border-gray-300 border-t-gray-600 rounded-full animate-spin" /> Analizando...</>
          ) : (
            <><Icons.Analisis /> Actualizar</>
          )}
        </Button>
      </div>

      {analyzing ? (
        <div className="bg-white rounded-lg border p-12 text-center">
          <div className="w-12 h-12 border-4 border-purple-200 border-t-purple-600 rounded-full animate-spin mx-auto mb-4" />
          <p className="text-gray-600">Analizando datos del negocio...</p>
        </div>
      ) : (
        <>
          {/* Banner Resumen Ejecutivo */}
          <div className="bg-gradient-to-r from-blue-600 to-blue-700 rounded-lg p-4 text-white">
            <p className="text-sm opacity-90">{generarResumenEjecutivo()}</p>
          </div>

          {/* Alertas */}
          {alertas.map((alerta, idx) => (
            <div key={idx} className={`rounded-lg p-4 border ${
              alerta.tipo === 'error' ? 'bg-red-50 border-red-200' : 'bg-amber-50 border-amber-200'
            }`}>
              <div className="flex items-start gap-2">
                <span className={`text-lg ${alerta.tipo === 'error' ? 'text-red-500' : 'text-amber-500'}`}>⚠️</span>
                <div>
                  <p className={`text-sm font-medium ${alerta.tipo === 'error' ? 'text-red-700' : 'text-amber-700'}`}>
                    {alerta.titulo}
                  </p>
                  <p className={`text-sm ${alerta.tipo === 'error' ? 'text-red-600' : 'text-amber-600'}`}>
                    {alerta.mensaje}
                  </p>
                </div>
              </div>
            </div>
          ))}

          {/* Grid Principal */}
          <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
            {/* Predicciones de Inventario */}
            <div className="bg-white rounded-lg border border-gray-200 p-4">
              <h3 className="font-semibold text-gray-900 mb-4 flex items-center gap-2">
                <span className="text-purple-500">📦</span> Predicciones de Inventario
              </h3>
              
              {/* Toros a reabastecer */}
              <div className="mb-4">
                <p className="text-sm text-gray-500 flex items-center gap-1 mb-2">
                  <span className="w-2 h-2 bg-red-500 rounded-full"></span> Toros a reabastecer:
                </p>
                <div className="flex flex-wrap gap-1">
                  {torosReabastecer.length > 0 ? torosReabastecer.map((item, idx) => (
                    <Badge key={idx} variant={item.stock === 0 ? 'danger' : 'warning'}>
                      {item.toro.codigo}
                    </Badge>
                  )) : <span className="text-sm text-gray-400">Ninguno por ahora</span>}
                </div>
              </div>

              {/* Bajo movimiento */}
              <div className="mb-4">
                <p className="text-sm text-gray-500 flex items-center gap-1 mb-2">
                  <span className="w-2 h-2 bg-amber-500 rounded-full"></span> Bajo movimiento:
                </p>
                <div className="flex flex-wrap gap-1">
                  {bajoMovimiento.length > 0 ? bajoMovimiento.map((item, idx) => (
                    <Badge key={idx} variant="info">{item.toro.codigo}</Badge>
                  )) : <span className="text-sm text-gray-400">Ninguno detectado</span>}
                </div>
              </div>

              {/* Recomendación */}
              {(torosReabastecer.length > 0 || bajoMovimiento.length > 0) && (
                <div className="bg-purple-50 rounded-lg p-3 border border-purple-100">
                  <p className="text-sm text-purple-700 flex items-start gap-2">
                    <span>💡</span>
                    <span>
                      {torosReabastecer.length > 0 && `Reabastecer los toros ${torosReabastecer.map(t => t.toro.codigo).join(' y ')} dado su movimiento en ventas. `}
                      {bajoMovimiento.length > 0 && `Considerar reducir la cantidad de pajillas del toro ${bajoMovimiento[0].toro.codigo} ya que solo tiene ${bajoMovimiento[0].vendido || 0} en stock y no ha vendido.`}
                    </span>
                  </p>
                </div>
              )}
            </div>

            {/* Análisis de Gastos */}
            <div className="bg-white rounded-lg border border-gray-200 p-4">
              <h3 className="font-semibold text-gray-900 mb-4 flex items-center gap-2">
                <span className="text-purple-500">📊</span> Análisis de Gastos
              </h3>
              
              {/* Tendencias por tipo */}
              <div className="mb-4">
                <p className="text-sm text-gray-500 flex items-center gap-1 mb-2">
                  <span className="text-gray-400">📈</span> Tendencias por tipo:
                </p>
                <div className="space-y-2">
                  {tendenciasGastos.slice(0, 4).map((item, idx) => (
                    <div key={idx} className="flex items-center justify-between">
                      <div>
                        <p className="text-sm font-medium text-gray-700">{item.categoria}</p>
                        <p className="text-xs text-gray-400">Revisar costos y evaluar alternativas</p>
                      </div>
                      <Badge variant={item.porcentaje > 40 ? 'danger' : item.porcentaje > 20 ? 'warning' : 'success'}>
                        {item.porcentaje}%
                      </Badge>
                    </div>
                  ))}
                  {tendenciasGastos.length === 0 && (
                    <p className="text-sm text-gray-400">Sin gastos registrados</p>
                  )}
                </div>
              </div>

              {/* Oportunidades de ahorro */}
              <div className="mb-4">
                <p className="text-sm text-gray-500 flex items-center gap-1 mb-2">
                  <span className="text-amber-500">💰</span> Oportunidades de ahorro:
                </p>
                <div className="space-y-2">
                  {tendenciasGastos.slice(0, 3).map((item, idx) => (
                    <div key={idx} className="flex items-center justify-between">
                      <div>
                        <p className={`text-sm font-medium ${idx === 0 ? 'text-emerald-600' : idx === 1 ? 'text-amber-600' : 'text-blue-600'}`}>
                          {item.categoria}
                        </p>
                        <p className="text-xs text-gray-400">
                          {idx === 0 ? 'Emitir una lista de proveedores y negociar tarifas' :
                           idx === 1 ? 'Considerar compras en mayor volumen para obtener descuentos' :
                           'Realizar un análisis detallado de los costos'}
                        </p>
                      </div>
                      <Badge variant={idx === 0 ? 'success' : idx === 1 ? 'warning' : 'info'}>
                        {idx === 0 ? '5%' : idx === 1 ? '10%' : 'revisar'}
                      </Badge>
                    </div>
                  ))}
                </div>
              </div>

              {/* Insight de gastos */}
              <div className="bg-blue-50 rounded-lg p-3 border border-blue-100">
                <p className="text-sm text-blue-700 flex items-start gap-2">
                  <span>📋</span>
                  <span>
                    Los gastos son principalmente en {tendenciasGastos[0]?.categoria?.toLowerCase() || 'operaciones'}
                    {tendenciasGastos[1] ? ` y ${tendenciasGastos[1].categoria.toLowerCase()}` : ''}, 
                    manteniendo una tendencia estable. Es crucial optimizar para mejorar la rentabilidad.
                  </span>
                </p>
              </div>
            </div>
          </div>

          {/* Recomendaciones Financieras */}
          <div className="bg-white rounded-lg border border-gray-200 p-4">
            <h3 className="font-semibold text-gray-900 mb-4 flex items-center gap-2">
              <span className="text-yellow-500">💡</span> Recomendaciones Financieras
            </h3>
            
            <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
              {/* Acciones Prioritarias */}
              <div>
                <p className="text-sm font-medium text-emerald-600 flex items-center gap-1 mb-2">
                  <span className="w-2 h-2 bg-emerald-500 rounded-full"></span> Acciones Prioritarias
                </p>
                <ol className="text-sm text-gray-600 space-y-1 list-decimal list-inside">
                  <li>Revisar y ajustar precios de venta de pajillas para cubrir costos fijos y maximizar las ganancias.</li>
                  <li>Negociar cuentas por cobrar con proveedores para mejorar el flujo de caja.</li>
                  <li>Analizar posibles mercados para aumentar las ventas y disminuir inventarios obsoletos.</li>
                </ol>
              </div>

              {/* Estrategia de Cobros */}
              <div>
                <p className="text-sm font-medium text-blue-600 flex items-center gap-1 mb-2">
                  <span className="w-2 h-2 bg-blue-500 rounded-full"></span> Estrategia de Cobros
                </p>
                {totalCxC > 0 ? (
                  <ul className="text-sm text-gray-600 space-y-1">
                    <li>• Priorizar cobros mayores a 30 días</li>
                    <li>• Implementar recordatorios automáticos</li>
                    <li>• Ofrecer descuentos por pronto pago</li>
                  </ul>
                ) : (
                  <p className="text-sm text-gray-400">Sin recomendaciones específicas</p>
                )}
              </div>

              {/* Estrategia de Pagos */}
              <div>
                <p className="text-sm font-medium text-red-600 flex items-center gap-1 mb-2">
                  <span className="w-2 h-2 bg-red-500 rounded-full"></span> Estrategia de Pagos
                </p>
                {totalCxP > 0 ? (
                  <ul className="text-sm text-gray-600 space-y-1">
                    <li>• Negociar plazos más amplios</li>
                    <li>• Priorizar proveedores estratégicos</li>
                    <li>• Consolidar compras para mejores precios</li>
                  </ul>
                ) : (
                  <p className="text-sm text-gray-400">Sin recomendaciones específicas</p>
                )}
              </div>
            </div>
          </div>

          {/* Resumen de Indicadores */}
          <div className="grid grid-cols-5 gap-4">
            <div className="bg-white rounded-lg border p-4 text-center">
              <p className="text-xs text-gray-500">Pajillas en Stock</p>
              <p className="text-xl font-bold text-gray-900">{totalPajillas.toLocaleString()}</p>
            </div>
            <div className="bg-white rounded-lg border p-4 text-center">
              <p className="text-xs text-gray-500">Ventas Totales</p>
              <p className="text-xl font-bold text-emerald-600">{formatCurrency(totalVentas)}</p>
            </div>
            <div className="bg-white rounded-lg border p-4 text-center">
              <p className="text-xs text-gray-500">Por Cobrar</p>
              <p className="text-xl font-bold text-blue-600">{formatCurrency(totalCxC)}</p>
            </div>
            <div className="bg-white rounded-lg border p-4 text-center">
              <p className="text-xs text-gray-500">Por Pagar</p>
              <p className="text-xl font-bold text-red-600">{formatCurrency(totalCxP)}</p>
            </div>
            <div className="bg-white rounded-lg border p-4 text-center">
              <p className="text-xs text-gray-500">Utilidad Neta</p>
              <p className={`text-xl font-bold ${utilidadNeta >= 0 ? 'text-emerald-600' : 'text-red-600'}`}>
                {formatCurrency(utilidadNeta)}
              </p>
            </div>
          </div>
        </>
      )}
    </div>
  );
};

// Configuración Module
const ConfiguracionModule = ({ 
  toros, proveedores, clientes, categorias, inventory, compras, ventas, cxc, cxp, gastos,
  onExportar, onImportar, onLimpiar,
  usuarios, onUpdateUsuario, onAddUsuario, onDeleteUsuario
}) => {
  const [showConfirmClear, setShowConfirmClear] = useState(false);
  const [confirmText, setConfirmText] = useState('');
  const [importStatus, setImportStatus] = useState(null);
  const [showUserModal, setShowUserModal] = useState(false);
  const [editingUser, setEditingUser] = useState(null);
  const [userForm, setUserForm] = useState({ username: '', password: '', name: '', role: 'ventas' });
  const fileInputRef = React.useRef(null);

  // Estadísticas
  const stats = {
    toros: toros.length,
    proveedores: proveedores.length,
    clientes: clientes.length,
    categorias: categorias.length,
    inventario: inventory.length,
    pajillas: inventory.reduce((sum, i) => sum + i.cantidad, 0),
    compras: compras.length,
    ventas: ventas.length,
    cxc: cxc.length,
    cxp: cxp.length,
    gastos: gastos.length,
  };

  const handleFileSelect = async (e) => {
    const file = e.target.files[0];
    if (file) {
      try {
        setImportStatus('loading');
        await onImportar(file);
        setImportStatus('success');
        setTimeout(() => setImportStatus(null), 3000);
      } catch (error) {
        setImportStatus('error');
        setTimeout(() => setImportStatus(null), 3000);
      }
    }
    e.target.value = '';
  };

  const handleClearData = () => {
    if (confirmText === 'ELIMINAR') {
      onLimpiar();
      setShowConfirmClear(false);
      setConfirmText('');
    }
  };

  return (
    <div className="space-y-6">
      <div>
        <h1 className="text-2xl font-bold text-gray-900">Configuración</h1>
        <p className="text-gray-500 text-sm">Administración del sistema y datos</p>
      </div>

      {/* Información del Sistema */}
      <div className="bg-white rounded-lg border border-gray-200 p-6">
        <h2 className="font-semibold text-gray-900 mb-4 flex items-center gap-2">
          <Icons.Config /> Información del Sistema
        </h2>
        <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
          <div>
            <p className="text-sm text-gray-500">Versión</p>
            <p className="font-semibold">GENSEMEN PRO v1.0</p>
          </div>
          <div>
            <p className="text-sm text-gray-500">Almacenamiento</p>
            <p className="font-semibold">localStorage (navegador)</p>
          </div>
        </div>
      </div>

      {/* Estadísticas de Datos */}
      <div className="bg-white rounded-lg border border-gray-200 p-6">
        <h2 className="font-semibold text-gray-900 mb-4 flex items-center gap-2">
          <Icons.Chart /> Estadísticas de Datos
        </h2>
        <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
          <div className="bg-gray-50 rounded-lg p-3 text-center">
            <p className="text-2xl font-bold text-gray-900">{stats.toros}</p>
            <p className="text-xs text-gray-500">Toros</p>
          </div>
          <div className="bg-gray-50 rounded-lg p-3 text-center">
            <p className="text-2xl font-bold text-gray-900">{stats.pajillas.toLocaleString()}</p>
            <p className="text-xs text-gray-500">Pajillas</p>
          </div>
          <div className="bg-gray-50 rounded-lg p-3 text-center">
            <p className="text-2xl font-bold text-emerald-600">{stats.ventas}</p>
            <p className="text-xs text-gray-500">Ventas</p>
          </div>
          <div className="bg-gray-50 rounded-lg p-3 text-center">
            <p className="text-2xl font-bold text-blue-600">{stats.compras}</p>
            <p className="text-xs text-gray-500">Compras</p>
          </div>
          <div className="bg-gray-50 rounded-lg p-3 text-center">
            <p className="text-2xl font-bold text-gray-900">{stats.clientes}</p>
            <p className="text-xs text-gray-500">Clientes</p>
          </div>
          <div className="bg-gray-50 rounded-lg p-3 text-center">
            <p className="text-2xl font-bold text-gray-900">{stats.proveedores}</p>
            <p className="text-xs text-gray-500">Proveedores</p>
          </div>
          <div className="bg-gray-50 rounded-lg p-3 text-center">
            <p className="text-2xl font-bold text-amber-600">{stats.cxc}</p>
            <p className="text-xs text-gray-500">CxC</p>
          </div>
          <div className="bg-gray-50 rounded-lg p-3 text-center">
            <p className="text-2xl font-bold text-red-600">{stats.cxp}</p>
            <p className="text-xs text-gray-500">CxP</p>
          </div>
        </div>
      </div>

      {/* Respaldo y Restauración */}
      <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
        {/* Exportar */}
        <div className="bg-white rounded-lg border border-gray-200 p-6">
          <h2 className="font-semibold text-gray-900 mb-2 flex items-center gap-2">
            📤 Exportar Datos (Respaldo)
          </h2>
          <p className="text-sm text-gray-500 mb-4">
            Descarga un archivo JSON con todos los datos del sistema. Guárdalo en un lugar seguro.
          </p>
          <Button onClick={onExportar}>
            <Icons.Transactions /> Descargar Respaldo
          </Button>
        </div>

        {/* Importar */}
        <div className="bg-white rounded-lg border border-gray-200 p-6">
          <h2 className="font-semibold text-gray-900 mb-2 flex items-center gap-2">
            📥 Importar Datos (Restaurar)
          </h2>
          <p className="text-sm text-gray-500 mb-4">
            Restaura los datos desde un archivo de respaldo previamente exportado.
          </p>
          <input
            ref={fileInputRef}
            type="file"
            accept=".json"
            onChange={handleFileSelect}
            className="hidden"
          />
          <Button variant="secondary" onClick={() => fileInputRef.current?.click()}>
            <Icons.Cart /> Seleccionar Archivo
          </Button>
          {importStatus === 'loading' && (
            <p className="text-sm text-blue-600 mt-2">Importando datos...</p>
          )}
          {importStatus === 'success' && (
            <p className="text-sm text-emerald-600 mt-2">✓ Datos importados correctamente</p>
          )}
          {importStatus === 'error' && (
            <p className="text-sm text-red-600 mt-2">✗ Error al importar datos</p>
          )}
        </div>
      </div>

      {/* Gestión de Usuarios */}
      <div className="bg-white rounded-lg border border-gray-200 p-6">
        <div className="flex items-center justify-between mb-4">
          <h2 className="font-semibold text-gray-900 flex items-center gap-2">
            <Icons.Users /> Gestión de Usuarios
          </h2>
          <Button 
            onClick={() => {
              setEditingUser(null);
              setUserForm({ username: '', password: '', name: '', role: 'ventas' });
              setShowUserModal(true);
            }}
            size="sm"
          >
            <Icons.Plus /> Nuevo Usuario
          </Button>
        </div>
        
        <div className="space-y-3">
          {usuarios.map(user => (
            <div key={user.id} className="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
              <div className="flex items-center gap-3">
                <div className="w-10 h-10 bg-emerald-100 rounded-full flex items-center justify-center">
                  <Icons.User />
                </div>
                <div>
                  <p className="font-medium text-gray-900">{user.name}</p>
                  <p className="text-xs text-gray-500">@{user.username} · {user.role === 'admin' ? 'Administrador' : 'Ventas'}</p>
                </div>
              </div>
              <div className="flex items-center gap-2">
                <button
                  onClick={() => {
                    setEditingUser(user);
                    setUserForm({ 
                      username: user.username, 
                      password: '', 
                      name: user.name, 
                      role: user.role 
                    });
                    setShowUserModal(true);
                  }}
                  className="p-2 text-gray-500 hover:bg-gray-200 rounded-lg transition-colors"
                  title="Editar usuario"
                >
                  <Icons.Edit />
                </button>
                {usuarios.length > 1 && (
                  <button
                    onClick={() => {
                      if (window.confirm(`¿Estás seguro de eliminar al usuario "${user.name}"?`)) {
                        onDeleteUsuario(user.id);
                      }
                    }}
                    className="p-2 text-red-500 hover:bg-red-100 rounded-lg transition-colors"
                    title="Eliminar usuario"
                  >
                    <Icons.Trash />
                  </button>
                )}
              </div>
            </div>
          ))}
        </div>
      </div>

      {/* Modal de Usuario */}
      <Modal
        isOpen={showUserModal}
        onClose={() => setShowUserModal(false)}
        title={editingUser ? 'Editar Usuario' : 'Nuevo Usuario'}
        size="sm"
      >
        <div className="space-y-4">
          <Input
            label="Nombre completo"
            value={userForm.name}
            onChange={(v) => setUserForm({ ...userForm, name: v })}
            placeholder="Ej: Juan Pérez"
          />
          <Input
            label="Usuario (para login)"
            value={userForm.username}
            onChange={(v) => setUserForm({ ...userForm, username: v.toLowerCase().replace(/\s/g, '') })}
            placeholder="Ej: juanperez"
            disabled={editingUser !== null}
          />
          <Input
            label={editingUser ? 'Nueva contraseña (dejar vacío para mantener)' : 'Contraseña'}
            type="password"
            value={userForm.password}
            onChange={(v) => setUserForm({ ...userForm, password: v })}
            placeholder={editingUser ? '••••••••' : 'Mínimo 4 caracteres'}
          />
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-1">Rol</label>
            <select
              value={userForm.role}
              onChange={(e) => setUserForm({ ...userForm, role: e.target.value })}
              className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500"
            >
              <option value="admin">Administrador (acceso completo)</option>
              <option value="ventas">Ventas (acceso limitado)</option>
            </select>
          </div>
          
          <div className="flex gap-2 pt-2">
            <Button
              onClick={() => {
                if (!userForm.name || !userForm.username) {
                  alert('Por favor completa nombre y usuario');
                  return;
                }
                if (!editingUser && (!userForm.password || userForm.password.length < 4)) {
                  alert('La contraseña debe tener al menos 4 caracteres');
                  return;
                }
                
                if (editingUser) {
                  onUpdateUsuario(editingUser.id, {
                    name: userForm.name,
                    role: userForm.role,
                    ...(userForm.password ? { password: userForm.password } : {})
                  });
                } else {
                  onAddUsuario({
                    username: userForm.username,
                    password: userForm.password,
                    name: userForm.name,
                    role: userForm.role
                  });
                }
                setShowUserModal(false);
              }}
              className="flex-1"
            >
              {editingUser ? 'Guardar Cambios' : 'Crear Usuario'}
            </Button>
            <Button variant="secondary" onClick={() => setShowUserModal(false)} className="flex-1">
              Cancelar
            </Button>
          </div>
        </div>
      </Modal>

      {/* Zona de Peligro */}
      <div className="bg-red-50 rounded-lg border border-red-200 p-6">
        <h2 className="font-semibold text-red-700 mb-2 flex items-center gap-2">
          ⚠️ Zona de Peligro
        </h2>
        <p className="text-sm text-red-600 mb-4">
          Esta acción eliminará TODOS los datos del sistema (inventario, ventas, compras, cuentas, etc.). 
          Los catálogos se restaurarán a los valores iniciales. Esta acción NO se puede deshacer.
        </p>
        <Button 
          variant="danger" 
          onClick={() => setShowConfirmClear(true)}
        >
          🗑️ Limpiar Base de Datos
        </Button>
      </div>

      {/* Modal de Confirmación */}
      <Modal
        isOpen={showConfirmClear}
        onClose={() => { setShowConfirmClear(false); setConfirmText(''); }}
        title="⚠️ Confirmar Eliminación de Datos"
      >
        <div className="space-y-4">
          <div className="bg-red-100 border border-red-300 rounded-lg p-4">
            <p className="text-red-800 font-medium">¡ADVERTENCIA!</p>
            <p className="text-red-700 text-sm mt-1">
              Estás a punto de eliminar TODOS los datos del sistema. Esta acción es irreversible.
            </p>
          </div>
          
          <div>
            <p className="text-sm text-gray-600 mb-2">
              Se eliminarán los siguientes datos:
            </p>
            <ul className="text-sm text-gray-500 list-disc list-inside space-y-1">
              <li>{stats.inventario} registros de inventario ({stats.pajillas} pajillas)</li>
              <li>{stats.ventas} ventas registradas</li>
              <li>{stats.compras} compras registradas</li>
              <li>{stats.cxc} cuentas por cobrar</li>
              <li>{stats.cxp} cuentas por pagar</li>
              <li>{stats.gastos} gastos registrados</li>
            </ul>
          </div>

          <div className="bg-amber-50 border border-amber-200 rounded-lg p-3">
            <p className="text-amber-800 text-sm">
              💡 <strong>Recomendación:</strong> Antes de continuar, haz un respaldo de tus datos usando el botón "Exportar Datos".
            </p>
          </div>

          <div>
            <label className="block text-sm font-medium text-gray-700 mb-1">
              Escribe <span className="text-red-600 font-bold">ELIMINAR</span> para confirmar:
            </label>
            <input
              type="text"
              value={confirmText}
              onChange={(e) => setConfirmText(e.target.value)}
              className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500"
              placeholder="ELIMINAR"
            />
          </div>

          <div className="flex justify-end gap-2 pt-2">
            <Button variant="secondary" onClick={() => { setShowConfirmClear(false); setConfirmText(''); }}>
              Cancelar
            </Button>
            <Button 
              variant="danger" 
              onClick={handleClearData}
              disabled={confirmText !== 'ELIMINAR'}
            >
              Eliminar Todo
            </Button>
          </div>
        </div>
      </Modal>

      {/* Instrucciones */}
      <div className="bg-blue-50 rounded-lg border border-blue-200 p-6">
        <h2 className="font-semibold text-blue-900 mb-3 flex items-center gap-2">
          📖 Guía de Uso
        </h2>
        <div className="text-sm text-blue-800 space-y-2">
          <p><strong>1. Respaldo Regular:</strong> Exporta tus datos periódicamente para evitar pérdida de información.</p>
          <p><strong>2. Antes de Limpiar:</strong> Siempre haz un respaldo antes de limpiar la base de datos.</p>
          <p><strong>3. Restaurar Datos:</strong> Usa "Importar Datos" para restaurar desde un archivo de respaldo.</p>
          <p><strong>4. Almacenamiento:</strong> Los datos se guardan en el navegador. Si cambias de navegador o limpias la caché, necesitarás restaurar desde un respaldo.</p>
        </div>
      </div>
    </div>
  );
};

// Placeholder modules
const PlaceholderModule = ({ title, description }) => (
  <div className="space-y-6">
    <div>
      <h1 className="text-2xl font-bold text-gray-900">{title}</h1>
      <p className="text-gray-500 text-sm">{description}</p>
    </div>
    <div className="bg-white rounded-lg border border-gray-200 p-12">
      <EmptyState
        icon={Icons.Inventory}
        title="Módulo en desarrollo"
        description="Este módulo será implementado en los siguientes pasos según el plan de desarrollo."
      />
    </div>
  </div>
);

// Catálogos Module
const CatalogosModule = ({ toros, setToros, proveedores, setProveedores, clientes, setClientes, categorias, setCategorias }) => {
  const [activeTab, setActiveTab] = useState('toros');
  const [showModal, setShowModal] = useState(false);
  const [editingItem, setEditingItem] = useState(null);
  const [searchTerm, setSearchTerm] = useState('');
  
  // Forms
  const [toroForm, setToroForm] = useState({ codigo: '', nombre: '', raza: '' });
  const [proveedorForm, setProveedorForm] = useState({ nombre: '', contacto: '', telefono: '', email: '' });
  const [clienteForm, setClienteForm] = useState({ nombre: '', contacto: '', telefono: '', email: '' });
  const [categoriaForm, setCategoriaForm] = useState({ nombre: '', icono: 'more' });

  const tabs = [
    { id: 'toros', label: 'Toros', count: toros.length },
    { id: 'proveedores', label: 'Proveedores', count: proveedores.length },
    { id: 'clientes', label: 'Clientes', count: clientes.length },
    { id: 'categorias', label: 'Categorías Gastos', count: categorias.length },
  ];

  const resetForms = () => {
    setToroForm({ codigo: '', nombre: '', raza: '' });
    setProveedorForm({ nombre: '', contacto: '', telefono: '', email: '' });
    setClienteForm({ nombre: '', contacto: '', telefono: '', email: '' });
    setCategoriaForm({ nombre: '', icono: 'more' });
  };

  const handleOpenModal = (item = null) => {
    setEditingItem(item);
    if (item) {
      switch (activeTab) {
        case 'toros':
          setToroForm({ codigo: item.codigo, nombre: item.nombre, raza: item.raza || '' });
          break;
        case 'proveedores':
          setProveedorForm({ nombre: item.nombre, contacto: item.contacto || '', telefono: item.telefono || '', email: item.email || '' });
          break;
        case 'clientes':
          setClienteForm({ nombre: item.nombre, contacto: item.contacto || '', telefono: item.telefono || '', email: item.email || '' });
          break;
        case 'categorias':
          setCategoriaForm({ nombre: item.nombre, icono: item.icono || 'more' });
          break;
      }
    } else {
      resetForms();
    }
    setShowModal(true);
  };

  const handleSave = () => {
    switch (activeTab) {
      case 'toros':
        if (editingItem) {
          setToros(toros.map(t => t.id === editingItem.id ? { ...t, ...toroForm } : t));
        } else {
          setToros([...toros, { id: Date.now(), ...toroForm, activo: true }]);
        }
        break;
      case 'proveedores':
        if (editingItem) {
          setProveedores(proveedores.map(p => p.id === editingItem.id ? { ...p, ...proveedorForm } : p));
        } else {
          setProveedores([...proveedores, { id: Date.now(), ...proveedorForm, activo: true }]);
        }
        break;
      case 'clientes':
        if (editingItem) {
          setClientes(clientes.map(c => c.id === editingItem.id ? { ...c, ...clienteForm } : c));
        } else {
          setClientes([...clientes, { id: Date.now(), ...clienteForm, activo: true }]);
        }
        break;
      case 'categorias':
        if (editingItem) {
          setCategorias(categorias.map(c => c.id === editingItem.id ? { ...c, ...categoriaForm } : c));
        } else {
          setCategorias([...categorias, { id: Date.now(), ...categoriaForm, activo: true }]);
        }
        break;
    }
    setShowModal(false);
    resetForms();
    setEditingItem(null);
  };

  const handleToggleActive = (id) => {
    switch (activeTab) {
      case 'toros':
        setToros(toros.map(t => t.id === id ? { ...t, activo: !t.activo } : t));
        break;
      case 'proveedores':
        setProveedores(proveedores.map(p => p.id === id ? { ...p, activo: !p.activo } : p));
        break;
      case 'clientes':
        setClientes(clientes.map(c => c.id === id ? { ...c, activo: !c.activo } : c));
        break;
      case 'categorias':
        setCategorias(categorias.map(c => c.id === id ? { ...c, activo: !c.activo } : c));
        break;
    }
  };

  const handleDelete = (id) => {
    if (!window.confirm('¿Estás seguro de eliminar este registro?')) return;
    switch (activeTab) {
      case 'toros':
        setToros(toros.filter(t => t.id !== id));
        break;
      case 'proveedores':
        setProveedores(proveedores.filter(p => p.id !== id));
        break;
      case 'clientes':
        setClientes(clientes.filter(c => c.id !== id));
        break;
      case 'categorias':
        setCategorias(categorias.filter(c => c.id !== id));
        break;
    }
  };

  const getFilteredData = () => {
    const search = searchTerm.toLowerCase();
    switch (activeTab) {
      case 'toros':
        return toros.filter(t => t.codigo.toLowerCase().includes(search) || t.nombre.toLowerCase().includes(search));
      case 'proveedores':
        return proveedores.filter(p => p.nombre.toLowerCase().includes(search));
      case 'clientes':
        return clientes.filter(c => c.nombre.toLowerCase().includes(search));
      case 'categorias':
        return categorias.filter(c => c.nombre.toLowerCase().includes(search));
      default:
        return [];
    }
  };

  const getModalTitle = () => {
    const action = editingItem ? 'Editar' : 'Agregar';
    switch (activeTab) {
      case 'toros': return `${action} Toro`;
      case 'proveedores': return `${action} Proveedor`;
      case 'clientes': return `${action} Cliente`;
      case 'categorias': return `${action} Categoría`;
      default: return action;
    }
  };

  const getButtonLabel = () => {
    switch (activeTab) {
      case 'toros': return 'Agregar Toro';
      case 'proveedores': return 'Agregar Proveedor';
      case 'clientes': return 'Agregar Cliente';
      case 'categorias': return 'Agregar Categoría';
      default: return 'Agregar';
    }
  };

  const renderModalContent = () => {
    switch (activeTab) {
      case 'toros':
        return (
          <div className="space-y-4">
            <Input label="Código" value={toroForm.codigo} onChange={(v) => setToroForm({...toroForm, codigo: v})} placeholder="Ej: MS1947" required />
            <Input label="Nombre" value={toroForm.nombre} onChange={(v) => setToroForm({...toroForm, nombre: v})} placeholder="Ej: ATILA" required />
            <Input label="Raza" value={toroForm.raza} onChange={(v) => setToroForm({...toroForm, raza: v})} placeholder="Ej: Brahman" />
          </div>
        );
      case 'proveedores':
        return (
          <div className="space-y-4">
            <Input label="Nombre / Empresa" value={proveedorForm.nombre} onChange={(v) => setProveedorForm({...proveedorForm, nombre: v})} placeholder="Nombre del proveedor" required />
            <Input label="Contacto" value={proveedorForm.contacto} onChange={(v) => setProveedorForm({...proveedorForm, contacto: v})} placeholder="Persona de contacto" />
            <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
              <Input label="Teléfono" value={proveedorForm.telefono} onChange={(v) => setProveedorForm({...proveedorForm, telefono: v})} placeholder="Teléfono" />
              <Input label="Email" type="email" value={proveedorForm.email} onChange={(v) => setProveedorForm({...proveedorForm, email: v})} placeholder="correo@ejemplo.com" />
            </div>
          </div>
        );
      case 'clientes':
        return (
          <div className="space-y-4">
            <Input label="Nombre / Empresa" value={clienteForm.nombre} onChange={(v) => setClienteForm({...clienteForm, nombre: v})} placeholder="Nombre del cliente" required />
            <Input label="Contacto" value={clienteForm.contacto} onChange={(v) => setClienteForm({...clienteForm, contacto: v})} placeholder="Persona de contacto" />
            <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
              <Input label="Teléfono" value={clienteForm.telefono} onChange={(v) => setClienteForm({...clienteForm, telefono: v})} placeholder="Teléfono" />
              <Input label="Email" type="email" value={clienteForm.email} onChange={(v) => setClienteForm({...clienteForm, email: v})} placeholder="correo@ejemplo.com" />
            </div>
          </div>
        );
      case 'categorias':
        return (
          <div className="space-y-4">
            <Input label="Nombre de Categoría" value={categoriaForm.nombre} onChange={(v) => setCategoriaForm({...categoriaForm, nombre: v})} placeholder="Ej: Mantenimiento" required />
            <Select 
              label="Icono" 
              value={categoriaForm.icono} 
              onChange={(v) => setCategoriaForm({...categoriaForm, icono: v})}
              options={[
                { value: 'truck', label: '🚚 Transporte/Envíos' },
                { value: 'snowflake', label: '❄️ Nitrógeno' },
                { value: 'users', label: '👥 Sueldos/Personal' },
                { value: 'tool', label: '🔧 Mantenimiento' },
                { value: 'zap', label: '⚡ Servicios' },
                { value: 'more', label: '••• Otros' },
              ]}
            />
          </div>
        );
      default:
        return null;
    }
  };

  const isFormValid = () => {
    switch (activeTab) {
      case 'toros': return toroForm.codigo && toroForm.nombre;
      case 'proveedores': return proveedorForm.nombre;
      case 'clientes': return clienteForm.nombre;
      case 'categorias': return categoriaForm.nombre;
      default: return false;
    }
  };

  const filteredData = getFilteredData();

  return (
    <div className="space-y-6">
      <div className="flex items-center justify-between">
        <div>
          <h1 className="text-2xl font-bold text-gray-900">Catálogos</h1>
          <p className="text-gray-500 text-sm">Gestión de catálogos del sistema</p>
        </div>
        <Button onClick={() => handleOpenModal()}>
          <Icons.Plus /> {getButtonLabel()}
        </Button>
      </div>

      {/* Tabs */}
      <div className="bg-white rounded-lg border border-gray-200">
        <div className="border-b border-gray-200">
          <nav className="flex -mb-px">
            {tabs.map((tab) => (
              <button
                key={tab.id}
                onClick={() => { setActiveTab(tab.id); setSearchTerm(''); }}
                className={`px-6 py-3 text-sm font-medium border-b-2 transition-colors ${
                  activeTab === tab.id
                    ? 'border-emerald-500 text-emerald-600'
                    : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'
                }`}
              >
                {tab.label}
                <span className={`ml-2 px-2 py-0.5 rounded-full text-xs ${
                  activeTab === tab.id ? 'bg-emerald-100 text-emerald-600' : 'bg-gray-100 text-gray-500'
                }`}>
                  {tab.count}
                </span>
              </button>
            ))}
          </nav>
        </div>

        {/* Search */}
        <div className="p-4 border-b border-gray-200">
          <div className="relative max-w-md">
            <div className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400">
              <Icons.Search />
            </div>
            <input
              type="text"
              placeholder={`Buscar ${activeTab}...`}
              value={searchTerm}
              onChange={(e) => setSearchTerm(e.target.value)}
              className="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500"
            />
          </div>
        </div>

        {/* Content */}
        <div className="overflow-x-auto">
          {activeTab === 'toros' && (
            <table className="w-full">
              <thead>
                <tr className="bg-gray-50 border-b border-gray-200">
                  <th className="text-left px-4 py-2.5 text-xs font-semibold text-gray-500 uppercase">Código</th>
                  <th className="text-left px-4 py-2.5 text-xs font-semibold text-gray-500 uppercase">Nombre</th>
                  <th className="text-left px-4 py-2.5 text-xs font-semibold text-gray-500 uppercase">Raza</th>
                  <th className="text-center px-4 py-2.5 text-xs font-semibold text-gray-500 uppercase">Estado</th>
                  <th className="text-center px-4 py-2.5 text-xs font-semibold text-gray-500 uppercase">Acciones</th>
                </tr>
              </thead>
              <tbody className="divide-y divide-gray-200">
                {filteredData.map((toro) => (
                  <tr key={toro.id} className="hover:bg-gray-50">
                    <td className="px-4 py-2.5 text-sm font-mono text-gray-900">{toro.codigo}</td>
                    <td className="px-4 py-2.5 text-sm text-gray-900">{toro.nombre}</td>
                    <td className="px-4 py-2.5 text-sm text-gray-500">{toro.raza || '-'}</td>
                    <td className="px-4 py-2.5 text-center">
                      <Badge variant={toro.activo ? 'success' : 'default'}>{toro.activo ? 'Activo' : 'Inactivo'}</Badge>
                    </td>
                    <td className="px-4 py-2.5">
                      <div className="flex justify-center gap-1">
                        <button onClick={() => handleOpenModal(toro)} className="p-1 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded" title="Editar">
                          <Icons.Edit />
                        </button>
                        <button onClick={() => handleToggleActive(toro.id)} className={`p-1 rounded ${toro.activo ? 'text-gray-400 hover:text-amber-600 hover:bg-amber-50' : 'text-gray-400 hover:text-green-600 hover:bg-green-50'}`} title={toro.activo ? 'Desactivar' : 'Activar'}>
                          {toro.activo ? <Icons.X /> : <Icons.Check />}
                        </button>
                        <button onClick={() => handleDelete(toro.id)} className="p-1 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded" title="Eliminar">
                          <Icons.Trash />
                        </button>
                      </div>
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
          )}

          {activeTab === 'proveedores' && (
            <table className="w-full">
              <thead>
                <tr className="bg-gray-50 border-b border-gray-200">
                  <th className="text-left px-4 py-2.5 text-xs font-semibold text-gray-500 uppercase">Nombre</th>
                  <th className="text-left px-4 py-2.5 text-xs font-semibold text-gray-500 uppercase">Contacto</th>
                  <th className="text-left px-4 py-2.5 text-xs font-semibold text-gray-500 uppercase">Teléfono</th>
                  <th className="text-left px-4 py-2.5 text-xs font-semibold text-gray-500 uppercase">Email</th>
                  <th className="text-center px-4 py-2.5 text-xs font-semibold text-gray-500 uppercase">Estado</th>
                  <th className="text-center px-4 py-2.5 text-xs font-semibold text-gray-500 uppercase">Acciones</th>
                </tr>
              </thead>
              <tbody className="divide-y divide-gray-200">
                {filteredData.map((prov) => (
                  <tr key={prov.id} className="hover:bg-gray-50">
                    <td className="px-4 py-2.5 text-sm font-medium text-gray-900">{prov.nombre}</td>
                    <td className="px-4 py-2.5 text-sm text-gray-500">{prov.contacto || '-'}</td>
                    <td className="px-4 py-2.5 text-sm text-gray-500">{prov.telefono || '-'}</td>
                    <td className="px-4 py-2.5 text-sm text-gray-500">{prov.email || '-'}</td>
                    <td className="px-4 py-2.5 text-center">
                      <Badge variant={prov.activo ? 'success' : 'default'}>{prov.activo ? 'Activo' : 'Inactivo'}</Badge>
                    </td>
                    <td className="px-4 py-2.5">
                      <div className="flex justify-center gap-1">
                        <button onClick={() => handleOpenModal(prov)} className="p-1 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded"><Icons.Edit /></button>
                        <button onClick={() => handleToggleActive(prov.id)} className={`p-1 rounded ${prov.activo ? 'text-gray-400 hover:text-amber-600 hover:bg-amber-50' : 'text-gray-400 hover:text-green-600 hover:bg-green-50'}`}>
                          {prov.activo ? <Icons.X /> : <Icons.Check />}
                        </button>
                        <button onClick={() => handleDelete(prov.id)} className="p-1 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded"><Icons.Trash /></button>
                      </div>
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
          )}

          {activeTab === 'clientes' && (
            <table className="w-full">
              <thead>
                <tr className="bg-gray-50 border-b border-gray-200">
                  <th className="text-left px-4 py-2.5 text-xs font-semibold text-gray-500 uppercase">Nombre</th>
                  <th className="text-left px-4 py-2.5 text-xs font-semibold text-gray-500 uppercase">Contacto</th>
                  <th className="text-left px-4 py-2.5 text-xs font-semibold text-gray-500 uppercase">Teléfono</th>
                  <th className="text-left px-4 py-2.5 text-xs font-semibold text-gray-500 uppercase">Email</th>
                  <th className="text-center px-4 py-2.5 text-xs font-semibold text-gray-500 uppercase">Estado</th>
                  <th className="text-center px-4 py-2.5 text-xs font-semibold text-gray-500 uppercase">Acciones</th>
                </tr>
              </thead>
              <tbody className="divide-y divide-gray-200">
                {filteredData.map((cli) => (
                  <tr key={cli.id} className="hover:bg-gray-50">
                    <td className="px-4 py-2.5 text-sm font-medium text-gray-900">{cli.nombre}</td>
                    <td className="px-4 py-2.5 text-sm text-gray-500">{cli.contacto || '-'}</td>
                    <td className="px-4 py-2.5 text-sm text-gray-500">{cli.telefono || '-'}</td>
                    <td className="px-4 py-2.5 text-sm text-gray-500">{cli.email || '-'}</td>
                    <td className="px-4 py-2.5 text-center">
                      <Badge variant={cli.activo ? 'success' : 'default'}>{cli.activo ? 'Activo' : 'Inactivo'}</Badge>
                    </td>
                    <td className="px-4 py-2.5">
                      <div className="flex justify-center gap-1">
                        <button onClick={() => handleOpenModal(cli)} className="p-1 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded"><Icons.Edit /></button>
                        <button onClick={() => handleToggleActive(cli.id)} className={`p-1 rounded ${cli.activo ? 'text-gray-400 hover:text-amber-600 hover:bg-amber-50' : 'text-gray-400 hover:text-green-600 hover:bg-green-50'}`}>
                          {cli.activo ? <Icons.X /> : <Icons.Check />}
                        </button>
                        <button onClick={() => handleDelete(cli.id)} className="p-1 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded"><Icons.Trash /></button>
                      </div>
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
          )}

          {activeTab === 'categorias' && (
            <table className="w-full">
              <thead>
                <tr className="bg-gray-50 border-b border-gray-200">
                  <th className="text-left px-4 py-2.5 text-xs font-semibold text-gray-500 uppercase">Icono</th>
                  <th className="text-left px-4 py-2.5 text-xs font-semibold text-gray-500 uppercase">Nombre</th>
                  <th className="text-center px-4 py-2.5 text-xs font-semibold text-gray-500 uppercase">Estado</th>
                  <th className="text-center px-4 py-2.5 text-xs font-semibold text-gray-500 uppercase">Acciones</th>
                </tr>
              </thead>
              <tbody className="divide-y divide-gray-200">
                {filteredData.map((cat) => {
                  const iconMap = {
                    truck: '🚚',
                    snowflake: '❄️',
                    users: '👥',
                    tool: '🔧',
                    zap: '⚡',
                    more: '•••',
                  };
                  return (
                    <tr key={cat.id} className="hover:bg-gray-50">
                      <td className="px-4 py-2.5 text-lg">{iconMap[cat.icono] || '•••'}</td>
                      <td className="px-4 py-2.5 text-sm font-medium text-gray-900">{cat.nombre}</td>
                      <td className="px-4 py-2.5 text-center">
                        <Badge variant={cat.activo ? 'success' : 'default'}>{cat.activo ? 'Activo' : 'Inactivo'}</Badge>
                      </td>
                      <td className="px-4 py-2.5">
                        <div className="flex justify-center gap-1">
                          <button onClick={() => handleOpenModal(cat)} className="p-1 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded"><Icons.Edit /></button>
                          <button onClick={() => handleToggleActive(cat.id)} className={`p-1 rounded ${cat.activo ? 'text-gray-400 hover:text-amber-600 hover:bg-amber-50' : 'text-gray-400 hover:text-green-600 hover:bg-green-50'}`}>
                            {cat.activo ? <Icons.X /> : <Icons.Check />}
                          </button>
                          <button onClick={() => handleDelete(cat.id)} className="p-1 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded"><Icons.Trash /></button>
                        </div>
                      </td>
                    </tr>
                  );
                })}
              </tbody>
            </table>
          )}

          {filteredData.length === 0 && (
            <div className="py-12 text-center text-gray-500">
              No se encontraron registros
            </div>
          )}
        </div>
      </div>

      {/* Modal */}
      <Modal isOpen={showModal} onClose={() => setShowModal(false)} title={getModalTitle()}>
        {renderModalContent()}
        <div className="flex gap-3 pt-6">
          <Button variant="secondary" onClick={() => setShowModal(false)} className="flex-1">Cancelar</Button>
          <Button onClick={handleSave} className="flex-1" disabled={!isFormValid()}>
            {editingItem ? 'Actualizar' : 'Guardar'}
          </Button>
        </div>
      </Modal>
    </div>
  );
};

// ==================== APLICACIÓN PRINCIPAL ====================
export default function GenSemenPro() {
  const [user, setUser] = useState(null);
  const [activeModule, setActiveModule] = useState('dashboard');
  const [sidebarOpen, setSidebarOpen] = useState(false);
  const [firebaseLoading, setFirebaseLoading] = useState(FIREBASE_ENABLED);
  const [syncStatus, setSyncStatus] = useState('local'); // 'local', 'syncing', 'synced', 'error'
  
  // Función para cargar datos de localStorage
  const loadFromStorage = (key, defaultValue) => {
    try {
      const saved = localStorage.getItem(`gensemen_${key}`);
      return saved ? JSON.parse(saved) : defaultValue;
    } catch {
      return defaultValue;
    }
  };

  // Estados de datos con persistencia
  const [toros, setTorosState] = useState(() => loadFromStorage('toros', initialCatalogToros));
  const [proveedores, setProveedoresState] = useState(() => loadFromStorage('proveedores', initialCatalogProveedores));
  const [clientes, setClientesState] = useState(() => loadFromStorage('clientes', initialCatalogClientes));
  const [categorias, setCategoriasState] = useState(() => loadFromStorage('categorias', initialCatalogCategorias));
  const [inventory, setInventoryState] = useState(() => loadFromStorage('inventory', initialInventory));
  const [compras, setComprasState] = useState(() => loadFromStorage('compras', []));
  const [ventas, setVentasState] = useState(() => loadFromStorage('ventas', []));
  const [transactions, setTransactionsState] = useState(() => loadFromStorage('transactions', []));
  const [cxc, setCxcState] = useState(() => loadFromStorage('cxc', []));
  const [cxp, setCxpState] = useState(() => loadFromStorage('cxp', []));
  const [gastos, setGastosState] = useState(() => loadFromStorage('gastos', []));
  const [usuarios, setUsuariosState] = useState(() => loadFromStorage('usuarios', USERS));

  // ==================== FUNCIONES DE FIREBASE ====================
  // Función para guardar en Firebase (descomentada cuando Firebase esté configurado)
  const saveToFirebase = useCallback(async (collectionName, data) => {
    if (!FIREBASE_ENABLED) return;
    try {
      setSyncStatus('syncing');
      await setDoc(doc(db, 'gensemen', collectionName), { data, updatedAt: new Date().toISOString() });
      setSyncStatus('synced');
    } catch (error) {
      console.error('Error guardando en Firebase:', error);
      setSyncStatus('error');
    }
  }, []);

  // Wrappers para setters que guardan en ambos lugares
  const setToros = useCallback((newData) => {
    const data = typeof newData === 'function' ? newData(toros) : newData;
    setTorosState(data);
    saveToFirebase('toros', data);
  }, [toros, saveToFirebase]);

  const setProveedores = useCallback((newData) => {
    const data = typeof newData === 'function' ? newData(proveedores) : newData;
    setProveedoresState(data);
    saveToFirebase('proveedores', data);
  }, [proveedores, saveToFirebase]);

  const setClientes = useCallback((newData) => {
    const data = typeof newData === 'function' ? newData(clientes) : newData;
    setClientesState(data);
    saveToFirebase('clientes', data);
  }, [clientes, saveToFirebase]);

  const setCategorias = useCallback((newData) => {
    const data = typeof newData === 'function' ? newData(categorias) : newData;
    setCategoriasState(data);
    saveToFirebase('categorias', data);
  }, [categorias, saveToFirebase]);

  const setInventory = useCallback((newData) => {
    const data = typeof newData === 'function' ? newData(inventory) : newData;
    setInventoryState(data);
    saveToFirebase('inventory', data);
  }, [inventory, saveToFirebase]);

  const setCompras = useCallback((newData) => {
    const data = typeof newData === 'function' ? newData(compras) : newData;
    setComprasState(data);
    saveToFirebase('compras', data);
  }, [compras, saveToFirebase]);

  const setVentas = useCallback((newData) => {
    const data = typeof newData === 'function' ? newData(ventas) : newData;
    setVentasState(data);
    saveToFirebase('ventas', data);
  }, [ventas, saveToFirebase]);

  const setTransactions = useCallback((newData) => {
    const data = typeof newData === 'function' ? newData(transactions) : newData;
    setTransactionsState(data);
    saveToFirebase('transactions', data);
  }, [transactions, saveToFirebase]);

  const setCxc = useCallback((newData) => {
    const data = typeof newData === 'function' ? newData(cxc) : newData;
    setCxcState(data);
    saveToFirebase('cxc', data);
  }, [cxc, saveToFirebase]);

  const setCxp = useCallback((newData) => {
    const data = typeof newData === 'function' ? newData(cxp) : newData;
    setCxpState(data);
    saveToFirebase('cxp', data);
  }, [cxp, saveToFirebase]);

  const setGastos = useCallback((newData) => {
    const data = typeof newData === 'function' ? newData(gastos) : newData;
    setGastosState(data);
    saveToFirebase('gastos', data);
  }, [gastos, saveToFirebase]);

  const setUsuarios = useCallback((newData) => {
    const data = typeof newData === 'function' ? newData(usuarios) : newData;
    setUsuariosState(data);
    saveToFirebase('usuarios', data);
  }, [usuarios, saveToFirebase]);

  // Funciones de gestión de usuarios
  const handleAddUsuario = useCallback((newUser) => {
    const nuevoUsuario = {
      ...newUser,
      id: Date.now()
    };
    setUsuarios(prev => [...prev, nuevoUsuario]);
  }, [setUsuarios]);

  const handleUpdateUsuario = useCallback((userId, updates) => {
    setUsuarios(prev => prev.map(u => 
      u.id === userId ? { ...u, ...updates } : u
    ));
  }, [setUsuarios]);

  const handleDeleteUsuario = useCallback((userId) => {
    setUsuarios(prev => prev.filter(u => u.id !== userId));
  }, [setUsuarios]);

  // ==================== LISTENERS DE FIREBASE (TIEMPO REAL) ====================
  useEffect(() => {
    if (!FIREBASE_ENABLED) {
      setFirebaseLoading(false);
      return;
    }

    const unsubscribers = [];
    const collections = [
      { name: 'toros', setter: setTorosState, default: initialCatalogToros },
      { name: 'proveedores', setter: setProveedoresState, default: initialCatalogProveedores },
      { name: 'clientes', setter: setClientesState, default: initialCatalogClientes },
      { name: 'categorias', setter: setCategoriasState, default: initialCatalogCategorias },
      { name: 'inventory', setter: setInventoryState, default: initialInventory },
      { name: 'compras', setter: setComprasState, default: [] },
      { name: 'ventas', setter: setVentasState, default: [] },
      { name: 'transactions', setter: setTransactionsState, default: [] },
      { name: 'cxc', setter: setCxcState, default: [] },
      { name: 'cxp', setter: setCxpState, default: [] },
      { name: 'gastos', setter: setGastosState, default: [] },
      { name: 'usuarios', setter: setUsuariosState, default: USERS },
    ];

    collections.forEach(({ name, setter, default: defaultValue }) => {
      const unsubscribe = onSnapshot(doc(db, 'gensemen', name), (docSnap) => {
        if (docSnap.exists()) {
          const docData = docSnap.data();
          setter(docData.data || defaultValue);
          localStorage.setItem(`gensemen_${name}`, JSON.stringify(docData.data || defaultValue));
        }
      }, (error) => {
        console.error(`Error en listener de ${name}:`, error);
      });
      unsubscribers.push(unsubscribe);
    });

    setFirebaseLoading(false);
    setSyncStatus('synced');

    return () => {
      unsubscribers.forEach(unsub => unsub());
    };
  }, []);

  // Guardar en localStorage cuando cambien los datos (backup local)
  useEffect(() => { localStorage.setItem('gensemen_toros', JSON.stringify(toros)); }, [toros]);
  useEffect(() => { localStorage.setItem('gensemen_proveedores', JSON.stringify(proveedores)); }, [proveedores]);
  useEffect(() => { localStorage.setItem('gensemen_clientes', JSON.stringify(clientes)); }, [clientes]);
  useEffect(() => { localStorage.setItem('gensemen_categorias', JSON.stringify(categorias)); }, [categorias]);
  useEffect(() => { localStorage.setItem('gensemen_inventory', JSON.stringify(inventory)); }, [inventory]);
  useEffect(() => { localStorage.setItem('gensemen_compras', JSON.stringify(compras)); }, [compras]);
  useEffect(() => { localStorage.setItem('gensemen_ventas', JSON.stringify(ventas)); }, [ventas]);
  useEffect(() => { localStorage.setItem('gensemen_transactions', JSON.stringify(transactions)); }, [transactions]);
  useEffect(() => { localStorage.setItem('gensemen_cxc', JSON.stringify(cxc)); }, [cxc]);
  useEffect(() => { localStorage.setItem('gensemen_cxp', JSON.stringify(cxp)); }, [cxp]);
  useEffect(() => { localStorage.setItem('gensemen_gastos', JSON.stringify(gastos)); }, [gastos]);
  useEffect(() => { localStorage.setItem('gensemen_usuarios', JSON.stringify(usuarios)); }, [usuarios]);

  // Función para exportar todos los datos
  const exportarDatos = () => {
    const datos = {
      version: '1.0',
      fecha: new Date().toISOString(),
      toros,
      proveedores,
      clientes,
      categorias,
      inventory,
      compras,
      ventas,
      transactions,
      cxc,
      cxp,
      gastos
    };
    const blob = new Blob([JSON.stringify(datos, null, 2)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `gensemen_backup_${new Date().toISOString().split('T')[0]}.json`;
    a.click();
    URL.revokeObjectURL(url);
  };

  // Función para importar datos
  const importarDatos = (archivo) => {
    return new Promise((resolve, reject) => {
      const reader = new FileReader();
      reader.onload = (e) => {
        try {
          const datos = JSON.parse(e.target.result);
          if (datos.toros) setToros(datos.toros);
          if (datos.proveedores) setProveedores(datos.proveedores);
          if (datos.clientes) setClientes(datos.clientes);
          if (datos.categorias) setCategorias(datos.categorias);
          if (datos.inventory) setInventory(datos.inventory);
          if (datos.compras) setCompras(datos.compras);
          if (datos.ventas) setVentas(datos.ventas);
          if (datos.transactions) setTransactions(datos.transactions);
          if (datos.cxc) setCxc(datos.cxc);
          if (datos.cxp) setCxp(datos.cxp);
          if (datos.gastos) setGastos(datos.gastos);
          resolve(true);
        } catch (error) {
          reject(error);
        }
      };
      reader.readAsText(archivo);
    });
  };

  // Función para limpiar todos los datos
  const limpiarDatos = async () => {
    setToros(initialCatalogToros);
    setProveedores(initialCatalogProveedores);
    setClientes(initialCatalogClientes);
    setCategorias(initialCatalogCategorias);
    setInventory([]);
    setCompras([]);
    setVentas([]);
    setTransactions([]);
    setCxc([]);
    setCxp([]);
    setGastos([]);
  };

  // Pantalla de carga mientras Firebase sincroniza
  if (firebaseLoading) {
    return (
      <div className="min-h-screen bg-emerald-900 flex items-center justify-center">
        <div className="text-center">
          <div className="animate-spin rounded-full h-16 w-16 border-t-4 border-white mx-auto mb-4"></div>
          <p className="text-white text-xl">Sincronizando datos...</p>
        </div>
      </div>
    );
  }

  const handleLogin = (userData) => {
    setUser(userData);
  };

  const handleLogout = () => {
    setUser(null);
    setActiveModule('dashboard');
  };

  if (!user) {
    return <LoginScreen onLogin={handleLogin} usuarios={usuarios} />;
  }

  const renderModule = () => {
    switch (activeModule) {
      case 'dashboard':
        return <DashboardModule inventory={inventory} toros={toros} compras={compras} ventas={ventas} cxc={cxc} cxp={cxp} gastos={gastos} clientes={clientes} proveedores={proveedores} />;
      case 'inventario':
        return <InventarioModule inventory={inventory} setInventory={setInventory} toros={toros} setToros={setToros} />;
      case 'compras':
        return <ComprasModule inventory={inventory} setInventory={setInventory} toros={toros} setToros={setToros} proveedores={proveedores} setProveedores={setProveedores} compras={compras} setCompras={setCompras} cxp={cxp} setCxp={setCxp} />;
      case 'ventas':
        return <VentasModule inventory={inventory} setInventory={setInventory} toros={toros} clientes={clientes} setClientes={setClientes} ventas={ventas} setVentas={setVentas} cxc={cxc} setCxc={setCxc} />;
      case 'cxc':
        return <CxCModule cxc={cxc} setCxc={setCxc} ventas={ventas} setVentas={setVentas} clientes={clientes} />;
      case 'cxp':
        return <CxPModule cxp={cxp} setCxp={setCxp} compras={compras} setCompras={setCompras} proveedores={proveedores} />;
      case 'gastos':
        return <GastosModule gastos={gastos} setGastos={setGastos} categorias={categorias} />;
      case 'reportes':
        return <ReportesModule inventory={inventory} toros={toros} compras={compras} ventas={ventas} cxc={cxc} cxp={cxp} gastos={gastos} clientes={clientes} proveedores={proveedores} categorias={categorias} />;
      case 'analisis':
        return <AnalisisIAModule inventory={inventory} toros={toros} compras={compras} ventas={ventas} cxc={cxc} cxp={cxp} gastos={gastos} clientes={clientes} proveedores={proveedores} categorias={categorias} />;
      case 'catalogos':
        return <CatalogosModule toros={toros} setToros={setToros} proveedores={proveedores} setProveedores={setProveedores} clientes={clientes} setClientes={setClientes} categorias={categorias} setCategorias={setCategorias} />;
      case 'configuracion':
        return <ConfiguracionModule 
          toros={toros} proveedores={proveedores} clientes={clientes} categorias={categorias}
          inventory={inventory} compras={compras} ventas={ventas} cxc={cxc} cxp={cxp} gastos={gastos}
          onExportar={exportarDatos} onImportar={importarDatos} onLimpiar={limpiarDatos}
          usuarios={usuarios} onUpdateUsuario={handleUpdateUsuario} onAddUsuario={handleAddUsuario} onDeleteUsuario={handleDeleteUsuario}
        />;
      default:
        return <DashboardModule inventory={inventory} toros={toros} compras={compras} ventas={ventas} cxc={cxc} cxp={cxp} gastos={gastos} clientes={clientes} proveedores={proveedores} />;
    }
  };

  // Función para cambiar módulo y cerrar sidebar en móvil
  const handleModuleChange = (moduleId) => {
    setActiveModule(moduleId);
    setSidebarOpen(false);
  };

  return (
    <AuthContext.Provider value={{ user, role: ROLES[user.role] }}>
      <div className="min-h-screen bg-gray-50">
        <Sidebar 
          activeModule={activeModule} 
          setActiveModule={handleModuleChange} 
          user={user} 
          onLogout={handleLogout}
          syncStatus={syncStatus}
          firebaseEnabled={FIREBASE_ENABLED}
          isOpen={sidebarOpen}
          onClose={() => setSidebarOpen(false)}
        />
        
        {/* Header móvil con botón hamburguesa */}
        <div className="md:hidden fixed top-0 left-0 right-0 h-14 bg-emerald-700 flex items-center px-4 z-20">
          <button 
            onClick={() => setSidebarOpen(true)}
            className="p-2 rounded-lg hover:bg-emerald-600 text-white"
          >
            <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 6h16M4 12h16M4 18h16" />
            </svg>
          </button>
          <span className="ml-3 text-white font-medium">GENSEMEN PRO</span>
        </div>
        
        <main className="md:ml-64 p-4 md:p-6 pt-18 md:pt-6">
          {/* Espaciador para el header móvil */}
          <div className="h-14 md:hidden"></div>
          {renderModule()}
        </main>
      </div>
    </AuthContext.Provider>
  );
}
